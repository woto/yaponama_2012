<% @discourse = {} %>
<% @discourse[:category] = @resource.name %>
<% @discourse[:brand] = @brand.name %>
<% @discourse[:model] = @model.name %>
<% @discourse[:generation] = @generation.name %>

<%= page do |p| %>

  <%= p.breadcrumb do %>
    <%= breadcrumb false, exception=true do |b| %>
      <% if @resource.opt %>
        <%= b.item('Запчасти', categories_path) %>
        <%= b.item(@resource.name, category_path(params[:category_id])) %>
        <%= b.item(@brand.name, category_brand_path(params[:category_id], @brand.to_param)) %>
        <%= b.item(@model.name, category_model_path(params[:category_id], @model.to_param)) %>
        <%= b.item(@generation.name) %>
      <% else %>
        <%= b.item('Каталоги', catalogs_path) %>
        <%= b.item(@brand.name, catalogs_brand_path(@brand)) %>
        <%= b.item(@model.name, catalogs_model_path(@model)) %>
        <%= b.item(@resource.name, category_model_path(params[:category_id], @model.to_param)) %>
        <%= b.item(@generation.name) %>
      <% end %>
    <% end %>
  <% end %>

  <%= p.title do %>
    <%= image_tag @brand.image_url, class: 'pull-right img-thumbnail', style: 'margin-top: -60px;' %>
    <% @meta_title = "#{@resource.name} на #{@brand.name} #{@model.name} #{@generation.name}" %>
    <% @meta_title_lead = "Подбор #{@resource.name} по автомобилю и характеристикам" %>
    <%= page_header %>
  <% end %>

  <%= p.content do %>
    <% if @modifications.exists? %>
      <%= panel 'info', class: 'by-car' do |p| %>
        <%= p.heading do %>
          <%= p.title do %>
            <a data-toggle="collapse" href="#by-car-collapse">Подбор <%= @resource.name %> по автомобилю </a>
          <% end %>
        <% end %>
        <%= content_tag :div, 'id' => 'by-car-collapse', 'class' => 'panel-collapse collapse' do %>
          <%= p.body do %>
            <ol id="categories-generations-show-modifications">
              <% @modifications.each do |modification| %>
                <li data-clickable-object> <%= link_to safe_join([hidden("#{@resource.name} на #{@brand.name} #{@model.name} #{@generation.name} "), content_tag(:strong, modification.name)]), category_modification_path(params[:category_id], modification), 'data-clickable-href' => '' %> <%= "<small class='text-muted'>(#{modification.count}&nbsp;шт.)</small>".html_safe %></li>
              <% end %>
            </ol>
          <% end %>
        <% end %>
      <% end %>
    <% end %>

    <%= render 'tmp' %>

    <% if @current_user.seller? %>
      <%= link_to edit_admin_generation_path(@generation, :return_path => request.fullpath), class: 'btn btn-lg btn-warning top-space-lg bottom-space-lg' do %>
        <%= icon 'edit' %>
        Редактировать
      <% end %>
    <% end %>

  <% end %>
<% end %>
