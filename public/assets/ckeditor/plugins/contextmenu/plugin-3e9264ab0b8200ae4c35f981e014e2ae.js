CKEDITOR.plugins.add("contextmenu",{requires:"menu",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",onLoad:function(){CKEDITOR.plugins.contextMenu=CKEDITOR.tools.createClass({base:CKEDITOR.menu,$:function(e){this.base.call(this,e,{panel:{className:"cke_menu_panel",attributes:{"aria-label":e.lang.contextmenu.options}}})},proto:{addTarget:function(e,t){if(CKEDITOR.env.opera&&!("oncontextmenu"in document.body)){var n;e.on("mousedown",function(o){if(o=o.data,2!=o.$.button)o.getKeystroke()==CKEDITOR.CTRL+1&&e.fire("contextmenu",o);else if(!t||!(CKEDITOR.env.mac?o.$.metaKey:o.$.ctrlKey)){var a=o.getTarget();n||(a=a.getDocument(),n=a.createElement("input"),n.$.type="button",a.getBody().append(n)),n.setAttribute("style","position:absolute;top:"+(o.$.clientY-2)+"px;left:"+(o.$.clientX-2)+"px;width:5px;height:5px;opacity:0.01")}}),e.on("mouseup",function(t){n&&(n.remove(),n=void 0,e.fire("contextmenu",t.data))})}if(e.on("contextmenu",function(e){if(e=e.data,!t||!(CKEDITOR.env.webkit?o:CKEDITOR.env.mac?e.$.metaKey:e.$.ctrlKey)){e.preventDefault();var n=e.getTarget().getDocument(),a=e.getTarget().getDocument().getDocumentElement(),i=!n.equals(CKEDITOR.document),n=n.getWindow().getScrollPosition(),u=i?e.$.clientX:e.$.pageX||n.x+e.$.clientX,c=i?e.$.clientY:e.$.pageY||n.y+e.$.clientY;CKEDITOR.tools.setTimeout(function(){this.open(a,null,u,c)},CKEDITOR.env.ie?200:0,this)}},this),CKEDITOR.env.opera&&e.on("keypress",function(e){e=e.data,0===e.$.keyCode&&e.preventDefault()}),CKEDITOR.env.webkit){var o,a=function(){o=0};e.on("keydown",function(e){o=CKEDITOR.env.mac?e.data.$.metaKey:e.data.$.ctrlKey}),e.on("keyup",a),e.on("contextmenu",a)}},open:function(e,t,n,o){this.editor.focus(),e=e||CKEDITOR.document.getDocumentElement(),this.editor.selectionChange(1),this.show(e,t,n,o)}}})},beforeInit:function(e){var t=e.contextMenu=new CKEDITOR.plugins.contextMenu(e);e.on("contentDom",function(){t.addTarget(e.editable(),!1!==e.config.browserContextMenuOnCtrl)}),e.addCommand("contextMenu",{exec:function(){e.contextMenu.open(e.document.getBody())}}),e.setKeystroke(CKEDITOR.SHIFT+121,"contextMenu"),e.setKeystroke(CKEDITOR.CTRL+CKEDITOR.SHIFT+121,"contextMenu")}});