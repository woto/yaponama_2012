!function(){function e(e,t,i){return u(t)&&u(i)&&i.equals(t.getNext(function(e){return!(W(e)||X(e)||d(e))}))}function t(e){this.upper=e[0],this.lower=e[1],this.set.apply(this,e.slice(2))}function i(e){var t,i=e.element;return i&&u(i)?!(t=i.getAscendant(e.triggers,!0))||t.contains(e.editable)||t.equals(e.editable)?null:t:null}function n(e,t,i){return y(e,t),y(e,i),e=t.size.bottom,i=i.size.top,e&&i?0|(e+i)/2:e||i}function o(e,t,i){return t=t[i?"getPrevious":"getNext"](function(t){return t&&t.type==CKEDITOR.NODE_TEXT&&!W(t)||u(t)&&!d(t)&&!s(e,t)})}function r(e){var t=e.doc,i=I('<span contenteditable="false" style="'+F+"position:absolute;border-top:1px dashed "+e.boxColor+'"></span>',t),n=this.path+"images/"+(D.hidpi?"hidpi/":"")+"icon.png";for(v(i,{attach:function(){return this.wrap.getParent()||this.wrap.appendTo(e.editable,!0),this},lineChildren:[v(I('<span title="'+e.editor.lang.magicline.title+'" contenteditable="false">&#8629;</span>',t),{base:F+"height:17px;width:17px;"+(e.rtl?"left":"right")+":17px;background:url("+n+") center no-repeat "+e.boxColor+";cursor:pointer;"+(D.hc?"font-size: 15px;line-height:14px;border:1px solid #fff;text-align:center;":"")+(D.hidpi?"background-size: 9px 10px;":""),looks:["top:-8px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px",1),"top:-17px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","2px 2px 0px 0px",1),"top:-1px;"+CKEDITOR.tools.cssVendorPrefix("border-radius","0px 0px 2px 2px",1)]}),v(I(H,t),{base:B+"left:0px;border-left-color:"+e.boxColor+";",looks:["border-width:8px 0 8px 8px;top:-8px","border-width:8px 0 0 8px;top:-8px","border-width:0 0 8px 8px;top:0px"]}),v(I(H,t),{base:B+"right:0px;border-right-color:"+e.boxColor+";",looks:["border-width:8px 8px 8px 0;top:-8px","border-width:8px 8px 0 0;top:-8px","border-width:0 8px 8px 0;top:0px"]})],detach:function(){return this.wrap.getParent()&&this.wrap.remove(),this},mouseNear:function(){y(e,this);var t=e.holdDistance,i=this.size;return i&&e.mouse.y>i.top-t&&e.mouse.y<i.bottom+t&&e.mouse.x>i.left-t&&e.mouse.x<i.right+t?!0:!1},place:function(){var t=e.view,i=e.editable,n=e.trigger,o=n.upper,r=n.lower,l=o||r,a=l.getParent(),s={};this.trigger=n,o&&y(e,o,!0),r&&y(e,r,!0),y(e,a,!0),e.inInlineMode&&x(e,!0),a.equals(i)?(s.left=t.scroll.x,s.right=-t.scroll.x,s.width=""):(s.left=l.size.left-l.size.margin.left+t.scroll.x-(e.inInlineMode?t.editable.left+t.editable.border.left:0),s.width=l.size.outerWidth+l.size.margin.left+l.size.margin.right+t.scroll.x,s.right=""),o&&r?s.top=o.size.margin.bottom===r.size.margin.top?0|o.size.bottom+o.size.margin.bottom/2:o.size.margin.bottom<r.size.margin.top?o.size.bottom+o.size.margin.bottom:o.size.bottom+o.size.margin.bottom-r.size.margin.top:o?r||(s.top=o.size.bottom+o.size.margin.bottom):s.top=r.size.top-r.size.margin.top,n.is(M)||s.top>t.scroll.y-15&&s.top<t.scroll.y+5?(s.top=e.inInlineMode?0:t.scroll.y,this.look(M)):n.is(K)||s.top>t.pane.bottom-5&&s.top<t.pane.bottom+15?(s.top=e.inInlineMode?t.editable.height+t.editable.padding.top+t.editable.padding.bottom:t.pane.bottom-1,this.look(K)):(e.inInlineMode&&(s.top-=t.editable.top+t.editable.border.top),this.look(L)),e.inInlineMode&&(s.top--,s.top+=t.editable.scroll.top,s.left+=t.editable.scroll.left);for(var u in s)s[u]=CKEDITOR.tools.cssLength(s[u]);this.setStyles(s)},look:function(e){if(this.oldLook!=e){for(var t,i=this.lineChildren.length;i--;)(t=this.lineChildren[i]).setAttribute("style",t.base+t.looks[0|e/2]);this.oldLook=e}},wrap:new T("span",e.doc)}),t=i.lineChildren.length;t--;)i.lineChildren[t].appendTo(i);i.look(L),i.appendTo(i.wrap),i.unselectable(),i.lineChildren[0].on("mouseup",function(t){i.detach(),l(e,function(t){var i=e.line.trigger;t[i.is(R)?"insertBefore":"insertAfter"](i.is(R)?i.lower:i.upper)},!0),e.editor.focus(),!D.ie&&e.enterMode!=CKEDITOR.ENTER_BR&&e.hotNode.scrollIntoView(),t.data.preventDefault(!0)}),i.on("mousedown",function(e){e.data.preventDefault(!0)}),e.line=i}function l(e,t,i){var n,o=new CKEDITOR.dom.range(e.doc),r=e.editor;D.ie&&e.enterMode==CKEDITOR.ENTER_BR?n=e.doc.createText(S):(n=new T(e.enterBehavior,e.doc),e.enterMode!=CKEDITOR.ENTER_BR&&e.doc.createText(S).appendTo(n)),i&&r.fire("saveSnapshot"),t(n),o.moveToPosition(n,CKEDITOR.POSITION_AFTER_START),r.getSelection().selectRanges([o]),e.hotNode=n,i&&r.fire("saveSnapshot")}function a(e,t){return{canUndo:!0,modes:{wysiwyg:1},exec:function(){function n(i){var n=D.ie&&9>D.version?" ":S,o=e.hotNode&&e.hotNode.getText()==n&&e.element.equals(e.hotNode)&&e.lastCmdDirection===!!t;l(e,function(n){o&&e.hotNode&&e.hotNode.remove(),n[t?"insertAfter":"insertBefore"](i),n.setAttributes({"data-cke-magicline-hot":1,"data-cke-magicline-dir":!!t}),e.lastCmdDirection=!!t}),!D.ie&&e.enterMode!=CKEDITOR.ENTER_BR&&e.hotNode.scrollIntoView(),e.line.detach()}return function(r){if(r=r.getSelection().getStartElement(),r=r.getAscendant(q,1),!g(e,r)&&r&&!r.equals(e.editable)&&!r.contains(e.editable)){e.element=r;var l,a=o(e,r,!t);u(a)&&a.is(e.triggers)&&a.is($)&&(!o(e,a,!t)||(l=o(e,a,!t))&&u(l)&&l.is(e.triggers))?n(a):(l=i(e,r),u(l)&&(o(e,l,!t)?(r=o(e,l,!t))&&u(r)&&r.is(e.triggers)&&n(l):n(l)))}}}()}}function s(e,t){if(!t||t.type!=CKEDITOR.NODE_ELEMENT||!t.$)return!1;var i=e.line;return i.wrap.equals(t)||i.wrap.contains(t)}function u(e){return e&&e.type==CKEDITOR.NODE_ELEMENT&&e.$}function d(e){if(!u(e))return!1;var t;return(t=c(e))||(u(e)?(t={left:1,right:1,center:1},t=!(!t[e.getComputedStyle("float")]&&!t[e.getAttribute("align")])):t=!1),t}function c(e){return!!{absolute:1,fixed:1,relative:1}[e.getComputedStyle("position")]}function p(e,t){return u(t)?t.is(e.triggers):null}function g(e,t){if(!t)return!1;for(var i=t.getParents(1),n=i.length;n--;)for(var o=e.tabuList.length;o--;)if(i[n].hasAttribute(e.tabuList[o]))return!0;return!1}function h(e,t,i){return(t=t[i?"getLast":"getFirst"](function(t){return e.isRelevant(t)&&!t.is(_)}))?(y(e,t),i?t.size.top>e.mouse.y:t.size.bottom<e.mouse.y):!1}function f(e){var i=e.editable,n=e.mouse,o=e.view,r=e.triggerOffset;x(e);var l=n.y>(e.inInlineMode?o.editable.top+o.editable.height/2:Math.min(o.editable.height,o.pane.height)/2),i=i[l?"getLast":"getFirst"](function(e){return!(W(e)||X(e))});return i?(s(e,i)&&(i=e.line.wrap[l?"getPrevious":"getNext"](function(e){return!(W(e)||X(e))})),u(i)&&!d(i)&&p(e,i)?(y(e,i),!l&&0<=i.size.top&&0<n.y&&n.y<i.size.top+r?(e=e.inInlineMode||0===o.scroll.y?M:L,new t([null,i,R,N,e])):l&&i.size.bottom<=o.pane.height&&n.y>i.size.bottom-r&&n.y<o.pane.height?(e=e.inInlineMode||i.size.bottom>o.pane.height-r&&i.size.bottom<o.pane.height?K:L,new t([i,null,z,N,e])):null):null):null}function m(e){var n=e.mouse,r=e.view,l=e.triggerOffset,a=i(e);if(!a)return null;y(e,a);var s,c,l=Math.min(l,0|a.size.outerHeight/2),g=[];if(n.y>a.size.top-1&&n.y<a.size.top+l)c=!1;else{if(!(n.y>a.size.bottom-l&&n.y<a.size.bottom+1))return null;c=!0}if(d(a)||h(e,a,c)||a.getParent().is(P))return null;var f=o(e,a,!c);if(f){if(f&&f.type==CKEDITOR.NODE_TEXT)return null;if(u(f)){if(d(f)||!p(e,f)||f.getParent().is(P))return null;g=[f,a][c?"reverse":"concat"]().concat([O,N])}}else a.equals(e.editable[c?"getLast":"getFirst"](e.isRelevant))?(x(e),c&&n.y>a.size.bottom-l&&n.y<r.pane.height&&a.size.bottom>r.pane.height-l&&a.size.bottom<r.pane.height?s=K:0<n.y&&n.y<a.size.top+l&&(s=M)):s=L,g=[null,a][c?"reverse":"concat"]().concat([c?z:R,N,s,a.equals(e.editable[c?"getLast":"getFirst"](e.isRelevant))?c?K:M:L]);return 0 in g?new t(g):null}function b(e,t,i,n){for(var o=function(){var i=D.ie?t.$.currentStyle:e.win.$.getComputedStyle(t.$,"");return D.ie?function(e){return i[CKEDITOR.tools.cssStyleToDomStyle(e)]}:function(e){return i.getPropertyValue(e)}}(),r=t.getDocumentPosition(),l={},a={},s={},u={},d=Y.length;d--;)l[Y[d]]=parseInt(o("border-"+Y[d]+"-width"),10)||0,s[Y[d]]=parseInt(o("padding-"+Y[d]),10)||0,a[Y[d]]=parseInt(o("margin-"+Y[d]),10)||0;return(!i||n)&&w(e,n),u.top=r.y-(i?0:e.view.scroll.y),u.left=r.x-(i?0:e.view.scroll.x),u.outerWidth=t.$.offsetWidth,u.outerHeight=t.$.offsetHeight,u.height=u.outerHeight-(s.top+s.bottom+l.top+l.bottom),u.width=u.outerWidth-(s.left+s.right+l.left+l.right),u.bottom=u.top+u.outerHeight,u.right=u.left+u.outerWidth,e.inInlineMode&&(u.scroll={top:t.$.scrollTop,left:t.$.scrollLeft}),v({border:l,padding:s,margin:a,ignoreScroll:i},u,!0)}function y(e,t,i){if(!u(t))return t.size=null;if(t.size){if(t.size.ignoreScroll==i&&t.size.date>new Date-A)return null}else t.size={};return v(t.size,b(e,t,i),{date:+new Date},!0)}function x(e,t){e.view.editable=b(e,e.editable,t,!0)}function w(e,t){e.view||(e.view={});var i=e.view;if(t||!(i&&i.date>new Date-A)){var n=e.win,i=n.getScrollPosition(),n=n.getViewPaneSize();v(e.view,{scroll:{x:i.x,y:i.y,width:e.doc.$.documentElement.scrollWidth-n.width,height:e.doc.$.documentElement.scrollHeight-n.height},pane:{width:n.width,height:n.height,bottom:n.height+i.y},date:+new Date},!0)}}function E(e,i,n,o){for(var r=o,l=o,a=0,s=!1,u=!1,d=e.view.pane.height,c=e.mouse;c.y+a<d&&0<c.y-a&&(s||(s=i(r,o)),u||(u=i(l,o)),!s&&0<c.y-a&&(r=n(e,{x:c.x,y:c.y-a})),!u&&c.y+a<d&&(l=n(e,{x:c.x,y:c.y+a})),!s||!u);)a+=2;return new t([r,l,null,null])}CKEDITOR.plugins.add("magicline",{lang:"ar,bg,ca,cs,cy,de,el,en,eo,es,et,eu,fa,fi,fr,fr-ca,gl,he,hr,hu,id,it,ja,ko,ku,lv,nb,nl,no,pl,pt,pt-br,ru,si,sk,sl,sq,sv,tr,ug,uk,vi,zh-cn",init:function(e){var n={};n[CKEDITOR.ENTER_BR]="br",n[CKEDITOR.ENTER_P]="p",n[CKEDITOR.ENTER_DIV]="div";var p,h,y,E=e.config,T=E.magicline_triggerOffset||30,I=E.enterMode,R={editor:e,enterBehavior:n[I],enterMode:I,triggerOffset:T,holdDistance:0|T*(E.magicline_holdDistance||.5),boxColor:E.magicline_color||"#ff0000",rtl:"rtl"==E.contentsLangDirection,tabuList:["data-widget-wrapper"].concat(E.magicline_tabuList||[]),triggers:E.magicline_everywhere?q:{table:1,hr:1,div:1,ul:1,ol:1,dl:1,form:1,blockquote:1}};R.isRelevant=function(e){return u(e)&&!s(R,e)&&!d(e)},e.on("contentDom",function(){var n=e.editable(),u=e.document,d=e.window;v(R,{editable:n,inInlineMode:n.isInline(),doc:u,win:d},!0),R.boundary=R.inInlineMode?R.editable:R.doc.getDocumentElement(),n.is(C.$inline)||(R.inInlineMode&&!c(n)&&n.setStyles({position:"relative",top:null,left:null}),r.call(this,R),w(R),n.attachListener(e,"beforeUndoImage",function(){R.line.detach()}),n.attachListener(e,"beforeGetData",function(){R.line.wrap.getParent()&&(R.line.detach(),e.once("getData",function(){R.line.attach()},null,null,1e3))},null,null,0),n.attachListener(R.inInlineMode?u:u.getWindow().getFrame(),"mouseout",function(t){if("wysiwyg"==e.mode)if(R.inInlineMode){var i=t.data.$.clientX,t=t.data.$.clientY;w(R),x(R,!0);var n=R.view.editable,o=R.view.scroll;i>n.left-o.x&&i<n.right-o.x&&t>n.top-o.y&&t<n.bottom-o.y||(clearTimeout(y),y=null,R.line.detach())}else clearTimeout(y),y=null,R.line.detach()}),n.attachListener(n,"keyup",function(){R.hiddenMode=0}),n.attachListener(n,"keydown",function(t){if("wysiwyg"==e.mode)switch(t=t.data.getKeystroke(),e.getSelection().getStartElement(),t){case 2228240:case 16:R.hiddenMode=1,R.line.detach()}}),n.attachListener(R.inInlineMode?n:u,"mousemove",function(t){if(h=!0,"wysiwyg"==e.mode&&!e.readOnly&&!y){var i={x:t.data.$.clientX,y:t.data.$.clientY};y=setTimeout(function(){R.mouse=i,y=R.trigger=null,w(R),h&&!R.hiddenMode&&e.focusManager.hasFocus&&!R.line.mouseNear()&&(R.element=V(R,!0))&&((R.trigger=f(R)||m(R)||U(R))&&!g(R,R.trigger.upper||R.trigger.lower)?R.line.attach().place():(R.trigger=null,R.line.detach()),h=!1)},30)}}),n.attachListener(d,"scroll",function(){"wysiwyg"==e.mode&&(R.line.detach(),D.webkit&&(R.hiddenMode=1,clearTimeout(p),p=setTimeout(function(){R.hiddenMode=0},50)))}),n.attachListener(d,"mousedown",function(){"wysiwyg"==e.mode&&(R.line.detach(),R.hiddenMode=1)}),n.attachListener(d,"mouseup",function(){R.hiddenMode=0}),e.addCommand("accessPreviousSpace",a(R)),e.addCommand("accessNextSpace",a(R,!0)),e.setKeystroke([[E.magicline_keystrokePrevious,"accessPreviousSpace"],[E.magicline_keystrokeNext,"accessNextSpace"]]),e.on("loadSnapshot",function(){for(var t,i=e.document.getElementsByTag(R.enterBehavior),n=i.count();n--;)if((t=i.getItem(n)).hasAttribute("data-cke-magicline-hot")){R.hotNode=t,R.lastCmdDirection="true"===t.getAttribute("data-cke-magicline-dir")?!0:!1;break}}),this.backdoor={accessFocusSpace:l,boxTrigger:t,isLine:s,getAscendantTrigger:i,getNonEmptyNeighbour:o,getSize:b,that:R,triggerEdge:m,triggerEditable:f,triggerExpand:U})},this)}});var v=CKEDITOR.tools.extend,T=CKEDITOR.dom.element,I=T.createFromHtml,D=CKEDITOR.env,C=CKEDITOR.dtd,R=128,z=64,O=32,N=16,k=8,M=4,K=2,L=1,S=" ",P=C.$listItem,_=C.$tableContent,$=v({},C.$nonEditable,C.$empty),q=C.$block,A=100,F="width:0px;height:0px;padding:0px;margin:0px;display:block;z-index:9999;color:#fff;position:absolute;font-size: 0px;line-height:0px;",B=F+"border-color:transparent;display:block;border-style:solid;",H="<span>"+S+"</span>";t.prototype={set:function(e,t,i){return this.properties=e+t+(i||L),this},is:function(e){return(this.properties&e)==e}};var V=function(){return function(e,t,i){if(!e.mouse)return null;var n=e.doc,o=e.line.wrap,i=i||e.mouse,r=new CKEDITOR.dom.element(n.$.elementFromPoint(i.x,i.y));return t&&s(e,r)&&(o.hide(),r=new CKEDITOR.dom.element(n.$.elementFromPoint(i.x,i.y)),o.show()),!r||r.type!=CKEDITOR.NODE_ELEMENT||!r.$||D.ie&&9>D.version&&!e.boundary.equals(r)&&!e.boundary.contains(r)?null:r}}(),W=CKEDITOR.dom.walker.whitespaces(),X=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_COMMENT),U=function(){function t(t){var o,r,l,a=t.element;if(!u(a)||a.contains(t.editable))return null;if(l=E(t,function(e,t){return!t.equals(e)},function(e,t){return V(e,!0,t)},a),o=l.upper,r=l.lower,e(t,o,r))return l.set(O,k);if(o&&a.contains(o))for(;!o.getParent().equals(a);)o=o.getParent();else o=a.getFirst(function(e){return i(t,e)});if(r&&a.contains(r))for(;!r.getParent().equals(a);)r=r.getParent();else r=a.getLast(function(e){return i(t,e)});if(!o||!r)return null;if(y(t,o),y(t,r),!(t.mouse.y>o.size.top&&t.mouse.y<r.size.bottom))return null;for(var s,d,c,p,a=Number.MAX_VALUE;r&&!r.equals(o)&&(d=o.getNext(t.isRelevant));)s=Math.abs(n(t,o,d)-t.mouse.y),a>s&&(a=s,c=o,p=d),o=d,y(t,o);return c&&p&&t.mouse.y>c.size.top&&t.mouse.y<p.size.bottom?(l.upper=c,l.lower=p,l.set(O,k)):null}function i(e,t){return!(t&&t.type==CKEDITOR.NODE_TEXT||X(t)||d(t)||s(e,t)||t.type==CKEDITOR.NODE_ELEMENT&&t.$&&t.is("br"))}return function(i){var n,o=t(i);if(n=o){n=o.upper;var r=o.lower;n=!n||!r||d(r)||d(n)||r.equals(n)||n.equals(r)||r.contains(n)||n.contains(r)?!1:p(i,n)&&p(i,r)&&e(i,n,r)?!0:!1}return n?o:null}}(),Y=["top","left","right","bottom"]}(),CKEDITOR.config.magicline_keystrokePrevious=CKEDITOR.CTRL+CKEDITOR.SHIFT+219,CKEDITOR.config.magicline_keystrokeNext=CKEDITOR.CTRL+CKEDITOR.SHIFT+221;