<div rel="type-store">

  <%= content_tag :div, class: @somebody.postal_addresses.size > 1 ? '' : 'hidden' do %>
    <% f.twbs_collection_radio_buttons :postal_address_type, [['new', 'Добавить новый'] ,['old', 'Выбрать ранее добавленный']], :first, :last, {variation: :vertical, label: false}, rel: 'radio radio-new-old-switcher' %>
  <% end %>

  <div rel="old">
    <%= f.twbs_collection_select :old_postal_address_id, @somebody.postal_addresses.where.not(postal_addresses: {id: nil}), :id, :to_label, { label: false, include_blank: true }, rel: "select select-and-fill"  %>

    <% @somebody.postal_addresses.where.not(postal_addresses: {id: nil}).each do |postal_address| %>
      <div id="select-and-fill-<%= postal_address.id %>" class="select-and-fill">

        <div class="well">

          <% if f.object.old_postal_address_id == postal_address.id %>

            <%= f.fields_for :old_postal_address do |postal_address| %>
              <%= render 'postal_addresses/fields', f: postal_address %>
            <% end %>

          <% else %>

            <%= f.fields_for :old_postal_address, postal_address do |p| %>
              <%= render 'postal_addresses/fields', f: p %>
            <% end %>

          <% end %>

        </div>

      </div>

    <% end %>

  </div>


  <div rel="new">
    <div class="well">

      <%= f.fields_for :new_postal_address do |postal_address| %>
        <!--<div class="select-and-fill"> -->
          <%= render 'postal_addresses/fields', f: postal_address %>
        <!-- </div> -->
      <% end %>

    </div>
  </div>

</div>
