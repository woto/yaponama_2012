!function(){function e(e,o){var r;return"string"==typeof e?(r=e.charAt(0),e=new RegExp("^"+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o?"i":"")):e=new RegExp("^(?:"+e.source+")",e.ignoreCase?"i":""),"string"==typeof e?{token:function(o){return o.match(e)?"searching":(o.next(),void(o.skipTo(e.charAt(0))||o.skipToEnd()))}}:{token:function(o){if(o.match(e))return"searching";for(;!o.eol()&&(o.next(),r&&(o.skipTo(r)||o.skipToEnd()),!o.match(e,!1)););}}}function o(){this.posFrom=this.posTo=this.query=null,this.overlay=null}function r(e){return e.state.search||(e.state.search=new o)}function n(e){return"string"==typeof e&&e==e.toLowerCase()}function t(e,o,r){return e.getSearchCursor(o,r,n(o))}function i(e,o,r,n,t){e.openDialog?e.openDialog(o,t,{value:n}):t(prompt(r,n))}function c(e,o,r,n){e.openConfirm?e.openConfirm(o,n):confirm(r)&&n[0]()}function a(e){var o=e.match(/^\/(.*)\/([a-z]*)$/);return o?new RegExp(o[1],-1==o[2].indexOf("i")?"":"i"):e}function f(o,t){var c=r(o);return c.query?u(o,t):void i(o,l,"Search for:",o.getSelection(),function(r){o.operation(function(){r&&!c.query&&(c.query=a(r),o.removeOverlay(c.overlay,n(c.query)),c.overlay=e(c.query),o.addOverlay(c.overlay),c.posFrom=c.posTo=o.getCursor(),u(o,t))})})}function u(e,o){e.operation(function(){var n=r(e),i=t(e,n.query,o?n.posFrom:n.posTo);(i.find(o)||(i=t(e,n.query,o?CodeMirror.Pos(e.lastLine()):CodeMirror.Pos(e.firstLine(),0)),i.find(o)))&&(e.setSelection(i.from(),i.to()),e.scrollIntoView({from:i.from(),to:i.to()}),n.posFrom=i.from(),n.posTo=i.to())})}function s(e){e.operation(function(){var o=r(e);o.query&&(o.query=null,e.removeOverlay(o.overlay))})}function p(e,o){i(e,m,"Replace:",e.getSelection(),function(r){r&&(r=a(r),i(e,d,"Replace with:","",function(n){if(o)e.operation(function(){for(var o=t(e,r);o.findNext();)if("string"!=typeof r){var i=e.getRange(o.from(),o.to()).match(r);o.replace(n.replace(/\$(\d)/,function(e,o){return i[o]}))}else o.replace(n)});else{s(e);var i=t(e,r,e.getCursor()),a=function(){var o,n=i.from();!(o=i.findNext())&&(i=t(e,r),!(o=i.findNext())||n&&i.from().line==n.line&&i.from().ch==n.ch)||(e.setSelection(i.from(),i.to()),e.scrollIntoView({from:i.from(),to:i.to()}),c(e,y,"Replace?",[function(){f(o)},a]))},f=function(e){i.replace("string"==typeof r?n:n.replace(/\$(\d)/,function(o,r){return e[r]})),a()};a()}}))})}var l='Search: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',m='Replace: <input type="text" style="width: 10em"/> <span style="color: #888">(Use /re/ syntax for regexp search)</span>',d='With: <input type="text" style="width: 10em"/>',y="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";CodeMirror.commands.find=function(e){s(e),f(e)},CodeMirror.commands.findNext=f,CodeMirror.commands.findPrev=function(e){f(e,!0)},CodeMirror.commands.clearSearch=s,CodeMirror.commands.replace=p,CodeMirror.commands.replaceAll=function(e){p(e,!0)}}();