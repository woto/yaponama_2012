/*
 * JsSIP version 0.3.7
 * Copyright (c) 2012-2014 José Luis Millán - Versatica <http://www.versatica.com>
 * Homepage: http://jssip.net
 * License: http://jssip.net/license
 */
!function(window){var JsSIP=function(){"use strict";var JsSIP={};return Object.defineProperties(JsSIP,{version:{get:function(){return"0.3.7"}},name:{get:function(){return"JsSIP"}}}),JsSIP}();!function(JsSIP){var EventEmitter,Event,LOG_PREFIX=JsSIP.name+" | EVENT EMITTER | ";EventEmitter=function(){},EventEmitter.prototype={initEvents:function(events){var i=events.length;for(this.events={},this.onceNotFired=[],this.maxListeners=10,this.events.newListener=function(event){console.log(LOG_PREFIX+"new listener added to event "+event)};i--;)console.log(LOG_PREFIX+"adding event "+events[i]),this.events[events[i]]=[]},checkEvent:function(event){return this.events[event]?!0:(console.error(LOG_PREFIX+"no event named "+event),!1)},addListener:function(event,listener){this.checkEvent(event)&&(this.events[event].length>=this.maxListeners&&console.warn(LOG_PREFIX+"max listeners exceeded for event "+event),this.events[event].push(listener),this.events.newListener.call(null,event))},on:function(event,listener){this.addListener(event,listener)},once:function(event,listener){this.events[event].unshift(listener),this.onceNotFired.push(event)},removeListener:function(event,listener){if(this.checkEvent(event))for(var array=this.events[event],i=0,length=array.length;length>i;)array[i]&&array[i].toString()===listener.toString()?array.splice(i,1):i++},removeAllListener:function(event){this.checkEvent(event)&&(this.events[event]=[])},setMaxListeners:function(listeners){Number(listeners)&&(this.maxListeners=listeners)},listeners:function(event){return this.events[event]},emit:function(event,sender,data){var listeners,length,emitter=this;if(this.checkEvent(event)){console.log(LOG_PREFIX+"emitting event "+event),listeners=this.events[event],length=listeners.length;var e=new JsSIP.Event(event,sender,data);window.setTimeout(function(){var idx=0;for(idx;length>idx;idx++)listeners[idx].call(null,e);idx=emitter.onceNotFired.indexOf(event),-1!==idx&&(emitter.onceNotFired.splice(idx,1),emitter.events[event].shift())},0)}},newListener:function(listener){this.events.newListener=listener}},Event=function(type,sender,data){this.type=type,this.sender=sender,this.data=data},JsSIP.EventEmitter=EventEmitter,JsSIP.Event=Event}(JsSIP),JsSIP.C={USER_AGENT:JsSIP.name+" "+JsSIP.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(JsSIP){var Exceptions;Exceptions={ConfigurationError:function(){var exception=function(parameter,value){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=parameter,this.value=value,this.message=this.value?"Invalid value "+window.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return exception.prototype=new Error,exception}(),InvalidTargetError:function(){var exception=function(target){this.code=2,this.name="INVALID_TARGET_ERROR",this.target=target,this.message="Invalid target: "+this.target};return exception.prototype=new Error,exception}(),InvalidStateError:function(){var exception=function(status){this.code=3,this.name="INVALID_STATE_ERROR",this.status=status};return exception.prototype=new Error,exception}()},JsSIP.Exceptions=Exceptions}(JsSIP),function(JsSIP){var Timers,T1=500,T2=4e3,T4=5e3;Timers={T1:T1,T2:T2,T4:T4,TIMER_B:64*T1,TIMER_D:0*T1,TIMER_F:64*T1,TIMER_H:64*T1,TIMER_I:0*T1,TIMER_J:0*T1,TIMER_K:0*T4,TIMER_L:64*T1,TIMER_M:64*T1,PROVISIONAL_RESPONSE_INTERVAL:6e4},JsSIP.Timers=Timers}(JsSIP),function(JsSIP){var Transport,LOG_PREFIX=JsSIP.name+" | TRANSPORT | ",C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};Transport=function(ua,server){this.ua=ua,this.ws=null,this.server=server,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.ua.transport=this,this.connect()},Transport.prototype={send:function(msg){var message=msg.toString();return this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ua.configuration.trace_sip===!0&&console.log(LOG_PREFIX+"sending WebSocket message:\n\n"+message+"\n"),this.ws.send(message),!0):(console.warn(LOG_PREFIX+"unable to send message, WebSocket is not open"),!1)},disconnect:function(){this.ws&&(window.clearTimeout(this.reconnectTimer),this.closed=!0,console.log(LOG_PREFIX+"closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var transport=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return console.log(LOG_PREFIX+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),console.log(LOG_PREFIX+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(e){console.warn(LOG_PREFIX+"error connecting to WebSocket "+this.server.ws_uri+": "+e)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){transport.onOpen()},this.ws.onclose=function(e){transport.onClose(e)},this.ws.onmessage=function(e){transport.onMessage(e)},this.ws.onerror=function(e){transport.onError(e)}},onOpen:function(){this.connected=!0,console.log(LOG_PREFIX+"WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(e){var connected_before=this.connected;this.connected=!1,this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,console.log(LOG_PREFIX+"WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),e.wasClean===!1&&console.warn(LOG_PREFIX+"WebSocket abrupt disconnection"),connected_before===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reConnect()):this.ua.onTransportError(this)},onMessage:function(e){var message,transaction,data=e.data;if("\r\n"===data)return void(this.ua.configuration.trace_sip===!0&&console.log(LOG_PREFIX+"received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof data){try{data=String.fromCharCode.apply(null,new Uint8Array(data))}catch(evt){return void console.warn(LOG_PREFIX+"received WebSocket binary message failed to be converted into string, message discarded")}this.ua.configuration.trace_sip===!0&&console.log(LOG_PREFIX+"received WebSocket binary message:\n\n"+data+"\n")}else this.ua.configuration.trace_sip===!0&&console.log(LOG_PREFIX+"received WebSocket text message:\n\n"+data+"\n");if(message=JsSIP.Parser.parseMessage(data),!(this.ua.status===JsSIP.UA.C.STATUS_USER_CLOSED&&message instanceof JsSIP.IncomingRequest)&&message&&JsSIP.sanityCheck(message,this.ua,this))if(message instanceof JsSIP.IncomingRequest)message.transport=this,this.ua.receiveRequest(message);else if(message instanceof JsSIP.IncomingResponse)switch(message.method){case JsSIP.C.INVITE:transaction=this.ua.transactions.ict[message.via_branch],transaction&&transaction.receiveResponse(message);break;case JsSIP.C.ACK:break;default:transaction=this.ua.transactions.nict[message.via_branch],transaction&&transaction.receiveResponse(message)}},onError:function(e){console.warn(LOG_PREFIX+"WebSocket connection error: "+e)},reConnect:function(){var transport=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(LOG_PREFIX+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(LOG_PREFIX+"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=window.setTimeout(function(){transport.connect(),transport.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}},Transport.C=C,JsSIP.Transport=Transport}(JsSIP),function(JsSIP){function getHeader(data,headerStart){var start=headerStart,end=0,partialEnd=0;if(data.substring(start,start+2).match(/(^\r\n)/))return-2;for(;0===end;){if(partialEnd=data.indexOf("\r\n",start),-1===partialEnd)return partialEnd;!data.substring(partialEnd+2,partialEnd+4).match(/(^\r\n)/)&&data.charAt(partialEnd+2).match(/(^\s+)/)?start=partialEnd+2:end=partialEnd}return end}function parseHeader(message,data,headerStart,headerEnd){var header,idx,length,parsed,hcolonIndex=data.indexOf(":",headerStart),headerName=data.substring(headerStart,hcolonIndex).trim(),headerValue=data.substring(hcolonIndex+1,headerEnd).trim();switch(headerName.toLowerCase()){case"via":case"v":message.addHeader("via",headerValue),1===message.countHeader("via")?(parsed=message.parseHeader("Via"),parsed&&(message.via=parsed,message.via_branch=parsed.branch)):parsed=0;break;case"from":case"f":message.setHeader("from",headerValue),parsed=message.parseHeader("from"),parsed&&(message.from=parsed,message.from_tag=parsed.getParam("tag"));break;case"to":case"t":message.setHeader("to",headerValue),parsed=message.parseHeader("to"),parsed&&(message.to=parsed,message.to_tag=parsed.getParam("tag"));break;case"record-route":for(parsed=JsSIP.Grammar.parse(headerValue,"Record_Route"),-1===parsed&&(parsed=void 0),length=parsed.length,idx=0;length>idx;idx++)header=parsed[idx],message.addHeader("record-route",headerValue.substring(header.possition,header.offset)),message.headers["Record-Route"][message.countHeader("record-route")-1].parsed=header.parsed;break;case"call-id":case"i":message.setHeader("call-id",headerValue),parsed=message.parseHeader("call-id"),parsed&&(message.call_id=headerValue);break;case"contact":case"m":for(parsed=JsSIP.Grammar.parse(headerValue,"Contact"),-1===parsed&&(parsed=void 0),length=parsed.length,idx=0;length>idx;idx++)header=parsed[idx],message.addHeader("contact",headerValue.substring(header.possition,header.offset)),message.headers.Contact[message.countHeader("contact")-1].parsed=header.parsed;break;case"content-length":case"l":message.setHeader("content-length",headerValue),parsed=message.parseHeader("content-length");break;case"content-type":case"c":message.setHeader("content-type",headerValue),parsed=message.parseHeader("content-type");break;case"cseq":message.setHeader("cseq",headerValue),parsed=message.parseHeader("cseq"),parsed&&(message.cseq=parsed.value),message instanceof JsSIP.IncomingResponse&&(message.method=parsed.method);break;case"max-forwards":message.setHeader("max-forwards",headerValue),parsed=message.parseHeader("max-forwards");break;case"www-authenticate":message.setHeader("www-authenticate",headerValue),parsed=message.parseHeader("www-authenticate");break;case"proxy-authenticate":message.setHeader("proxy-authenticate",headerValue),parsed=message.parseHeader("proxy-authenticate");break;default:message.setHeader(headerName,headerValue),parsed=0}return void 0===parsed?!1:!0}var Parser,LOG_PREFIX=JsSIP.name+" | PARSER | ";Parser={},Parser.parseMessage=function(data){var message,firstLine,contentLength,bodyStart,parsed,headerStart=0,headerEnd=data.indexOf("\r\n");if(-1===headerEnd)return void console.warn(LOG_PREFIX+"no CRLF found, not a SIP message, discarded");if(firstLine=data.substring(0,headerEnd),parsed=JsSIP.Grammar.parse(firstLine,"Request_Response"),-1===parsed)return void console.warn(LOG_PREFIX+'error parsing first line of SIP message: "'+firstLine+'"');for(parsed.status_code?(message=new JsSIP.IncomingResponse,message.status_code=parsed.status_code,message.reason_phrase=parsed.reason_phrase):(message=new JsSIP.IncomingRequest,message.method=parsed.method,message.ruri=parsed.uri),message.data=data,headerStart=headerEnd+2;;){if(headerEnd=getHeader(data,headerStart),-2===headerEnd){bodyStart=headerStart+2;break}if(-1===headerEnd)return;if(parsed=parseHeader(message,data,headerStart,headerEnd),!parsed)return;headerStart=headerEnd+2}return message.hasHeader("content-length")?(contentLength=message.getHeader("content-length"),message.body=data.substr(bodyStart,contentLength)):message.body=data.substring(bodyStart),message},JsSIP.Parser=Parser}(JsSIP),function(JsSIP){var OutgoingRequest,IncomingMessage,IncomingRequest,IncomingResponse,LOG_PREFIX=JsSIP.name+" | SIP MESSAGE | ";OutgoingRequest=function(method,ruri,ua,params,extraHeaders,body){var to,from,call_id,cseq;return params=params||{},method&&ruri&&ua?(this.headers={},this.method=method,this.ruri=ruri,this.body=body,this.extraHeaders=extraHeaders||[],params.route_set?this.setHeader("route",params.route_set):ua.configuration.use_preloaded_route&&this.setHeader("route",ua.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",JsSIP.UA.C.MAX_FORWARDS),to=params.to_display_name||0===params.to_display_name?'"'+params.to_display_name+'" ':"",to+="<"+(params.to_uri||ruri)+">",to+=params.to_tag?";tag="+params.to_tag:"",this.to=new JsSIP.NameAddrHeader.parse(to),this.setHeader("to",to),from=params.from_display_name||0===params.from_display_name?'"'+params.from_display_name+'" ':ua.configuration.display_name?'"'+ua.configuration.display_name+'" ':"",from+="<"+(params.from_uri||ua.configuration.uri)+">;tag=",from+=params.from_tag||JsSIP.Utils.newTag(),this.from=new JsSIP.NameAddrHeader.parse(from),this.setHeader("from",from),call_id=params.call_id||ua.configuration.jssip_id+JsSIP.Utils.createRandomToken(15),this.call_id=call_id,this.setHeader("call-id",call_id),cseq=params.cseq||Math.floor(1e4*Math.random()),this.cseq=cseq,void this.setHeader("cseq",cseq+" "+method)):null},OutgoingRequest.prototype={setHeader:function(name,value){this.headers[JsSIP.Utils.headerize(name)]=value instanceof Array?value:[value]},toString:function(){var header,length,idx,msg="";msg+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(header in this.headers)for(length=this.headers[header].length,idx=0;length>idx;idx++)msg+=header+": "+this.headers[header][idx]+"\r\n";for(length=this.extraHeaders.length,idx=0;length>idx;idx++)msg+=this.extraHeaders[idx]+"\r\n";return msg+="Supported: "+JsSIP.UA.C.SUPPORTED+"\r\n",msg+="User-Agent: "+JsSIP.C.USER_AGENT+"\r\n",this.body?(length=JsSIP.Utils.str_utf8_length(this.body),msg+="Content-Length: "+length+"\r\n\r\n",msg+=this.body):msg+="Content-Length: 0\r\n\r\n",msg}},IncomingMessage=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},IncomingMessage.prototype={addHeader:function(name,value){var header={raw:value};name=JsSIP.Utils.headerize(name),this.headers[name]?this.headers[name].push(header):this.headers[name]=[header]},countHeader:function(name){var header=this.headers[JsSIP.Utils.headerize(name)];return header?header.length:0},getHeader:function(name,idx){var header=this.headers[JsSIP.Utils.headerize(name)];return idx=idx||0,header?header[idx]?header[idx].raw:void 0:void 0},getHeaderAll:function(name){var idx,length,header=this.headers[JsSIP.Utils.headerize(name)],result=[];if(!header)return[];for(length=header.length,idx=0;length>idx;idx++)result.push(header[idx].raw);return result},hasHeader:function(name){return this.headers[JsSIP.Utils.headerize(name)]?!0:!1},parseHeader:function(name,idx){var header,value,parsed;return name=JsSIP.Utils.headerize(name),idx=idx||0,this.headers[name]?idx>=this.headers[name].length?void console.log(LOG_PREFIX+'not so many "'+name+'" headers present'):(header=this.headers[name][idx],value=header.raw,header.parsed?header.parsed:(parsed=JsSIP.Grammar.parse(value,name.replace(/-/g,"_")),-1===parsed?(this.headers[name].splice(idx,1),void console.warn(LOG_PREFIX+'error parsing "'+name+'" header field with value "'+value+'"')):(header.parsed=parsed,parsed))):void console.log(LOG_PREFIX+'header "'+name+'" not present')},s:function(name,idx){return this.parseHeader(name,idx)},setHeader:function(name,value){var header={raw:value};this.headers[JsSIP.Utils.headerize(name)]=[header]},toString:function(){return this.data}},IncomingRequest=function(){this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},IncomingRequest.prototype=new IncomingMessage,IncomingRequest.prototype.reply=function(code,reason,extraHeaders,body,onSuccess,onFailure){var rr,vias,length,idx,response,to=this.getHeader("To"),r=0,v=0;if(code=code||null,reason=reason||null,!code||100>code||code>699)throw new TypeError("Invalid status_code: "+code);if(reason&&"string"!=typeof reason&&!(reason instanceof String))throw new TypeError("Invalid reason_phrase: "+reason);if(reason=reason||JsSIP.C.REASON_PHRASE[code]||"",extraHeaders=extraHeaders||[],response="SIP/2.0 "+code+" "+reason+"\r\n",this.method===JsSIP.C.INVITE&&code>100&&200>=code)for(rr=this.countHeader("record-route"),r;rr>r;r++)response+="Record-Route: "+this.getHeader("record-route",r)+"\r\n";for(vias=this.countHeader("via"),v;vias>v;v++)response+="Via: "+this.getHeader("via",v)+"\r\n";for(!this.to_tag&&code>100?to+=";tag="+JsSIP.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(to+=";tag="+this.to_tag),response+="To: "+to+"\r\n",response+="From: "+this.getHeader("From")+"\r\n",response+="Call-ID: "+this.call_id+"\r\n",response+="CSeq: "+this.cseq+" "+this.method+"\r\n",length=extraHeaders.length,idx=0;length>idx;idx++)response+=extraHeaders[idx]+"\r\n";body?(length=JsSIP.Utils.str_utf8_length(body),response+="Content-Type: application/sdp\r\n",response+="Content-Length: "+length+"\r\n\r\n",response+=body):response+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(code,response,onSuccess,onFailure)},IncomingRequest.prototype.reply_sl=function(code,reason){var to,response,vias=this.countHeader("via");if(code=code||null,reason=reason||null,!code||100>code||code>699)throw new TypeError("Invalid status_code: "+code);if(reason&&"string"!=typeof reason&&!(reason instanceof String))throw new TypeError("Invalid reason_phrase: "+reason);reason=reason||JsSIP.C.REASON_PHRASE[code]||"",response="SIP/2.0 "+code+" "+reason+"\r\n";for(var v=0;vias>v;v++)response+="Via: "+this.getHeader("via",v)+"\r\n";to=this.getHeader("To"),!this.to_tag&&code>100?to+=";tag="+JsSIP.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(to+=";tag="+this.to_tag),response+="To: "+to+"\r\n",response+="From: "+this.getHeader("From")+"\r\n",response+="Call-ID: "+this.call_id+"\r\n",response+="CSeq: "+this.cseq+" "+this.method+"\r\n",response+="Content-Length: 0\r\n\r\n",this.transport.send(response)},IncomingResponse=function(){this.headers={},this.status_code=null,this.reason_phrase=null},IncomingResponse.prototype=new IncomingMessage,JsSIP.OutgoingRequest=OutgoingRequest,JsSIP.IncomingRequest=IncomingRequest,JsSIP.IncomingResponse=IncomingResponse}(JsSIP),function(JsSIP){var URI;URI=function(scheme,user,host,port,parameters,headers){var param,header;if(!host)throw new TypeError('missing or invalid "host" parameter');scheme=scheme||JsSIP.C.SIP,this.parameters={},this.headers={};for(param in parameters)this.setParam(param,parameters[param]);for(header in headers)this.setHeader(header,headers[header]);Object.defineProperties(this,{scheme:{get:function(){return scheme},set:function(value){scheme=value.toLowerCase()}},user:{get:function(){return user},set:function(value){user=value}},host:{get:function(){return host},set:function(value){host=value.toLowerCase()}},port:{get:function(){return port},set:function(value){port=0===value?value:parseInt(value,10)||null}}})},URI.prototype={setParam:function(key,value){key&&(this.parameters[key.toLowerCase()]="undefined"==typeof value||null===value?null:value.toString().toLowerCase())},getParam:function(key){return key?this.parameters[key.toLowerCase()]:void 0},hasParam:function(key){return key?this.parameters.hasOwnProperty(key.toLowerCase())&&!0||!1:void 0},deleteParam:function(parameter){var value;return parameter=parameter.toLowerCase(),this.parameters.hasOwnProperty(parameter)?(value=this.parameters[parameter],delete this.parameters[parameter],value):void 0},clearParams:function(){this.parameters={}},setHeader:function(name,value){this.headers[JsSIP.Utils.headerize(name)]=value instanceof Array?value:[value]},getHeader:function(name){return name?this.headers[JsSIP.Utils.headerize(name)]:void 0},hasHeader:function(name){return name?this.headers.hasOwnProperty(JsSIP.Utils.headerize(name))&&!0||!1:void 0},deleteHeader:function(header){var value;return header=JsSIP.Utils.headerize(header),this.headers.hasOwnProperty(header)?(value=this.headers[header],delete this.headers[header],value):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new URI(this.scheme,this.user,this.host,this.port,window.JSON.parse(window.JSON.stringify(this.parameters)),window.JSON.parse(window.JSON.stringify(this.headers)))},toString:function(){var header,parameter,idx,uri,headers=[];uri=this.scheme+":",this.user&&(uri+=JsSIP.Utils.escapeUser(this.user)+"@"),uri+=this.host,(this.port||0===this.port)&&(uri+=":"+this.port);for(parameter in this.parameters)uri+=";"+parameter,null!==this.parameters[parameter]&&(uri+="="+this.parameters[parameter]);for(header in this.headers)for(idx in this.headers[header])headers.push(header+"="+this.headers[header][idx]);return headers.length>0&&(uri+="?"+headers.join("&")),uri},toAor:function(show_port){var aor;return aor=this.scheme+":",this.user&&(aor+=JsSIP.Utils.escapeUser(this.user)+"@"),aor+=this.host,show_port&&(this.port||0===this.port)&&(aor+=":"+this.port),aor}},URI.parse=function(uri){return uri=JsSIP.Grammar.parse(uri,"SIP_URI"),-1!==uri?uri:void 0},JsSIP.URI=URI}(JsSIP),function(JsSIP){var NameAddrHeader;NameAddrHeader=function(uri,display_name,parameters){var param;if(!(uri&&uri instanceof JsSIP.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=uri,this.parameters={};for(param in parameters)this.setParam(param,parameters[param]);Object.defineProperties(this,{display_name:{get:function(){return display_name},set:function(value){display_name=0===value?"0":value}}})},NameAddrHeader.prototype={setParam:function(key,value){key&&(this.parameters[key.toLowerCase()]="undefined"==typeof value||null===value?null:value.toString())},getParam:function(key){return key?this.parameters[key.toLowerCase()]:void 0},hasParam:function(key){return key?this.parameters.hasOwnProperty(key.toLowerCase())&&!0||!1:void 0},deleteParam:function(parameter){var value;return parameter=parameter.toLowerCase(),this.parameters.hasOwnProperty(parameter)?(value=this.parameters[parameter],delete this.parameters[parameter],value):void 0},clearParams:function(){this.parameters={}},clone:function(){return new NameAddrHeader(this.uri.clone(),this.display_name,window.JSON.parse(window.JSON.stringify(this.parameters)))},toString:function(){var body,parameter;body=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",body+="<"+this.uri.toString()+">";for(parameter in this.parameters)body+=";"+parameter,null!==this.parameters[parameter]&&(body+="="+this.parameters[parameter]);return body}},NameAddrHeader.parse=function(name_addr_header){return name_addr_header=JsSIP.Grammar.parse(name_addr_header,"Name_Addr_Header"),-1!==name_addr_header?name_addr_header:void 0},JsSIP.NameAddrHeader=NameAddrHeader}(JsSIP),function(JsSIP){var Transactions,LOG_PREFIX=JsSIP.name+" | TRANSACTION | ",C={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};Transactions={};var ClientTransaction=function(){this.init=function(request_sender,request,transport){var via;this.transport=transport,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=request_sender,this.request=request,via="SIP/2.0/"+(request_sender.ua.configuration.hack_via_tcp?"TCP":transport.server.scheme),via+=" "+request_sender.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",via)}},NonInviteClientTransactionPrototype=function(){this.send=function(){var tr=this;this.state=C.STATUS_TRYING,this.F=window.setTimeout(function(){tr.timer_F()},JsSIP.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){console.log(LOG_PREFIX+"transport error occurred, deleting non-INVITE client transaction "+this.id),window.clearTimeout(this.F),window.clearTimeout(this.K),delete this.request_sender.ua.transactions.nict[this.id],this.request_sender.onTransportError()},this.timer_F=function(){console.log(LOG_PREFIX+"Timer F expired for non-INVITE client transaction "+this.id),this.state=C.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.nict[this.id]},this.timer_K=function(){this.state=C.STATUS_TERMINATED,delete this.request_sender.ua.transactions.nict[this.id]},this.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(200>status_code)switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.state=C.STATUS_PROCEEDING,this.request_sender.receiveResponse(response)}else switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED,window.clearTimeout(this.F),408===status_code?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(response),this.K=window.setTimeout(function(){tr.timer_K()},JsSIP.Timers.TIMER_K);break;case C.STATUS_COMPLETED:}}};NonInviteClientTransactionPrototype.prototype=new ClientTransaction;var InviteClientTransactionPrototype=function(){this.send=function(){var tr=this;this.state=C.STATUS_CALLING,this.B=window.setTimeout(function(){tr.timer_B()},JsSIP.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){console.log(LOG_PREFIX+"transport error occurred, deleting INVITE client transaction "+this.id),window.clearTimeout(this.B),window.clearTimeout(this.D),window.clearTimeout(this.M),delete this.request_sender.ua.transactions.ict[this.id],this.state!==C.STATUS_ACCEPTED&&this.request_sender.onTransportError()},this.timer_M=function(){console.log(LOG_PREFIX+"Timer M expired for INVITE client transaction "+this.id),this.state===C.STATUS_ACCEPTED&&(this.state=C.STATUS_TERMINATED,window.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_B=function(){console.log(LOG_PREFIX+"Timer B expired for INVITE client transaction "+this.id),this.state===C.STATUS_CALLING&&(this.state=C.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_D=function(){console.log(LOG_PREFIX+"Timer D expired for INVITE client transaction "+this.id),this.state=C.STATUS_TERMINATED,window.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id]},this.sendACK=function(response){var tr=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+response.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=window.setTimeout(function(){tr.timer_D()},JsSIP.Timers.TIMER_D),this.transport.send(this.ack)},this.cancel_request=function(tr,reason){var request=tr.request;this.cancel=JsSIP.C.CANCEL+" "+request.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+request.headers.Route.toString()+"\r\n"),this.cancel+="To: "+request.headers.To.toString()+"\r\n",this.cancel+="From: "+request.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+request.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+request.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",reason&&(this.cancel+="Reason: "+reason+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===C.STATUS_PROCEEDING&&this.transport.send(this.cancel)},this.receiveResponse=function(response){var tr=this,status_code=response.status_code;if(status_code>=100&&199>=status_code)switch(this.state){case C.STATUS_CALLING:this.state=C.STATUS_PROCEEDING,this.request_sender.receiveResponse(response),this.cancel&&this.transport.send(this.cancel);break;case C.STATUS_PROCEEDING:this.request_sender.receiveResponse(response)}else if(status_code>=200&&299>=status_code)switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.state=C.STATUS_ACCEPTED,this.M=window.setTimeout(function(){tr.timer_M()},JsSIP.Timers.TIMER_M),this.request_sender.receiveResponse(response);break;case C.STATUS_ACCEPTED:this.request_sender.receiveResponse(response)}else if(status_code>=300&&699>=status_code)switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED,this.sendACK(response),this.request_sender.receiveResponse(response);break;case C.STATUS_COMPLETED:this.sendACK(response)}}};InviteClientTransactionPrototype.prototype=new ClientTransaction;var ServerTransaction=function(){this.init=function(request,ua){this.id=request.via_branch,this.request=request,this.transport=request.transport,this.ua=ua,this.last_response="",request.server_transaction=this}},NonInviteServerTransactionPrototype=function(){this.timer_J=function(){console.log(LOG_PREFIX+"Timer J expired for non-INVITE server transaction "+this.id),this.state=C.STATUS_TERMINATED,delete this.ua.transactions.nist[this.id]},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(LOG_PREFIX+"transport error occurred, deleting non-INVITE server transaction "+this.id),window.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])},this.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(100===status_code)switch(this.state){case C.STATUS_TRYING:this.state=C.STATUS_PROCEEDING,this.transport.send(response)||this.onTransportError();
break;case C.STATUS_PROCEEDING:this.last_response=response,this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure())}else if(status_code>=200&&699>=status_code)switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.state=C.STATUS_COMPLETED,this.last_response=response,this.J=window.setTimeout(function(){tr.timer_J()},JsSIP.Timers.TIMER_J),this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure());break;case C.STATUS_COMPLETED:}}};NonInviteServerTransactionPrototype.prototype=new ServerTransaction;var InviteServerTransactionPrototype=function(){this.timer_H=function(){console.log(LOG_PREFIX+"Timer H expired for INVITE server transaction "+this.id),this.state===C.STATUS_COMPLETED&&(console.warn(LOG_PREFIX+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=C.STATUS_TERMINATED),delete this.ua.transactions.ist[this.id]},this.timer_I=function(){this.state=C.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id]},this.timer_L=function(){console.log(LOG_PREFIX+"Timer L expired for INVITE server transaction "+this.id),this.state===C.STATUS_ACCEPTED&&(this.state=C.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(LOG_PREFIX+"transport error occurred, deleting INVITE server transaction "+this.id),null!==this.resendProvisionalTimer&&(window.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),window.clearTimeout(this.L),window.clearTimeout(this.H),window.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])},this.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},this.receiveResponse=function(status_code,response,onSuccess,onFailure){var tr=this;if(status_code>=100&&199>=status_code)switch(this.state){case C.STATUS_PROCEEDING:this.transport.send(response)||this.onTransportError(),this.last_response=response}if(status_code>100&&199>=status_code&&this.state===C.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=window.setInterval(function(){tr.resend_provisional()},JsSIP.Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(status_code>=200&&299>=status_code)switch(this.state){case C.STATUS_PROCEEDING:this.state=C.STATUS_ACCEPTED,this.last_response=response,this.L=window.setTimeout(function(){tr.timer_L()},JsSIP.Timers.TIMER_L),null!==this.resendProvisionalTimer&&(window.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case C.STATUS_ACCEPTED:this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure())}else if(status_code>=300&&699>=status_code)switch(this.state){case C.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(window.clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(response)?(this.state=C.STATUS_COMPLETED,this.H=window.setTimeout(function(){tr.timer_H()},JsSIP.Timers.TIMER_H),onSuccess&&onSuccess()):(this.onTransportError(),onFailure&&onFailure())}}};InviteServerTransactionPrototype.prototype=new ServerTransaction,Transactions.NonInviteClientTransaction=function(request_sender,request,transport){this.init(request_sender,request,transport),this.request_sender.ua.transactions.nict[this.id]=this},Transactions.NonInviteClientTransaction.prototype=new NonInviteClientTransactionPrototype,Transactions.InviteClientTransaction=function(request_sender,request,transport){var tr=this;this.init(request_sender,request,transport),this.request_sender.ua.transactions.ict[this.id]=this,this.request.cancel=function(reason){tr.cancel_request(tr,reason)}},Transactions.InviteClientTransaction.prototype=new InviteClientTransactionPrototype,Transactions.AckClientTransaction=function(request_sender,request,transport){this.init(request_sender,request,transport),this.send=function(){this.transport.send(request)}},Transactions.AckClientTransaction.prototype=new NonInviteClientTransactionPrototype,Transactions.NonInviteServerTransaction=function(request,ua){this.init(request,ua),this.state=C.STATUS_TRYING,ua.transactions.nist[this.id]=this},Transactions.NonInviteServerTransaction.prototype=new NonInviteServerTransactionPrototype,Transactions.InviteServerTransaction=function(request,ua){this.init(request,ua),this.state=C.STATUS_PROCEEDING,ua.transactions.ist[this.id]=this,this.resendProvisionalTimer=null,request.reply(100)},Transactions.InviteServerTransaction.prototype=new InviteServerTransactionPrototype,Transactions.checkTransaction=function(ua,request){var tr;switch(request.method){case JsSIP.C.INVITE:if(tr=ua.transactions.ist[request.via_branch]){switch(tr.state){case C.STATUS_PROCEEDING:tr.transport.send(tr.last_response);break;case C.STATUS_ACCEPTED:}return!0}break;case JsSIP.C.ACK:if(tr=ua.transactions.ist[request.via_branch],!tr)return!1;if(tr.state===C.STATUS_ACCEPTED)return!1;if(tr.state===C.STATUS_COMPLETED)return tr.state=C.STATUS_CONFIRMED,tr.I=window.setTimeout(function(){tr.timer_I()},JsSIP.Timers.TIMER_I),!0;break;case JsSIP.C.CANCEL:return tr=ua.transactions.ist[request.via_branch],tr?(request.reply_sl(200),tr.state===C.STATUS_PROCEEDING?!1:!0):(request.reply_sl(481),!0);default:if(tr=ua.transactions.nist[request.via_branch]){switch(tr.state){case C.STATUS_TRYING:break;case C.STATUS_PROCEEDING:case C.STATUS_COMPLETED:tr.transport.send(tr.last_response)}return!0}}},Transactions.C=C,JsSIP.Transactions=Transactions}(JsSIP),function(JsSIP){var Dialog,LOG_PREFIX=JsSIP.name+" | DIALOG | ",C={STATUS_EARLY:1,STATUS_CONFIRMED:2};Dialog=function(session,message,type,state){var contact;return message.hasHeader("contact")?(state=message instanceof JsSIP.IncomingResponse?message.status_code<200?C.STATUS_EARLY:C.STATUS_CONFIRMED:state||C.STATUS_CONFIRMED,contact=message.parseHeader("contact"),"UAS"===type?(this.id={call_id:message.call_id,local_tag:message.to_tag,remote_tag:message.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=state,this.remote_seqnum=message.cseq,this.local_uri=message.parseHeader("to").uri,this.remote_uri=message.parseHeader("from").uri,this.remote_target=contact.uri,this.route_set=message.getHeaderAll("record-route")):"UAC"===type&&(this.id={call_id:message.call_id,local_tag:message.from_tag,remote_tag:message.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=state,this.local_seqnum=message.cseq,this.local_uri=message.parseHeader("from").uri,this.remote_uri=message.parseHeader("to").uri,this.remote_target=contact.uri,this.route_set=message.getHeaderAll("record-route").reverse()),this.session=session,session.ua.dialogs[this.id.toString()]=this,void console.log(LOG_PREFIX+"new "+type+" dialog created with status "+(this.state===C.STATUS_EARLY?"EARLY":"CONFIRMED"))):(console.error(LOG_PREFIX+"unable to create a Dialog without Contact header field"),!1)},Dialog.prototype={update:function(message,type){this.state=C.STATUS_CONFIRMED,console.log(LOG_PREFIX+"dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===type&&(this.route_set=message.getHeaderAll("record-route").reverse())},terminate:function(){console.log(LOG_PREFIX+"dialog "+this.id.toString()+" deleted"),delete this.session.ua.dialogs[this.id.toString()]},createRequest:function(method,extraHeaders){var cseq,request;return extraHeaders=extraHeaders||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),cseq=method===JsSIP.C.CANCEL||method===JsSIP.C.ACK?this.local_seqnum:this.local_seqnum+=1,request=new JsSIP.OutgoingRequest(method,this.remote_target,this.session.ua,{cseq:cseq,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},extraHeaders),request.dialog=this,request},checkInDialogRequest:function(request){if(this.remote_seqnum){if(request.method!==JsSIP.C.INVITE&&request.cseq<this.remote_seqnum)return request.method!==JsSIP.C.ACK&&request.reply(500),!1;request.cseq>this.remote_seqnum&&(this.remote_seqnum=request.cseq)}else this.remote_seqnum=request.cseq;switch(request.method){case JsSIP.C.INVITE:if(request.cseq<this.remote_seqnum){if(this.state===C.STATUS_EARLY){var retryAfter=(10*Math.random()|0)+1;request.reply(500,null,["Retry-After:"+retryAfter])}else request.reply(500);return!1}if(this.state===C.STATUS_EARLY)return request.reply(491),!1;request.hasHeader("contact")&&(this.remote_target=request.parseHeader("contact").uri);break;case JsSIP.C.NOTIFY:request.hasHeader("contact")&&(this.remote_target=request.parseHeader("contact").uri)}return!0},receiveRequest:function(request){this.checkInDialogRequest(request)&&this.session.receiveRequest(request)}},Dialog.C=C,JsSIP.Dialog=Dialog}(JsSIP),function(JsSIP){var RequestSender,LOG_PREFIX=JsSIP.name+" | REQUEST SENDER | ";RequestSender=function(applicant,ua){this.ua=ua,this.applicant=applicant,this.method=applicant.request.method,this.request=applicant.request,this.credentials=null,this.challenged=!1,this.staled=!1,ua.status!==JsSIP.UA.C.STATUS_USER_CLOSED||this.method===JsSIP.C.BYE&&this.method===JsSIP.C.ACK||this.onTransportError()},RequestSender.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new JsSIP.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new JsSIP.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new JsSIP.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(response){var cseq,challenge,authorization_header_name,status_code=response.status_code;if(401!==status_code&&407!==status_code||null===this.ua.configuration.password)this.applicant.receiveResponse(response);else{if(401===response.status_code?(challenge=response.parseHeader("www-authenticate"),authorization_header_name="authorization"):(challenge=response.parseHeader("proxy-authenticate"),authorization_header_name="proxy-authorization"),!challenge)return console.warn(LOG_PREFIX+response.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(response);if(!this.challenged||!this.staled&&challenge.stale===!0){if(this.credentials||(this.credentials=new JsSIP.DigestAuthentication(this.ua)),!this.credentials.authenticate(this.request,challenge))return void this.applicant.receiveResponse(response);this.challenged=!0,challenge.stale&&(this.staled=!0),response.method===JsSIP.C.REGISTER?cseq=this.applicant.cseq+=1:this.request.dialog?cseq=this.request.dialog.local_seqnum+=1:(cseq=this.request.cseq+1,this.request.cseq=cseq),this.request.setHeader("cseq",cseq+" "+this.method),this.request.setHeader(authorization_header_name,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(response)}}},JsSIP.RequestSender=RequestSender}(JsSIP),function(JsSIP){var InDialogRequestSender;InDialogRequestSender=function(applicant){this.applicant=applicant,this.request=applicant.request},InDialogRequestSender.prototype={send:function(){var request_sender=new JsSIP.RequestSender(this,this.applicant.session.ua);request_sender.send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout(),this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError(),this.applicant.onTransportError()},receiveResponse:function(response){(408===response.status_code||481===response.status_code)&&this.applicant.session.ended("remote",response,JsSIP.C.causes.DIALOG_ERROR),this.applicant.receiveResponse(response)}},JsSIP.InDialogRequestSender=InDialogRequestSender}(JsSIP),function(JsSIP){var Registrator,LOG_PREFIX=JsSIP.name+" | REGISTRATOR | ";Registrator=function(ua,transport){var reg_id=1;this.ua=ua,this.transport=transport,this.registrar=ua.configuration.registrar_server,this.expires=ua.configuration.register_expires,this.call_id=JsSIP.Utils.createRandomToken(22),this.cseq=80,this.to_uri=ua.configuration.uri,this.registrationTimer=null,this.registered=this.registered_before=!1,this.ua.registrator=this,this.contact=this.ua.contact.toString(),reg_id&&(this.contact+=";reg-id="+reg_id,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')},Registrator.prototype={register:function(options){var request_sender,cause,extraHeaders,self=this;options=options||{},extraHeaders=options.extraHeaders||[],extraHeaders.push("Contact: "+this.contact+";expires="+this.expires),extraHeaders.push("Allow: "+JsSIP.Utils.getAllowedMethods(this.ua)),this.request=new JsSIP.OutgoingRequest(JsSIP.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders),request_sender=new JsSIP.RequestSender(this,this.ua),this.receiveResponse=function(response){var contact,expires,contacts=response.countHeader("contact");if(response.cseq===this.cseq)switch(null!==this.registrationTimer&&(window.clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):if(response.hasHeader("expires")&&(expires=response.getHeader("expires")),!contacts){console.warn(LOG_PREFIX+"no Contact header in response to REGISTER, response ignored");break}for(;contacts--;){if(contact=response.parseHeader("contact",contacts),contact.uri.user===this.ua.contact.uri.user){expires=contact.getParam("expires");break}contact=null}if(!contact){console.warn(LOG_PREFIX+"no Contact header pointing to us, response ignored");break}expires||(expires=this.expires),this.registrationTimer=window.setTimeout(function(){self.registrationTimer=null,self.register()},1e3*expires-3e3),contact.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=contact.getParam("temp-gruu").replace(/"/g,"")),contact.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=contact.getParam("pub-gruu").replace(/"/g,"")),this.registered=!0,this.ua.emit("registered",this.ua,{response:response});break;case/^423$/.test(response.status_code):response.hasHeader("min-expires")?(this.expires=response.getHeader("min-expires"),this.register()):(console.warn(LOG_PREFIX+"423 response received for REGISTER without Min-Expires"),this.registrationFailure(response,JsSIP.C.causes.SIP_FAILURE_CODE));break;default:cause=JsSIP.Utils.sipErrorCause(response.status_code),this.registrationFailure(response,cause)}},this.onRequestTimeout=function(){this.registrationFailure(null,JsSIP.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,JsSIP.C.causes.CONNECTION_ERROR)},request_sender.send()},unregister:function(options){var extraHeaders;if(!this.registered)return void console.warn(LOG_PREFIX+"already unregistered");options=options||{},extraHeaders=options.extraHeaders||[],this.registered=!1,null!==this.registrationTimer&&(window.clearTimeout(this.registrationTimer),this.registrationTimer=null),options.all?(extraHeaders.push("Contact: *"),extraHeaders.push("Expires: 0"),this.request=new JsSIP.OutgoingRequest(JsSIP.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders)):(extraHeaders.push("Contact: "+this.contact+";expires=0"),this.request=new JsSIP.OutgoingRequest(JsSIP.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},extraHeaders));var request_sender=new JsSIP.RequestSender(this,this.ua);this.receiveResponse=function(response){var cause;switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.unregistered(response);break;default:cause=JsSIP.Utils.sipErrorCause(response.status_code),this.unregistered(response,cause)}},this.onRequestTimeout=function(){this.unregistered(null,JsSIP.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,JsSIP.C.causes.CONNECTION_ERROR)},request_sender.send()},registrationFailure:function(response,cause){this.ua.emit("registrationFailed",this.ua,{response:response||null,cause:cause}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause}))},unregistered:function(response,cause){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:response||null,cause:cause||null})},onTransportClosed:function(){this.registered_before=this.registered,null!==this.registrationTimer&&(window.clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered,this.unregister()}},JsSIP.Registrator=Registrator}(JsSIP),function(JsSIP){var RTCSession,RequestSender=function(JsSIP){var RequestSender=function(applicant,request){this.applicant=applicant,this.request=request||applicant.request,this.session=applicant instanceof JsSIP.RTCSession?applicant:applicant.session,this.reattempt=!1,this.reatemptTimer=null,this.request_sender=new JsSIP.InDialogRequestSender(this)};return RequestSender.prototype={receiveResponse:function(response){var self=this,status_code=response.status_code;response.method===JsSIP.C.INVITE&&491===status_code?this.reattempt?this.applicant.receiveResponse(response):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=window.setTimeout(function(){self.session.status!==JsSIP.RTCSession.C.STATUS_TERMINATED&&(self.reattempt=!0,self.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(response)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}},RequestSender}(JsSIP),RTCMediaHandler=function(JsSIP){var RTCMediaHandler=function(session,constraints){constraints=constraints||{},this.session=session,this.localMedia=null,this.peerConnection=null,this.init(constraints)};return RTCMediaHandler.prototype={createOffer:function(onSuccess,onFailure){var self=this,sent=!1;this.onIceCompleted=function(){sent||(sent=!0,onSuccess(self.peerConnection.localDescription.sdp))},this.peerConnection.createOffer(function(sessionDescription){self.setLocalDescription(sessionDescription,onFailure)},function(e){console.error(LOG_PREFIX+"unable to create offer"),console.error(e),onFailure()})},createAnswer:function(onSuccess,onFailure){var self=this,sent=!1;this.onIceCompleted=function(){sent||(sent=!0,onSuccess(self.peerConnection.localDescription.sdp))},this.peerConnection.createAnswer(function(sessionDescription){self.setLocalDescription(sessionDescription,onFailure)},function(e){console.error(LOG_PREFIX+"unable to create answer"),console.error(e),onFailure()})},setLocalDescription:function(sessionDescription,onFailure){this.peerConnection.setLocalDescription(sessionDescription,function(){},function(e){console.error(LOG_PREFIX+"unable to set local description"),console.error(e),onFailure()})},addStream:function(stream,onSuccess,onFailure,constraints){try{this.peerConnection.addStream(stream,constraints)}catch(e){return console.error(LOG_PREFIX+"error adding stream"),console.error(e),void onFailure()}onSuccess()},init:function(constraints){var idx,length,server,self=this,servers=[],config=this.session.ua.configuration;for(servers.push({url:config.stun_servers}),length=config.turn_servers.length,idx=0;length>idx;idx++)server=config.turn_servers[idx],servers.push({url:server.urls,username:server.username,credential:server.password});this.peerConnection=new JsSIP.WebRTC.RTCPeerConnection({iceServers:servers},constraints),this.peerConnection.onaddstream=function(e){console.log(LOG_PREFIX+"stream added: "+e.stream.id)},this.peerConnection.onremovestream=function(e){console.log(LOG_PREFIX+"stream removed: "+e.stream.id)},this.peerConnection.onicecandidate=function(e){e.candidate?console.log(LOG_PREFIX+"ICE candidate received: "+e.candidate.candidate):void 0!==self.onIceCompleted&&self.onIceCompleted()},this.peerConnection.ongatheringchange=function(e){"complete"===e.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState&&self.onIceCompleted()},this.peerConnection.onicechange=function(){console.log(LOG_PREFIX+'ICE connection state changed to "'+this.iceConnectionState+'"')},this.peerConnection.onstatechange=function(){console.log(LOG_PREFIX+'PeerConnection state changed to "'+this.readyState+'"')}},close:function(){console.log(LOG_PREFIX+"closing PeerConnection"),this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.stop())},getUserMedia:function(onSuccess,onFailure,constraints){var self=this;console.log(LOG_PREFIX+"requesting access to local media"),JsSIP.WebRTC.getUserMedia(constraints,function(stream){console.log(LOG_PREFIX+"got local media stream"),self.localMedia=stream,onSuccess(stream)},function(e){console.error(LOG_PREFIX+"unable to get user media"),console.error(e),onFailure()})},onMessage:function(type,body,onSuccess,onFailure){this.peerConnection.setRemoteDescription(new JsSIP.WebRTC.RTCSessionDescription({type:type,sdp:body}),onSuccess,onFailure)}},RTCMediaHandler}(JsSIP),DTMF=function(JsSIP){var DTMF,C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return DTMF=function(session){var events=["succeeded","failed"];this.session=session,this.direction=null,this.tone=null,this.duration=null,this.initEvents(events)},DTMF.prototype=new JsSIP.EventEmitter,DTMF.prototype.send=function(tone,options){var request_sender,event,eventHandlers,extraHeaders;if(void 0===tone)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==JsSIP.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==JsSIP.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new JsSIP.Exceptions.InvalidStateError(this.session.status);if(options=options||{},extraHeaders=options.extraHeaders?options.extraHeaders.slice():[],eventHandlers=options.eventHandlers||{},"string"==typeof tone)tone=tone.toUpperCase();else{if("number"!=typeof tone)throw new TypeError("Invalid tone: "+tone);tone=tone.toString()}if(!tone.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+tone);this.tone=tone,this.duration=options.duration;for(event in eventHandlers)this.on(event,eventHandlers[event]);extraHeaders.push("Content-Type: application/dtmf-relay"),this.request=this.session.dialog.createRequest(JsSIP.C.INFO,extraHeaders),this.request.body="Signal= "+this.tone+"\r\n",this.request.body+="Duration= "+this.duration,request_sender=new RequestSender(this),this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request}),request_sender.send()},DTMF.prototype.receiveResponse=function(response){var cause;switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this.emit("succeeded",this,{originator:"remote",response:response});break;default:cause=JsSIP.Utils.sipErrorCause(response.status_code),this.emit("failed",this,{originator:"remote",response:response,cause:cause})}},DTMF.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:JsSIP.C.causes.REQUEST_TIMEOUT})},DTMF.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:JsSIP.C.causes.CONNECTION_ERROR})},DTMF.prototype.init_incoming=function(request){var body,reg_tone=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,reg_duration=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=request,request.reply(200),request.body&&(body=request.body.split("\r\n"),2===body.length&&(reg_tone.test(body[0])&&(this.tone=body[0].replace(reg_tone,"$2")),reg_duration.test(body[1])&&(this.duration=parseInt(body[1].replace(reg_duration,"$2"),10)))),this.tone&&this.duration?this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:request}):console.warn(LOG_PREFIX+"invalid INFO DTMF received, discarded")},DTMF.C=C,DTMF}(JsSIP),LOG_PREFIX=JsSIP.name+" | RTC SESSION | ",C={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};RTCSession=function(ua){var events=["progress","failed","started","ended","newDTMF"];this.ua=ua,this.status=C.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.data={},this.initEvents(events)},RTCSession.prototype=new JsSIP.EventEmitter,RTCSession.prototype.terminate=function(options){options=options||{};var cancel_reason,status_code=options.status_code,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders||[],body=options.body;if(this.status===C.STATUS_TERMINATED)throw new JsSIP.Exceptions.InvalidStateError(this.status);switch(this.status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:if(console.log(LOG_PREFIX+"canceling RTCSession"),status_code&&(200>status_code||status_code>=700))throw new TypeError("Invalid status_code: "+status_code);status_code&&(reason_phrase=reason_phrase||JsSIP.C.REASON_PHRASE[status_code]||"",cancel_reason="SIP ;cause="+status_code+' ;text="'+reason_phrase+'"'),this.status===C.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=cancel_reason):this.status===C.STATUS_INVITE_SENT?this.received_100?this.request.cancel(cancel_reason):(this.isCanceled=!0,this.cancelReason=cancel_reason):this.status===C.STATUS_1XX_RECEIVED&&this.request.cancel(cancel_reason),this.failed("local",null,JsSIP.C.causes.CANCELED);break;case C.STATUS_WAITING_FOR_ANSWER:case C.STATUS_ANSWERED:if(console.log(LOG_PREFIX+"rejecting RTCSession"),status_code=status_code||480,300>status_code||status_code>=700)throw new TypeError("Invalid status_code: "+status_code);this.request.reply(status_code,reason_phrase,extraHeaders,body),this.failed("local",null,JsSIP.C.causes.REJECTED);break;case C.STATUS_WAITING_FOR_ACK:case C.STATUS_CONFIRMED:console.log(LOG_PREFIX+"terminating RTCSession"),this.sendBye(options),this.ended("local",null,JsSIP.C.causes.BYE)}this.close()},RTCSession.prototype.answer=function(options){options=options||{};var self=this,request=this.request,extraHeaders=options.extraHeaders||[],mediaConstraints=options.mediaConstraints||{audio:!0,video:!0},userMediaSucceeded=function(stream){self.rtcMediaHandler.addStream(stream,streamAdditionSucceeded,streamAdditionFailed)},userMediaFailed=function(){request.reply(480),self.failed("local",null,JsSIP.C.causes.USER_DENIED_MEDIA_ACCESS)},streamAdditionSucceeded=function(){self.rtcMediaHandler.createAnswer(answerCreationSucceeded,answerCreationFailed)},streamAdditionFailed=function(){self.status!==C.STATUS_TERMINATED&&self.failed("local",null,JsSIP.C.causes.WEBRTC_ERROR)},answerCreationSucceeded=function(body){var replySucceeded=function(){var timeout=JsSIP.Timers.T1;self.status=C.STATUS_WAITING_FOR_ACK,self.timers.invite2xxTimer=window.setTimeout(function invite2xxRetransmission(){self.status===C.STATUS_WAITING_FOR_ACK&&(request.reply(200,null,["Contact: "+self.contact],body),timeout<JsSIP.Timers.T2&&(timeout=2*timeout,timeout>JsSIP.Timers.T2&&(timeout=JsSIP.Timers.T2)),self.timers.invite2xxTimer=window.setTimeout(invite2xxRetransmission,timeout))},timeout),self.timers.ackTimer=window.setTimeout(function(){self.status===C.STATUS_WAITING_FOR_ACK&&(console.log(LOG_PREFIX+"no ACK received, terminating the call"),window.clearTimeout(self.timers.invite2xxTimer),self.sendBye(),self.ended("remote",null,JsSIP.C.causes.NO_ACK))},JsSIP.Timers.TIMER_H),self.started("local")},replyFailed=function(){self.failed("system",null,JsSIP.C.causes.CONNECTION_ERROR)};extraHeaders.push("Contact: "+self.contact),request.reply(200,null,extraHeaders,body,replySucceeded,replyFailed)},answerCreationFailed=function(){self.status!==C.STATUS_TERMINATED&&self.failed("local",null,JsSIP.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==C.STATUS_WAITING_FOR_ANSWER)throw new JsSIP.Exceptions.InvalidStateError(this.status);return this.status=C.STATUS_ANSWERED,this.createDialog(request,"UAS")?(window.clearTimeout(this.timers.userNoAnswerTimer),void this.rtcMediaHandler.getUserMedia(userMediaSucceeded,userMediaFailed,mediaConstraints)):void request.reply(500,"Missing Contact header field")},RTCSession.prototype.sendDTMF=function(tones,options){var duration,interToneGap,position=0,self=this;if(options=options||{},duration=options.duration||null,interToneGap=options.interToneGap||null,void 0===tones)throw new TypeError("Not enough arguments");if(this.status!==C.STATUS_CONFIRMED&&this.status!==C.STATUS_WAITING_FOR_ACK)throw new JsSIP.Exceptions.InvalidStateError(this.status);if(!tones||"string"!=typeof tones&&"number"!=typeof tones||!tones.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+tones);if(tones=tones.toString(),duration&&!JsSIP.Utils.isDecimal(duration))throw new TypeError("Invalid tone duration: "+duration);if(duration?duration<DTMF.C.MIN_DURATION?(console.warn(LOG_PREFIX+'"duration" value is lower than the minimum allowed, setting it to '+DTMF.C.MIN_DURATION+" milliseconds"),duration=DTMF.C.MIN_DURATION):duration>DTMF.C.MAX_DURATION?(console.warn(LOG_PREFIX+'"duration" value is greater than the maximum allowed, setting it to '+DTMF.C.MAX_DURATION+" milliseconds"),duration=DTMF.C.MAX_DURATION):duration=Math.abs(duration):duration=DTMF.C.DEFAULT_DURATION,options.duration=duration,interToneGap&&!JsSIP.Utils.isDecimal(interToneGap))throw new TypeError("Invalid interToneGap: "+interToneGap);if(interToneGap?interToneGap<DTMF.C.MIN_INTER_TONE_GAP?(console.warn(LOG_PREFIX+'"interToneGap" value is lower than the minimum allowed, setting it to '+DTMF.C.MIN_INTER_TONE_GAP+" milliseconds"),interToneGap=DTMF.C.MIN_INTER_TONE_GAP):interToneGap=Math.abs(interToneGap):interToneGap=DTMF.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=tones);this.tones=tones;var sendDTMF=function(){var tone,timeout,tones=self.tones;if(self.status===C.STATUS_TERMINATED||!tones||position>=tones.length)return void(self.tones=null);if(tone=tones[position],position+=1,","===tone)timeout=2e3;else{var dtmf=new DTMF(self);dtmf.on("failed",function(){self.tones=null}),dtmf.send(tone,options),timeout=duration+interToneGap}window.setTimeout(sendDTMF,timeout)};sendDTMF()},RTCSession.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},RTCSession.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},RTCSession.prototype.init_incoming=function(request){var expires,self=this,contentType=request.getHeader("Content-Type");return request.body&&"application/sdp"===contentType?(this.status=C.STATUS_INVITE_RECEIVED,this.from_tag=request.from_tag,this.id=request.call_id+this.from_tag,this.request=request,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,request.hasHeader("expires")&&(expires=1e3*request.getHeader("expires")),request.to_tag=JsSIP.Utils.newTag(),this.createDialog(request,"UAS",!0)?(this.rtcMediaHandler=new RTCMediaHandler(this,{optional:[{DtlsSrtpKeyAgreement:"true"}]}),void this.rtcMediaHandler.onMessage("offer",request.body,function(){request.reply(180,null,["Contact: "+self.contact]),self.status=C.STATUS_WAITING_FOR_ANSWER,self.timers.userNoAnswerTimer=window.setTimeout(function(){request.reply(408),self.failed("local",null,JsSIP.C.causes.NO_ANSWER)},self.ua.configuration.no_answer_timeout),expires&&(self.timers.expiresTimer=window.setTimeout(function(){self.status===C.STATUS_WAITING_FOR_ANSWER&&(request.reply(487),self.failed("system",null,JsSIP.C.causes.EXPIRES))},expires)),self.newRTCSession("remote",request)},function(e){console.warn(LOG_PREFIX+"invalid SDP"),console.warn(e),request.reply(488)})):void request.reply(500,"Missing Contact header field")):void request.reply(415)},RTCSession.prototype.connect=function(target,options){options=options||{};
var event,requestParams,invalidTarget=!1,eventHandlers=options.eventHandlers||{},extraHeaders=options.extraHeaders||[],mediaConstraints=options.mediaConstraints||{audio:!0,video:!0},RTCConstraints=options.RTCConstraints||{};if(void 0===target)throw new TypeError("Not enough arguments");if(this.status!==C.STATUS_NULL)throw new JsSIP.Exceptions.InvalidStateError(this.status);for(event in eventHandlers)this.on(event,eventHandlers[event]);try{target=JsSIP.Utils.normalizeURI(target,this.ua.configuration.hostport_params)}catch(e){target=JsSIP.URI.parse(JsSIP.C.INVALID_TARGET_URI),invalidTarget=!0}this.from_tag=JsSIP.Utils.newTag(),this.rtcMediaHandler=new RTCMediaHandler(this,RTCConstraints),this.anonymous=options.anonymous,this.isCanceled=!1,this.received_100=!1,requestParams={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(requestParams.from_display_name="Anonymous",requestParams.from_uri="sip:anonymous@anonymous.invalid",extraHeaders.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),extraHeaders.push("Privacy: id")),extraHeaders.push("Contact: "+this.contact),extraHeaders.push("Allow: "+JsSIP.Utils.getAllowedMethods(this.ua)),extraHeaders.push("Content-Type: application/sdp"),this.request=new JsSIP.OutgoingRequest(JsSIP.C.INVITE,target,this.ua,requestParams,extraHeaders),this.id=this.request.call_id+this.from_tag,this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),invalidTarget?this.failed("local",null,JsSIP.C.causes.INVALID_TARGET):JsSIP.WebRTC.isSupported?this.sendInitialRequest(mediaConstraints):this.failed("local",null,JsSIP.C.causes.WEBRTC_NOT_SUPPORTED)},RTCSession.prototype.close=function(){var idx;if(this.status!==C.STATUS_TERMINATED){console.log(LOG_PREFIX+"closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close();for(idx in this.timers)window.clearTimeout(this.timers[idx]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(idx in this.earlyDialogs)this.earlyDialogs[idx].terminate(),delete this.earlyDialogs[idx];this.status=C.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},RTCSession.prototype.createDialog=function(message,type,early){var dialog,early_dialog,local_tag="UAS"===type?message.to_tag:message.from_tag,remote_tag="UAS"===type?message.from_tag:message.to_tag,id=message.call_id+local_tag+remote_tag;return early_dialog=this.earlyDialogs[id],early?early_dialog?!0:(early_dialog=new JsSIP.Dialog(this,message,type,JsSIP.Dialog.C.STATUS_EARLY),early_dialog.id?(this.earlyDialogs[id]=early_dialog,!0):(this.failed("remote",message,JsSIP.C.causes.INTERNAL_ERROR),!1)):early_dialog?(early_dialog.update(message,type),this.dialog=early_dialog,delete this.earlyDialogs[id],!0):(dialog=new JsSIP.Dialog(this,message,type),dialog.id?(this.to_tag=message.to_tag,this.dialog=dialog,!0):(this.failed("remote",message,JsSIP.C.causes.INTERNAL_ERROR),!1))},RTCSession.prototype.receiveRequest=function(request){var contentType;if(request.method===JsSIP.C.CANCEL)this.status===C.STATUS_WAITING_FOR_ANSWER&&(this.status=C.STATUS_CANCELED,this.request.reply(487),this.failed("remote",request,JsSIP.C.causes.CANCELED));else switch(request.method){case JsSIP.C.ACK:this.status===C.STATUS_WAITING_FOR_ACK&&(window.clearTimeout(this.timers.ackTimer),window.clearTimeout(this.timers.invite2xxTimer),this.status=C.STATUS_CONFIRMED);break;case JsSIP.C.BYE:this.status===C.STATUS_CONFIRMED&&(request.reply(200),this.ended("remote",request,JsSIP.C.causes.BYE));break;case JsSIP.C.INVITE:this.status===C.STATUS_CONFIRMED&&console.log(LOG_PREFIX+"re-INVITE received");break;case JsSIP.C.INFO:(this.status===C.STATUS_CONFIRMED||this.status===C.STATUS_WAITING_FOR_ACK)&&(contentType=request.getHeader("content-type"),contentType&&contentType.match(/^application\/dtmf-relay/i)&&new DTMF(this).init_incoming(request))}},RTCSession.prototype.sendInitialRequest=function(constraints){var self=this,request_sender=new JsSIP.RequestSender(self,this.ua),userMediaSucceeded=function(stream){self.rtcMediaHandler.addStream(stream,streamAdditionSucceeded,streamAdditionFailed)},userMediaFailed=function(){self.status!==C.STATUS_TERMINATED&&self.failed("local",null,JsSIP.C.causes.USER_DENIED_MEDIA_ACCESS)},streamAdditionSucceeded=function(){self.rtcMediaHandler.createOffer(offerCreationSucceeded,offerCreationFailed)},streamAdditionFailed=function(){self.status!==C.STATUS_TERMINATED&&self.failed("local",null,JsSIP.C.causes.WEBRTC_ERROR)},offerCreationSucceeded=function(offer){self.isCanceled||self.status===C.STATUS_TERMINATED||(self.request.body=offer,self.status=C.STATUS_INVITE_SENT,request_sender.send())},offerCreationFailed=function(){self.status!==C.STATUS_TERMINATED&&self.failed("local",null,JsSIP.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(userMediaSucceeded,userMediaFailed,constraints)},RTCSession.prototype.receiveResponse=function(response){var cause,session=this;if(this.status===C.STATUS_INVITE_SENT||this.status===C.STATUS_1XX_RECEIVED){if(this.isCanceled)return void(response.status_code>=100&&response.status_code<200?this.request.cancel(this.cancelReason):response.status_code>=200&&response.status_code<299&&this.acceptAndTerminate(response));switch(!0){case/^100$/.test(response.status_code):this.received_100=!0;break;case/^1[0-9]{2}$/.test(response.status_code):if(!response.to_tag){console.warn(LOG_PREFIX+"1xx response received without to tag");break}response.hasHeader("contact")&&this.createDialog(response,"UAC",!0),this.status=C.STATUS_1XX_RECEIVED,this.progress("remote",response);break;case/^2[0-9]{2}$/.test(response.status_code):if(this.dialog)break;if(!response.body){this.acceptAndTerminate(response,400,"Missing session description"),this.failed("remote",response,JsSIP.C.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(response,"UAC"))break;this.rtcMediaHandler.onMessage("answer",response.body,function(){session.status=C.STATUS_CONFIRMED,session.sendACK(),session.started("remote",response)},function(e){console.warn(e),session.acceptAndTerminate(response,488,"Not Acceptable Here"),session.failed("remote",response,JsSIP.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:cause=JsSIP.Utils.sipErrorCause(response.status_code),this.failed("remote",response,cause)}}},RTCSession.prototype.acceptAndTerminate=function(response,status_code,reason_phrase){(this.dialog||this.createDialog(response,"UAC"))&&(this.sendACK(),this.sendBye({status_code:status_code,reason_phrase:reason_phrase}))},RTCSession.prototype.sendACK=function(){var request=this.dialog.createRequest(JsSIP.C.ACK);this.sendRequest(request)},RTCSession.prototype.sendBye=function(options){options=options||{};var request,reason,status_code=options.status_code,reason_phrase=options.reason_phrase||JsSIP.C.REASON_PHRASE[status_code]||"",extraHeaders=options.extraHeaders||[],body=options.body;if(status_code&&(200>status_code||status_code>=700))throw new TypeError("Invalid status_code: "+status_code);status_code&&(reason="SIP ;cause="+status_code+'; text="'+reason_phrase+'"',extraHeaders.push("Reason: "+reason)),request=this.dialog.createRequest(JsSIP.C.BYE,extraHeaders),request.body=body,this.sendRequest(request)},RTCSession.prototype.sendRequest=function(request){var request_sender=new RequestSender(this,request);request_sender.send()},RTCSession.prototype.onTransportError=function(){this.status!==C.STATUS_TERMINATED&&(this.status===C.STATUS_CONFIRMED?this.ended("system",null,JsSIP.C.causes.CONNECTION_ERROR):this.failed("system",null,JsSIP.C.causes.CONNECTION_ERROR))},RTCSession.prototype.onRequestTimeout=function(){this.status!==C.STATUS_TERMINATED&&(this.status===C.STATUS_CONFIRMED?this.ended("system",null,JsSIP.C.causes.REQUEST_TIMEOUT):this.failed("system",null,JsSIP.C.causes.CONNECTION_ERROR))},RTCSession.prototype.newRTCSession=function(originator,request){var session=this,event_name="newRTCSession";"remote"===originator?(session.direction="incoming",session.local_identity=request.to,session.remote_identity=request.from):"local"===originator&&(session.direction="outgoing",session.local_identity=request.from,session.remote_identity=request.to),session.ua.emit(event_name,session.ua,{originator:originator,session:session,request:request})},RTCSession.prototype.connecting=function(originator,request){var session=this,event_name="connecting";session.emit(event_name,session,{originator:"local",request:request})},RTCSession.prototype.progress=function(originator,response){var session=this,event_name="progress";session.emit(event_name,session,{originator:originator,response:response||null})},RTCSession.prototype.started=function(originator,message){var session=this,event_name="started";session.start_time=new Date,session.emit(event_name,session,{originator:originator,response:message||null})},RTCSession.prototype.ended=function(originator,message,cause){var session=this,event_name="ended";session.end_time=new Date,session.close(),session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})},RTCSession.prototype.failed=function(originator,message,cause){var session=this,event_name="failed";session.close(),session.emit(event_name,session,{originator:originator,message:message||null,cause:cause})},RTCSession.C=C,JsSIP.RTCSession=RTCSession}(JsSIP),function(JsSIP){var Message;Message=function(ua){this.ua=ua,this.direction=null,this.local_identity=null,this.remote_identity=null,this.data={}},Message.prototype=new JsSIP.EventEmitter,Message.prototype.send=function(target,body,options){var request_sender,event,contentType,eventHandlers,extraHeaders,events=["succeeded","failed"],invalidTarget=!1;if(void 0===target||void 0===body)throw new TypeError("Not enough arguments");this.initEvents(events),options=options||{},extraHeaders=options.extraHeaders||[],eventHandlers=options.eventHandlers||{},contentType=options.contentType||"text/plain";for(event in eventHandlers)this.on(event,eventHandlers[event]);try{target=JsSIP.Utils.normalizeURI(target,this.ua.configuration.hostport_params)}catch(e){target=JsSIP.URI.parse(JsSIP.C.INVALID_TARGET_URI),invalidTarget=!0}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=target,this.closed=!1,this.ua.applicants[this]=this,extraHeaders.push("Content-Type: "+contentType),this.request=new JsSIP.OutgoingRequest(JsSIP.C.MESSAGE,target,this.ua,null,extraHeaders),body&&(this.request.body=body),request_sender=new JsSIP.RequestSender(this,this.ua),this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request}),invalidTarget?this.emit("failed",this,{originator:"local",cause:JsSIP.C.causes.INVALID_TARGET}):request_sender.send()},Message.prototype.receiveResponse=function(response){var cause;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:response});break;default:delete this.ua.applicants[this],cause=JsSIP.Utils.sipErrorCause(response.status_code),this.emit("failed",this,{originator:"remote",response:response,cause:cause})}},Message.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:JsSIP.C.causes.REQUEST_TIMEOUT})},Message.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:JsSIP.C.causes.CONNECTION_ERROR})},Message.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},Message.prototype.init_incoming=function(request){var transaction,contentType=request.getHeader("content-type");this.direction="incoming",this.request=request,this.local_identity=request.to.uri,this.remote_identity=request.from.uri,contentType&&(contentType.match(/^text\/plain(\s*;\s*.+)*$/i)||contentType.match(/^text\/html(\s*;\s*.+)*$/i))?(this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:request}),transaction=this.ua.transactions.nist[request.via_branch],!transaction||transaction.state!==JsSIP.Transactions.C.STATUS_TRYING&&transaction.state!==JsSIP.Transactions.C.STATUS_PROCEEDING||request.reply(200)):request.reply(415,null,["Accept: text/plain, text/html"])},Message.prototype.accept=function(options){options=options||{};var extraHeaders=options.extraHeaders||[],body=options.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,extraHeaders,body)},Message.prototype.reject=function(options){options=options||{};var status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=options.extraHeaders||[],body=options.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>status_code||status_code>=700)throw new TypeError("Invalid status_code: "+status_code);this.request.reply(status_code,reason_phrase,extraHeaders,body)},JsSIP.Message=Message}(JsSIP),function(JsSIP){var UA,LOG_PREFIX=JsSIP.name+" | UA | ",C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED:"path, outbound, gruu",MAX_FORWARDS:69,TAG_LENGTH:10};UA=function(configuration){var events=["connected","disconnected","registered","unregistered","registrationFailed","newRTCSession","newMessage"];if(C.ACCEPTED_BODY_TYPES=C.ACCEPTED_BODY_TYPES.toString(),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=C.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,void 0===configuration)throw new TypeError("Not enough arguments");try{this.loadConfig(configuration),this.initEvents(events)}catch(e){throw this.status=C.STATUS_NOT_READY,this.error=C.CONFIGURATION_ERROR,e}this.registrator=new JsSIP.Registrator(this)},UA.prototype=new JsSIP.EventEmitter,UA.prototype.register=function(options){this.configuration.register=!0,this.registrator.register(options)},UA.prototype.unregister=function(options){this.configuration.register=!1,this.registrator.unregister(options)},UA.prototype.isRegistered=function(){return this.registrator.registered?!0:!1},UA.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},UA.prototype.call=function(target,options){var session;session=new JsSIP.RTCSession(this),session.connect(target,options)},UA.prototype.sendMessage=function(target,body,options){var message;message=new JsSIP.Message(this),message.send(target,body,options)},UA.prototype.stop=function(){var session,applicant,ua=this;if(console.log(LOG_PREFIX+"user requested closure..."),this.status===C.STATUS_USER_CLOSED)return void console.warn("UA already closed");window.clearTimeout(this.transportRecoveryTimer),console.log(LOG_PREFIX+"closing registrator"),this.registrator.close();for(session in this.sessions)console.log(LOG_PREFIX+"closing session "+session),this.sessions[session].terminate();for(applicant in this.applicants)this.applicants[applicant].close();this.status=C.STATUS_USER_CLOSED,this.shutdownGraceTimer=window.setTimeout(function(){ua.transport.disconnect()},"5000")},UA.prototype.start=function(){var server;console.log(LOG_PREFIX+"user requested startup..."),this.status===C.STATUS_INIT?(server=this.getNextWsServer(),new JsSIP.Transport(this,server)):this.status===C.STATUS_USER_CLOSED?(console.log(LOG_PREFIX+"resuming"),this.status=C.STATUS_READY,this.transport.connect()):this.status===C.STATUS_READY?console.log(LOG_PREFIX+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")},UA.prototype.saveCredentials=function(credentials){this.cache.credentials[credentials.realm]=this.cache.credentials[credentials.realm]||{},this.cache.credentials[credentials.realm][credentials.uri]=credentials},UA.prototype.getCredentials=function(request){var realm,credentials;return realm=request.ruri.host,this.cache.credentials[realm]&&this.cache.credentials[realm][request.ruri]&&(credentials=this.cache.credentials[realm][request.ruri],credentials.method=request.method),credentials},UA.prototype.onTransportClosed=function(transport){var type,idx,length,client_transactions=["nict","ict","nist","ist"];for(transport.server.status=JsSIP.Transport.C.STATUS_DISCONNECTED,console.log(LOG_PREFIX+"connection state set to "+JsSIP.Transport.C.STATUS_DISCONNECTED),length=client_transactions.length,type=0;length>type;type++)for(idx in this.transactions[client_transactions[type]])this.transactions[client_transactions[type]][idx].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},UA.prototype.onTransportError=function(transport){var server;console.log(LOG_PREFIX+"transport "+transport.server.ws_uri+" failed | connection state set to "+JsSIP.Transport.C.STATUS_ERROR),transport.server.status=JsSIP.Transport.C.STATUS_ERROR,this.emit("disconnected",this,{transport:transport,code:transport.lastTransportError.code,reason:transport.lastTransportError.reason}),server=this.getNextWsServer(),server?new JsSIP.Transport(this,server):(this.closeSessionsOnTransportError(),this.error&&this.error===C.NETWORK_ERROR||(this.status=C.STATUS_NOT_READY,this.error=C.NETWORK_ERROR),this.recoverTransport())},UA.prototype.onTransportConnected=function(transport){this.transport=transport,this.transportRecoverAttempts=0,transport.server.status=JsSIP.Transport.C.STATUS_READY,console.log(LOG_PREFIX+"connection state set to "+JsSIP.Transport.C.STATUS_READY),this.status!==C.STATUS_USER_CLOSED&&(this.status=C.STATUS_READY,this.error=null,this.emit("connected",this,{transport:transport}),this.configuration.register&&this.registrator.onTransportConnected())},UA.prototype.receiveRequest=function(request){var dialog,session,message,method=request.method;if(request.ruri.user!==this.configuration.uri.user&&request.ruri.user!==this.contact.uri.user)return console.warn(LOG_PREFIX+"Request-URI does not point to us"),void(request.method!==JsSIP.C.ACK&&request.reply_sl(404));if(!JsSIP.Transactions.checkTransaction(this,request)){if(method===JsSIP.C.INVITE?new JsSIP.Transactions.InviteServerTransaction(request,this):method!==JsSIP.C.ACK&&new JsSIP.Transactions.NonInviteServerTransaction(request,this),method===JsSIP.C.OPTIONS)request.reply(200,null,["Allow: "+JsSIP.Utils.getAllowedMethods(this),"Accept: "+C.ACCEPTED_BODY_TYPES]);else if(method===JsSIP.C.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length)return void request.reply(405,null,["Allow: "+JsSIP.Utils.getAllowedMethods(this)]);message=new JsSIP.Message(this),message.init_incoming(request)}if(request.to_tag)dialog=this.findDialog(request),dialog?dialog.receiveRequest(request):method===JsSIP.C.NOTIFY?(session=this.findSession(request),session?session.receiveRequest(request):(console.warn(LOG_PREFIX+"received NOTIFY request for a non existent session"),request.reply(481,"Subscription does not exist"))):method!==JsSIP.C.ACK&&request.reply(481);else{if(!this.isRegistered())return void request.reply(410);switch(method){case JsSIP.C.INVITE:JsSIP.WebRTC.isSupported?(session=new JsSIP.RTCSession(this),session.init_incoming(request)):(console.warn(LOG_PREFIX+"INVITE received but WebRTC is not supported"),request.reply(488));break;case JsSIP.C.BYE:request.reply(481);break;case JsSIP.C.CANCEL:session=this.findSession(request),session?session.receiveRequest(request):console.warn(LOG_PREFIX+"received CANCEL request for a non existent session");break;case JsSIP.C.ACK:break;default:request.reply(405)}}}},UA.prototype.findSession=function(request){var sessionIDa=request.call_id+request.from_tag,sessionA=this.sessions[sessionIDa],sessionIDb=request.call_id+request.to_tag,sessionB=this.sessions[sessionIDb];return sessionA?sessionA:sessionB?sessionB:null},UA.prototype.findDialog=function(request){var id=request.call_id+request.from_tag+request.to_tag,dialog=this.dialogs[id];return dialog?dialog:(id=request.call_id+request.to_tag+request.from_tag,dialog=this.dialogs[id],dialog?dialog:null)},UA.prototype.getNextWsServer=function(){var idx,length,ws_server,candidates=[];for(length=this.configuration.ws_servers.length,idx=0;length>idx;idx++)ws_server=this.configuration.ws_servers[idx],ws_server.status!==JsSIP.Transport.C.STATUS_ERROR&&(0===candidates.length?candidates.push(ws_server):ws_server.weight>candidates[0].weight?candidates=[ws_server]:ws_server.weight===candidates[0].weight&&candidates.push(ws_server));return idx=Math.floor(Math.random()*candidates.length),candidates[idx]},UA.prototype.closeSessionsOnTransportError=function(){var idx;for(idx in this.sessions)this.sessions[idx].onTransportError();this.registrator.onTransportClosed()},UA.prototype.recoverTransport=function(ua){var idx,length,k,nextRetry,count,server;for(ua=ua||this,count=ua.transportRecoverAttempts,length=ua.configuration.ws_servers.length,idx=0;length>idx;idx++)ua.configuration.ws_servers[idx].status=0;server=ua.getNextWsServer(),k=Math.floor(Math.random()*Math.pow(2,count)+1),nextRetry=k*ua.configuration.connection_recovery_min_interval,nextRetry>ua.configuration.connection_recovery_max_interval&&(console.log(LOG_PREFIX+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),nextRetry=ua.configuration.connection_recovery_min_interval,count=0),console.log(LOG_PREFIX+"next connection attempt in "+nextRetry+" seconds"),this.transportRecoveryTimer=window.setTimeout(function(){ua.transportRecoverAttempts=count+1,new JsSIP.Transport(ua,server)},1e3*nextRetry)},UA.prototype.loadConfig=function(configuration){var parameter,value,checked_value,hostport_params,registrar_server,settings={via_host:JsSIP.Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(parameter in UA.configuration_check.mandatory){if(!configuration.hasOwnProperty(parameter))throw new JsSIP.Exceptions.ConfigurationError(parameter);if(value=configuration[parameter],checked_value=UA.configuration_check.mandatory[parameter](value),void 0===checked_value)throw new JsSIP.Exceptions.ConfigurationError(parameter,value);settings[parameter]=checked_value}for(parameter in UA.configuration_check.optional)if(configuration.hasOwnProperty(parameter)){if(value=configuration[parameter],null===value||""===value||void 0===value)continue;if("number"==typeof value&&window.isNaN(value))continue;if(checked_value=UA.configuration_check.optional[parameter](value),void 0===checked_value)throw new JsSIP.Exceptions.ConfigurationError(parameter,value);settings[parameter]=checked_value}if(settings.connection_recovery_max_interval<settings.connection_recovery_min_interval)throw new JsSIP.Exceptions.ConfigurationError("connection_recovery_max_interval",settings.connection_recovery_max_interval);0===settings.display_name&&(settings.display_name="0"),settings.instance_id=JsSIP.Utils.newUUID(),settings.jssip_id=JsSIP.Utils.createRandomToken(5),hostport_params=settings.uri.clone(),hostport_params.user=null,settings.hostport_params=hostport_params.toString().replace(/^sip:/i,""),settings.authorization_user||(settings.authorization_user=settings.uri.user),settings.registrar_server||(registrar_server=settings.uri.clone(),registrar_server.user=null,settings.registrar_server=registrar_server),settings.no_answer_timeout=1e3*settings.no_answer_timeout,settings.hack_ip_in_contact&&(settings.via_host=JsSIP.Utils.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new JsSIP.URI("sip",JsSIP.Utils.createRandomToken(8),settings.via_host,null,{transport:"ws"}),toString:function(options){options=options||{};var anonymous=options.anonymous||null,outbound=options.outbound||null,contact="<";return contact+=anonymous?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),outbound&&(contact+=";ob"),contact+=">"}},console.log(LOG_PREFIX+"configuration parameters after validation:");for(parameter in settings){switch(parameter){case"uri":case"registrar_server":console.log("· "+parameter+": "+settings[parameter]);break;case"password":console.log("· "+parameter+": NOT SHOWN");break;default:console.log("· "+parameter+": "+window.JSON.stringify(settings[parameter]))}UA.configuration_skeleton[parameter].value=settings[parameter]}Object.defineProperties(this.configuration,UA.configuration_skeleton);for(parameter in settings)UA.configuration_skeleton[parameter].value=""},UA.configuration_skeleton=function(){var idx,parameter,skeleton={},parameters=["instance_id","jssip_id","register_min_expires","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_ip_in_contact","no_answer_timeout","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","via_core_value","via_host"];for(idx in parameters)parameter=parameters[idx],skeleton[parameter]={value:"",writable:!1,configurable:!1};return skeleton.register={value:"",writable:!0,configurable:!1},skeleton}(),UA.configuration_check={mandatory:{uri:function(uri){var parsed;return/^sip:/i.test(uri)||(uri=JsSIP.C.SIP+":"+uri),parsed=JsSIP.URI.parse(uri),parsed?parsed.user?parsed:void 0:void 0},ws_servers:function(ws_servers){var idx,length,url;if("string"==typeof ws_servers)ws_servers=[{ws_uri:ws_servers}];else{if(!(ws_servers instanceof Array))return;for(length=ws_servers.length,idx=0;length>idx;idx++)"string"==typeof ws_servers[idx]&&(ws_servers[idx]={ws_uri:ws_servers[idx]})}if(0===ws_servers.length)return!1;for(length=ws_servers.length,idx=0;length>idx;idx++){if(!ws_servers[idx].ws_uri)return void console.error(LOG_PREFIX+'missing "ws_uri" attribute in ws_servers parameter');if(ws_servers[idx].weight&&!Number(ws_servers[idx].weight))return void console.error(LOG_PREFIX+'"weight" attribute in ws_servers parameter must be a Number');if(url=JsSIP.Grammar.parse(ws_servers[idx].ws_uri,"absoluteURI"),-1===url)return void console.error(LOG_PREFIX+'invalid "ws_uri" attribute in ws_servers parameter: '+ws_servers[idx].ws_uri);if("wss"!==url.scheme&&"ws"!==url.scheme)return void console.error(LOG_PREFIX+"invalid URI scheme in ws_servers parameter: "+url.scheme);ws_servers[idx].sip_uri="<sip:"+url.host+(url.port?":"+url.port:"")+";transport=ws;lr>",ws_servers[idx].weight||(ws_servers[idx].weight=0),ws_servers[idx].status=0,ws_servers[idx].scheme=url.scheme.toUpperCase()}return ws_servers}},optional:{authorization_user:function(authorization_user){return-1===JsSIP.Grammar.parse('"'+authorization_user+'"',"quoted_string")?void 0:authorization_user},connection_recovery_max_interval:function(connection_recovery_max_interval){var value;return JsSIP.Utils.isDecimal(connection_recovery_max_interval)&&(value=window.Number(connection_recovery_max_interval),value>0)?value:void 0},connection_recovery_min_interval:function(connection_recovery_min_interval){var value;return JsSIP.Utils.isDecimal(connection_recovery_min_interval)&&(value=window.Number(connection_recovery_min_interval),value>0)?value:void 0},display_name:function(display_name){return-1===JsSIP.Grammar.parse('"'+display_name+'"',"display_name")?void 0:display_name},hack_via_tcp:function(hack_via_tcp){return"boolean"==typeof hack_via_tcp?hack_via_tcp:void 0},hack_ip_in_contact:function(hack_ip_in_contact){return"boolean"==typeof hack_ip_in_contact?hack_ip_in_contact:void 0},no_answer_timeout:function(no_answer_timeout){var value;return JsSIP.Utils.isDecimal(no_answer_timeout)&&(value=window.Number(no_answer_timeout),value>0)?value:void 0},password:function(password){return String(password)},register:function(register){return"boolean"==typeof register?register:void 0},register_expires:function(register_expires){var value;return JsSIP.Utils.isDecimal(register_expires)&&(value=window.Number(register_expires),value>0)?value:void 0},registrar_server:function(registrar_server){var parsed;return/^sip:/i.test(registrar_server)||(registrar_server=JsSIP.C.SIP+":"+registrar_server),parsed=JsSIP.URI.parse(registrar_server),parsed?parsed.user?void 0:parsed:void 0},stun_servers:function(stun_servers){var idx,length,stun_server;if("string"==typeof stun_servers)stun_servers=[stun_servers];else if(!(stun_servers instanceof Array))return;for(length=stun_servers.length,idx=0;length>idx;idx++){if(stun_server=stun_servers[idx],/^stuns?:/.test(stun_server)||(stun_server="stun:"+stun_server),-1===JsSIP.Grammar.parse(stun_server,"stun_URI"))return;stun_servers[idx]=stun_server}return stun_servers},trace_sip:function(trace_sip){return"boolean"==typeof trace_sip?trace_sip:void 0},turn_servers:function(turn_servers){var idx,length,turn_server,url;for(turn_servers instanceof Array||(turn_servers=[turn_servers]),length=turn_servers.length,idx=0;length>idx;idx++){if(turn_server=turn_servers[idx],turn_server.server&&(turn_server.urls=[turn_server.server]),!turn_server.urls||!turn_server.username||!turn_server.password)return;for(!turn_server.urls instanceof Array&&(turn_server.urls=[turn_server.urls]),length=turn_server.urls.length,idx=0;length>idx;idx++)if(url=turn_server.urls[idx],/^turns?:/.test(url)||(url="turn:"+url),-1===JsSIP.Grammar.parse(url,"turn_URI"))return}return turn_servers},use_preloaded_route:function(use_preloaded_route){return"boolean"==typeof use_preloaded_route?use_preloaded_route:void 0}}},UA.C=C,JsSIP.UA=UA}(JsSIP),function(JsSIP){var Utils;Utils={str_utf8_length:function(string){return window.unescape(encodeURIComponent(string)).length},isFunction:function(fn){return void 0!==fn?"[object Function]"===Object.prototype.toString.call(fn)?!0:!1:!1},isDecimal:function(num){return!isNaN(num)&&parseFloat(num)===parseInt(num,10)},createRandomToken:function(size,base){var i,r,token="";for(base=base||32,i=0;size>i;i++)r=Math.random()*base|0,token+=r.toString(base);return token},newTag:function(){return JsSIP.Utils.createRandomToken(JsSIP.UA.C.TAG_LENGTH)},newUUID:function(){var UUID="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)});return UUID},hostType:function(host){return host?(host=JsSIP.Grammar.parse(host,"host"),-1!==host?host.host_type:void 0):void 0},normalizeURI:function(target,domain){var uri,target_array,target_user,target_domain,original_target=target;if(target){if(target instanceof JsSIP.URI)return target;if("string"==typeof target){switch(target_array=target.split("@"),target_array.length){case 1:if(!domain)throw new JsSIP.Exceptions.InvalidTargetError(original_target);target_user=target,target_domain=domain;break;case 2:target_user=target_array[0],target_domain=target_array[1];break;default:target_user=target_array.slice(0,target_array.length-1).join("@"),target_domain=target_array[target_array.length-1]}if(target_user=target_user.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(target_user)&&(target_user=target_user.replace(/[\-\.\(\)]/g,"")),target=JsSIP.C.SIP+":"+JsSIP.Utils.escapeUser(target_user)+"@"+target_domain,uri=JsSIP.URI.parse(target))return uri;throw new JsSIP.Exceptions.InvalidTargetError(original_target)}throw new JsSIP.Exceptions.InvalidTargetError(original_target)}throw new JsSIP.Exceptions.InvalidTargetError(original_target)},escapeUser:function(user){return window.encodeURIComponent(window.decodeURIComponent(user)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(string){var part,exceptions={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},name=string.toLowerCase().replace(/_/g,"-").split("-"),hname="",parts=name.length;for(part=0;parts>part;part++)0!==part&&(hname+="-"),hname+=name[part].charAt(0).toUpperCase()+name[part].substring(1);return exceptions[hname]&&(hname=exceptions[hname]),hname},sipErrorCause:function(status_code){var cause;for(cause in JsSIP.C.SIP_ERROR_CAUSES)if(-1!==JsSIP.C.SIP_ERROR_CAUSES[cause].indexOf(status_code))return JsSIP.C.causes[cause];return JsSIP.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){function getOctet(from,to){return window.Math.floor(window.Math.random()*(to-from+1)+from)
}return"192.0.2."+getOctet(1,254)},getAllowedMethods:function(ua){var event,allowed=JsSIP.UA.C.ALLOWED_METHODS.toString();for(event in JsSIP.UA.C.EVENT_METHODS)ua.checkEvent(event)&&ua.listeners(event).length>0&&(allowed+=","+JsSIP.UA.C.EVENT_METHODS[event]);return allowed},calculateMD5:function(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;return lX8=2147483648&lX,lY8=2147483648&lY,lX4=1073741824&lX,lY4=1073741824&lY,lResult=(1073741823&lX)+(1073741823&lY),lX4&lY4?2147483648^lResult^lX8^lY8:lX4|lY4?1073741824&lResult?3221225472^lResult^lX8^lY8:1073741824^lResult^lX8^lY8:lResult^lX8^lY8}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){return a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac)),AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){for(var lWordCount,lMessageLength=string.length,lNumberOfWords_temp1=lMessageLength+8,lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64,lNumberOfWords=16*(lNumberOfWords_temp2+1),lWordArray=Array(lNumberOfWords-1),lBytePosition=0,lByteCount=0;lMessageLength>lByteCount;)lWordCount=(lByteCount-lByteCount%4)/4,lBytePosition=lByteCount%4*8,lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition,lByteCount++;return lWordCount=(lByteCount-lByteCount%4)/4,lBytePosition=lByteCount%4*8,lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition,lWordArray[lNumberOfWords-2]=lMessageLength<<3,lWordArray[lNumberOfWords-1]=lMessageLength>>>29,lWordArray}function WordToHex(lValue){var lByte,lCount,WordToHexValue="",WordToHexValue_temp="";for(lCount=0;3>=lCount;lCount++)lByte=lValue>>>8*lCount&255,WordToHexValue_temp="0"+lByte.toString(16),WordToHexValue+=WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2);return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");for(var utftext="",n=0;n<string.length;n++){var c=string.charCodeAt(n);128>c?utftext+=String.fromCharCode(c):c>127&&2048>c?(utftext+=String.fromCharCode(c>>6|192),utftext+=String.fromCharCode(63&c|128)):(utftext+=String.fromCharCode(c>>12|224),utftext+=String.fromCharCode(c>>6&63|128),utftext+=String.fromCharCode(63&c|128))}return utftext}var k,AA,BB,CC,DD,a,b,c,d,x=[],S11=7,S12=12,S13=17,S14=22,S21=5,S22=9,S23=14,S24=20,S31=4,S32=11,S33=16,S34=23,S41=6,S42=10,S43=15,S44=21;for(string=Utf8Encode(string),x=ConvertToWordArray(string),a=1732584193,b=4023233417,c=2562383102,d=271733878,k=0;k<x.length;k+=16)AA=a,BB=b,CC=c,DD=d,a=FF(a,b,c,d,x[k+0],S11,3614090360),d=FF(d,a,b,c,x[k+1],S12,3905402710),c=FF(c,d,a,b,x[k+2],S13,606105819),b=FF(b,c,d,a,x[k+3],S14,3250441966),a=FF(a,b,c,d,x[k+4],S11,4118548399),d=FF(d,a,b,c,x[k+5],S12,1200080426),c=FF(c,d,a,b,x[k+6],S13,2821735955),b=FF(b,c,d,a,x[k+7],S14,4249261313),a=FF(a,b,c,d,x[k+8],S11,1770035416),d=FF(d,a,b,c,x[k+9],S12,2336552879),c=FF(c,d,a,b,x[k+10],S13,4294925233),b=FF(b,c,d,a,x[k+11],S14,2304563134),a=FF(a,b,c,d,x[k+12],S11,1804603682),d=FF(d,a,b,c,x[k+13],S12,4254626195),c=FF(c,d,a,b,x[k+14],S13,2792965006),b=FF(b,c,d,a,x[k+15],S14,1236535329),a=GG(a,b,c,d,x[k+1],S21,4129170786),d=GG(d,a,b,c,x[k+6],S22,3225465664),c=GG(c,d,a,b,x[k+11],S23,643717713),b=GG(b,c,d,a,x[k+0],S24,3921069994),a=GG(a,b,c,d,x[k+5],S21,3593408605),d=GG(d,a,b,c,x[k+10],S22,38016083),c=GG(c,d,a,b,x[k+15],S23,3634488961),b=GG(b,c,d,a,x[k+4],S24,3889429448),a=GG(a,b,c,d,x[k+9],S21,568446438),d=GG(d,a,b,c,x[k+14],S22,3275163606),c=GG(c,d,a,b,x[k+3],S23,4107603335),b=GG(b,c,d,a,x[k+8],S24,1163531501),a=GG(a,b,c,d,x[k+13],S21,2850285829),d=GG(d,a,b,c,x[k+2],S22,4243563512),c=GG(c,d,a,b,x[k+7],S23,1735328473),b=GG(b,c,d,a,x[k+12],S24,2368359562),a=HH(a,b,c,d,x[k+5],S31,4294588738),d=HH(d,a,b,c,x[k+8],S32,2272392833),c=HH(c,d,a,b,x[k+11],S33,1839030562),b=HH(b,c,d,a,x[k+14],S34,4259657740),a=HH(a,b,c,d,x[k+1],S31,2763975236),d=HH(d,a,b,c,x[k+4],S32,1272893353),c=HH(c,d,a,b,x[k+7],S33,4139469664),b=HH(b,c,d,a,x[k+10],S34,3200236656),a=HH(a,b,c,d,x[k+13],S31,681279174),d=HH(d,a,b,c,x[k+0],S32,3936430074),c=HH(c,d,a,b,x[k+3],S33,3572445317),b=HH(b,c,d,a,x[k+6],S34,76029189),a=HH(a,b,c,d,x[k+9],S31,3654602809),d=HH(d,a,b,c,x[k+12],S32,3873151461),c=HH(c,d,a,b,x[k+15],S33,530742520),b=HH(b,c,d,a,x[k+2],S34,3299628645),a=II(a,b,c,d,x[k+0],S41,4096336452),d=II(d,a,b,c,x[k+7],S42,1126891415),c=II(c,d,a,b,x[k+14],S43,2878612391),b=II(b,c,d,a,x[k+5],S44,4237533241),a=II(a,b,c,d,x[k+12],S41,1700485571),d=II(d,a,b,c,x[k+3],S42,2399980690),c=II(c,d,a,b,x[k+10],S43,4293915773),b=II(b,c,d,a,x[k+1],S44,2240044497),a=II(a,b,c,d,x[k+8],S41,1873313359),d=II(d,a,b,c,x[k+15],S42,4264355552),c=II(c,d,a,b,x[k+6],S43,2734768916),b=II(b,c,d,a,x[k+13],S44,1309151649),a=II(a,b,c,d,x[k+4],S41,4149444226),d=II(d,a,b,c,x[k+11],S42,3174756917),c=II(c,d,a,b,x[k+2],S43,718787259),b=II(b,c,d,a,x[k+9],S44,3951481745),a=AddUnsigned(a,AA),b=AddUnsigned(b,BB),c=AddUnsigned(c,CC),d=AddUnsigned(d,DD);var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase()}},JsSIP.Utils=Utils}(JsSIP),function(JsSIP){function rfc3261_8_2_2_1(){return"sip"!==message.s("to").uri.scheme?(reply(416),!1):void 0}function rfc3261_16_3_4(){return message.to_tag||message.call_id.substr(0,5)!==ua.configuration.jssip_id?void 0:(reply(482),!1)}function rfc3261_18_3_request(){var len=JsSIP.Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");return contentLength>len?(reply(400),!1):void 0}function rfc3261_8_2_2_2(){var tr,idx,fromTag=message.from_tag,call_id=message.call_id,cseq=message.cseq;if(!message.to_tag)if(message.method===JsSIP.C.INVITE){if(tr=ua.transactions.ist[message.via_branch],!tr)return;for(idx in ua.transactions.ist)if(tr=ua.transactions.ist[idx],tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq)return reply(482),!1}else{if(tr=ua.transactions.nist[message.via_branch],!tr)return;for(idx in ua.transactions.nist)if(tr=ua.transactions.nist[idx],tr.request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq)return reply(482),!1}}function rfc3261_8_1_3_3(){return message.countHeader("via")>1?(console.warn(LOG_PREFIX+"More than one Via header field present in the response. Dropping the response"),!1):void 0}function rfc3261_18_1_2(){var via_host=ua.configuration.via_host;return message.via.host!==via_host?(console.warn(LOG_PREFIX+"Via host in the response does not match UA Via host value. Dropping the response"),!1):void 0}function rfc3261_18_3_response(){var len=JsSIP.Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");return contentLength>len?(console.warn(LOG_PREFIX+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1):void 0}function minimumHeaders(){for(var mandatoryHeaders=["from","to","call_id","cseq","via"],idx=mandatoryHeaders.length;idx--;)if(!message.hasHeader(mandatoryHeaders[idx]))return console.warn(LOG_PREFIX+"Missing mandatory header field : "+mandatoryHeaders[idx]+". Dropping the response"),!1}function reply(status_code){var to,response="SIP/2.0 "+status_code+" "+JsSIP.C.REASON_PHRASE[status_code]+"\r\n",via_length=message.countHeader("via"),idx=0;for(idx;via_length>idx;idx++)response+="Via: "+message.getHeader("via",idx)+"\r\n";to=message.getHeader("To"),message.to_tag||(to+=";tag="+JsSIP.Utils.newTag()),response+="To: "+to+"\r\n",response+="From: "+message.getHeader("From")+"\r\n",response+="Call-ID: "+message.call_id+"\r\n",response+="CSeq: "+message.cseq+" "+message.method+"\r\n",response+="\r\n",transport.send(response)}var sanityCheck,message,ua,transport,LOG_PREFIX=JsSIP.name+" | SANITY CHECK | ",requests=[],responses=[],all=[];requests.push(rfc3261_8_2_2_1),requests.push(rfc3261_16_3_4),requests.push(rfc3261_18_3_request),requests.push(rfc3261_8_2_2_2),responses.push(rfc3261_8_1_3_3),responses.push(rfc3261_18_1_2),responses.push(rfc3261_18_3_response),all.push(minimumHeaders),sanityCheck=function(m,u,t){var len,pass;for(message=m,ua=u,transport=t,len=all.length;len--;)if(pass=all[len](message),pass===!1)return!1;if(message instanceof JsSIP.IncomingRequest){for(len=requests.length;len--;)if(pass=requests[len](message),pass===!1)return!1}else if(message instanceof JsSIP.IncomingResponse)for(len=responses.length;len--;)if(pass=responses[len](message),pass===!1)return!1;return!0},JsSIP.sanityCheck=sanityCheck}(JsSIP),function(JsSIP){var DigestAuthentication,LOG_PREFIX=JsSIP.name+" | DIGEST AUTHENTICATION | ";DigestAuthentication=function(ua){this.username=ua.configuration.authorization_user,this.password=ua.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},DigestAuthentication.prototype.authenticate=function(request,challenge){if(this.algorithm=challenge.algorithm,this.realm=challenge.realm,this.nonce=challenge.nonce,this.opaque=challenge.opaque,this.stale=challenge.stale,this.algorithm){if("MD5"!==this.algorithm)return console.warn(LOG_PREFIX+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(LOG_PREFIX+"challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return console.warn(LOG_PREFIX+"challenge without Digest nonce, authentication aborted"),!1;if(challenge.qop)if(challenge.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(challenge.qop.indexOf("auth-int")>-1))return console.warn(LOG_PREFIX+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=request.method,this.uri=request.ruri,this.cnonce=JsSIP.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},DigestAuthentication.prototype.calculateResponse=function(){var ha1,ha2;ha1=JsSIP.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(ha2=JsSIP.Utils.calculateMD5(this.method+":"+this.uri),this.response=JsSIP.Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+ha2)):"auth-int"===this.qop?(ha2=JsSIP.Utils.calculateMD5(this.method+":"+this.uri+":"+JsSIP.Utils.calculateMD5(this.body?this.body:"")),this.response=JsSIP.Utils.calculateMD5(ha1+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+ha2)):null===this.qop&&(ha2=JsSIP.Utils.calculateMD5(this.method+":"+this.uri),this.response=JsSIP.Utils.calculateMD5(ha1+":"+this.nonce+":"+ha2))},DigestAuthentication.prototype.toString=function(){var auth_params=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return auth_params.push("algorithm="+this.algorithm),auth_params.push('username="'+this.username+'"'),auth_params.push('realm="'+this.realm+'"'),auth_params.push('nonce="'+this.nonce+'"'),auth_params.push('uri="'+this.uri+'"'),auth_params.push('response="'+this.response+'"'),this.opaque&&auth_params.push('opaque="'+this.opaque+'"'),this.qop&&(auth_params.push("qop="+this.qop),auth_params.push('cnonce="'+this.cnonce+'"'),auth_params.push("nc="+this.ncHex)),"Digest "+auth_params.join(", ")},DigestAuthentication.prototype.updateNcHex=function(){var hex=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-hex.length)+hex},JsSIP.DigestAuthentication=DigestAuthentication}(JsSIP),function(JsSIP){var WebRTC;WebRTC={},window.navigator.webkitGetUserMedia?WebRTC.getUserMedia=window.navigator.webkitGetUserMedia.bind(navigator):window.navigator.mozGetUserMedia?WebRTC.getUserMedia=window.navigator.mozGetUserMedia.bind(navigator):window.navigator.getUserMedia&&(WebRTC.getUserMedia=window.navigator.getUserMedia.bind(navigator)),window.webkitRTCPeerConnection?WebRTC.RTCPeerConnection=window.webkitRTCPeerConnection:window.mozRTCPeerConnection?WebRTC.RTCPeerConnection=window.mozRTCPeerConnection:window.RTCPeerConnection&&(WebRTC.RTCPeerConnection=window.RTCPeerConnection),window.webkitRTCSessionDescription?WebRTC.RTCSessionDescription=window.webkitRTCSessionDescription:window.mozRTCSessionDescription?WebRTC.RTCSessionDescription=window.mozRTCSessionDescription:window.RTCSessionDescription&&(WebRTC.RTCSessionDescription=window.RTCSessionDescription),WebRTC.RTCPeerConnection&&WebRTC.RTCPeerConnection.prototype&&(WebRTC.RTCPeerConnection.prototype.getLocalStreams||(WebRTC.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},WebRTC.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),WebRTC.isSupported=WebRTC.getUserMedia&&WebRTC.RTCPeerConnection&&WebRTC.RTCSessionDescription?!0:!1,JsSIP.WebRTC=WebRTC}(JsSIP),window.JsSIP=JsSIP}(window),JsSIP.Grammar=function(){function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var result={parse:function(input,startRule){function matchFailed(failure){rightmostFailuresPos>pos||(pos>rightmostFailuresPos&&(rightmostFailuresPos=pos,rightmostFailuresExpected=[]),rightmostFailuresExpected.push(failure))}function parse_CRLF(){var result0;return"\r\n"===input.substr(pos,2)?(result0="\r\n",pos+=2):(result0=null,0===reportFailures&&matchFailed('"\\r\\n"')),result0}function parse_DIGIT(){var result0;return/^[0-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[0-9]")),result0}function parse_ALPHA(){var result0;return/^[a-zA-Z]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-zA-Z]")),result0}function parse_HEXDIG(){var result0;return/^[0-9a-fA-F]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[0-9a-fA-F]")),result0}function parse_WSP(){var result0;return result0=parse_SP(),null===result0&&(result0=parse_HTAB()),result0}function parse_OCTET(){var result0;return/^[\0-\xFF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\0-\\xFF]")),result0}function parse_DQUOTE(){var result0;return/^["]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed('["]')),result0}function parse_SP(){var result0;return 32===input.charCodeAt(pos)?(result0=" ",pos++):(result0=null,0===reportFailures&&matchFailed('" "')),result0}function parse_HTAB(){var result0;return 9===input.charCodeAt(pos)?(result0="	",pos++):(result0=null,0===reportFailures&&matchFailed('"\\t"')),result0}function parse_alphanum(){var result0;return/^[a-zA-Z0-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-zA-Z0-9]")),result0}function parse_reserved(){var result0;return 59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","'))))))))))),result0}function parse_unreserved(){var result0;return result0=parse_alphanum(),null===result0&&(result0=parse_mark()),result0}function parse_mark(){var result0;return 45===input.charCodeAt(pos)?(result0="-",pos++):(result0=null,0===reportFailures&&matchFailed('"-"')),null===result0&&(95===input.charCodeAt(pos)?(result0="_",pos++):(result0=null,0===reportFailures&&matchFailed('"_"')),null===result0&&(46===input.charCodeAt(pos)?(result0=".",pos++):(result0=null,0===reportFailures&&matchFailed('"."')),null===result0&&(33===input.charCodeAt(pos)?(result0="!",pos++):(result0=null,0===reportFailures&&matchFailed('"!"')),null===result0&&(126===input.charCodeAt(pos)?(result0="~",pos++):(result0=null,0===reportFailures&&matchFailed('"~"')),null===result0&&(42===input.charCodeAt(pos)?(result0="*",pos++):(result0=null,0===reportFailures&&matchFailed('"*"')),null===result0&&(39===input.charCodeAt(pos)?(result0="'",pos++):(result0=null,0===reportFailures&&matchFailed('"\'"')),null===result0&&(40===input.charCodeAt(pos)?(result0="(",pos++):(result0=null,0===reportFailures&&matchFailed('"("')),null===result0&&(41===input.charCodeAt(pos)?(result0=")",pos++):(result0=null,0===reportFailures&&matchFailed('")"')))))))))),result0}function parse_escaped(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,37===input.charCodeAt(pos)?(result0="%",pos++):(result0=null,0===reportFailures&&matchFailed('"%"')),null!==result0?(result1=parse_HEXDIG(),null!==result1?(result2=parse_HEXDIG(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,escaped){return escaped.join("")}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_LWS(){var result0,result1,result2,pos0,pos1,pos2;for(pos0=pos,pos1=pos,pos2=pos,result0=[],result1=parse_WSP();null!==result1;)result0.push(result1),result1=parse_WSP();if(null!==result0?(result1=parse_CRLF(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos2)):(result0=null,pos=pos2),result0=null!==result0?result0:"",null!==result0){if(result2=parse_WSP(),null!==result2)for(result1=[];null!==result2;)result1.push(result2),result2=parse_WSP();else result1=null;null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){return" "}(pos0)),null===result0&&(pos=pos0),result0}function parse_SWS(){var result0;return result0=parse_LWS(),result0=null!==result0?result0:""}function parse_HCOLON(){var result0,result1,result2,pos0,pos1;for(pos0=pos,pos1=pos,result0=[],result1=parse_SP(),null===result1&&(result1=parse_HTAB());null!==result1;)result0.push(result1),result1=parse_SP(),null===result1&&(result1=parse_HTAB());return null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return":"}(pos0)),null===result0&&(pos=pos0),result0}function parse_TEXT_UTF8_TRIM(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result1=parse_TEXT_UTF8char(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_TEXT_UTF8char();else result0=null;if(null!==result0){for(result1=[],pos2=pos,result2=[],result3=parse_LWS();null!==result3;)result2.push(result3),result3=parse_LWS();for(null!==result2?(result3=parse_TEXT_UTF8char(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;){for(result1.push(result2),pos2=pos,result2=[],result3=parse_LWS();null!==result3;)result2.push(result3),result3=parse_LWS();null!==result2?(result3=parse_TEXT_UTF8char(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2)}null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_TEXT_UTF8char(){var result0;return/^[!-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[!-~]")),null===result0&&(result0=parse_UTF8_NONASCII()),result0}function parse_UTF8_NONASCII(){var result0;return/^[\x80-\uFFFF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\x80-\\uFFFF]")),result0}function parse_UTF8_CONT(){var result0;return/^[\x80-\xBF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\x80-\\xBF]")),result0}function parse_LHEX(){var result0;return result0=parse_DIGIT(),null===result0&&(/^[a-f]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-f]"))),result0}function parse_token(){var result0,result1,pos0;if(pos0=pos,result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')))))))))))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"'))))))))))));else result0=null;return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_token_nodot(){var result0,result1,pos0;if(pos0=pos,result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"'))))))))))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')))))))))));else result0=null;return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_separators(){var result0;return 40===input.charCodeAt(pos)?(result0="(",pos++):(result0=null,0===reportFailures&&matchFailed('"("')),null===result0&&(41===input.charCodeAt(pos)?(result0=")",pos++):(result0=null,0===reportFailures&&matchFailed('")"')),null===result0&&(60===input.charCodeAt(pos)?(result0="<",pos++):(result0=null,0===reportFailures&&matchFailed('"<"')),null===result0&&(62===input.charCodeAt(pos)?(result0=">",pos++):(result0=null,0===reportFailures&&matchFailed('">"')),null===result0&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')),null===result0&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(92===input.charCodeAt(pos)?(result0="\\",pos++):(result0=null,0===reportFailures&&matchFailed('"\\\\"')),null===result0&&(result0=parse_DQUOTE(),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0&&(91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0&&(123===input.charCodeAt(pos)?(result0="{",pos++):(result0=null,0===reportFailures&&matchFailed('"{"')),null===result0&&(125===input.charCodeAt(pos)?(result0="}",pos++):(result0=null,0===reportFailures&&matchFailed('"}"')),null===result0&&(result0=parse_SP(),null===result0&&(result0=parse_HTAB())))))))))))))))))),result0}function parse_word(){var result0,result1,pos0;if(pos0=pos,result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')),null===result1&&(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null===result1&&(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null===result1&&(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null===result1&&(62===input.charCodeAt(pos)?(result1=">",pos++):(result1=null,0===reportFailures&&matchFailed('">"')),null===result1&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1&&(92===input.charCodeAt(pos)?(result1="\\",pos++):(result1=null,0===reportFailures&&matchFailed('"\\\\"')),null===result1&&(result1=parse_DQUOTE(),null===result1&&(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null===result1&&(91===input.charCodeAt(pos)?(result1="[",pos++):(result1=null,0===reportFailures&&matchFailed('"["')),null===result1&&(93===input.charCodeAt(pos)?(result1="]",pos++):(result1=null,0===reportFailures&&matchFailed('"]"')),null===result1&&(63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null===result1&&(123===input.charCodeAt(pos)?(result1="{",pos++):(result1=null,0===reportFailures&&matchFailed('"{"')),null===result1&&(125===input.charCodeAt(pos)?(result1="}",pos++):(result1=null,0===reportFailures&&matchFailed('"}"'))))))))))))))))))))))))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_alphanum(),null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')),null===result1&&(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null===result1&&(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null===result1&&(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null===result1&&(62===input.charCodeAt(pos)?(result1=">",pos++):(result1=null,0===reportFailures&&matchFailed('">"')),null===result1&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1&&(92===input.charCodeAt(pos)?(result1="\\",pos++):(result1=null,0===reportFailures&&matchFailed('"\\\\"')),null===result1&&(result1=parse_DQUOTE(),null===result1&&(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null===result1&&(91===input.charCodeAt(pos)?(result1="[",pos++):(result1=null,0===reportFailures&&matchFailed('"["')),null===result1&&(93===input.charCodeAt(pos)?(result1="]",pos++):(result1=null,0===reportFailures&&matchFailed('"]"')),null===result1&&(63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null===result1&&(123===input.charCodeAt(pos)?(result1="{",pos++):(result1=null,0===reportFailures&&matchFailed('"{"')),null===result1&&(125===input.charCodeAt(pos)?(result1="}",pos++):(result1=null,0===reportFailures&&matchFailed('"}"')))))))))))))))))))))))));
else result0=null;return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_STAR(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return"*"}(pos0)),null===result0&&(pos=pos0),result0}function parse_SLASH(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return"/"}(pos0)),null===result0&&(pos=pos0),result0}function parse_EQUAL(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return"="}(pos0)),null===result0&&(pos=pos0),result0}function parse_LPAREN(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return"("}(pos0)),null===result0&&(pos=pos0),result0}function parse_RPAREN(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return")"}(pos0)),null===result0&&(pos=pos0),result0}function parse_RAQUOT(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,62===input.charCodeAt(pos)?(result0=">",pos++):(result0=null,0===reportFailures&&matchFailed('">"')),null!==result0?(result1=parse_SWS(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return">"}(pos0)),null===result0&&(pos=pos0),result0}function parse_LAQUOT(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return"<"}(pos0)),null===result0&&(pos=pos0),result0}function parse_COMMA(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return","}(pos0)),null===result0&&(pos=pos0),result0}function parse_SEMI(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return";"}(pos0)),null===result0&&(pos=pos0),result0}function parse_COLON(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_SWS(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return":"}(pos0)),null===result0&&(pos=pos0),result0}function parse_LDQUOT(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0?(result1=parse_DQUOTE(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return'"'}(pos0)),null===result0&&(pos=pos0),result0}function parse_RDQUOT(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_DQUOTE(),null!==result0?(result1=parse_SWS(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){return'"'}(pos0)),null===result0&&(pos=pos0),result0}function parse_comment(){var result0,result1,result2,pos0;if(pos0=pos,result0=parse_LPAREN(),null!==result0){for(result1=[],result2=parse_ctext(),null===result2&&(result2=parse_quoted_pair(),null===result2&&(result2=parse_comment()));null!==result2;)result1.push(result2),result2=parse_ctext(),null===result2&&(result2=parse_quoted_pair(),null===result2&&(result2=parse_comment()));null!==result1?(result2=parse_RPAREN(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_ctext(){var result0;return/^[!-']/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[!-']")),null===result0&&(/^[*-[]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[*-[]")),null===result0&&(/^[\]-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\]-~]")),null===result0&&(result0=parse_UTF8_NONASCII(),null===result0&&(result0=parse_LWS())))),result0}function parse_quoted_string(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0)if(result1=parse_DQUOTE(),null!==result1){for(result2=[],result3=parse_qdtext(),null===result3&&(result3=parse_quoted_pair());null!==result3;)result2.push(result3),result3=parse_qdtext(),null===result3&&(result3=parse_quoted_pair());null!==result2?(result3=parse_DQUOTE(),null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)):(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_quoted_string_clean(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,pos1=pos,result0=parse_SWS(),null!==result0)if(result1=parse_DQUOTE(),null!==result1){for(result2=[],result3=parse_qdtext(),null===result3&&(result3=parse_quoted_pair());null!==result3;)result2.push(result3),result3=parse_qdtext(),null===result3&&(result3=parse_quoted_pair());null!==result2?(result3=parse_DQUOTE(),null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)):(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){return input.substring(pos-1,offset+1)}(pos0)),null===result0&&(pos=pos0),result0}function parse_qdtext(){var result0;return result0=parse_LWS(),null===result0&&(33===input.charCodeAt(pos)?(result0="!",pos++):(result0=null,0===reportFailures&&matchFailed('"!"')),null===result0&&(/^[#-[]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[#-[]")),null===result0&&(/^[\]-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\]-~]")),null===result0&&(result0=parse_UTF8_NONASCII())))),result0}function parse_quoted_pair(){var result0,result1,pos0;return pos0=pos,92===input.charCodeAt(pos)?(result0="\\",pos++):(result0=null,0===reportFailures&&matchFailed('"\\\\"')),null!==result0?(/^[\0-\t]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\0-\\t]")),null===result1&&(/^[\x0B-\f]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\x0B-\\f]")),null===result1&&(/^[\x0E-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\x0E-]")))),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_SIP_URI_noparams(){var result0,result1,result2,result3,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_uri_scheme(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_userinfo(),result2=null!==result2?result2:"",null!==result2?(result3=parse_hostport(),null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){try{data.uri=new JsSIP.URI(data.scheme,data.user,data.host,data.port),delete data.scheme,delete data.user,delete data.host,delete data.host_type,delete data.port}catch(e){data=-1}}(pos0)),null===result0&&(pos=pos0),result0}function parse_SIP_URI(){var result0,result1,result2,result3,result4,result5,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_uri_scheme(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_userinfo(),result2=null!==result2?result2:"",null!==result2?(result3=parse_hostport(),null!==result3?(result4=parse_uri_parameters(),null!==result4?(result5=parse_headers(),result5=null!==result5?result5:"",null!==result5?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){try{data.uri=new JsSIP.URI(data.scheme,data.user,data.host,data.port,data.uri_params,data.uri_headers),delete data.scheme,delete data.user,delete data.host,delete data.host_type,delete data.port,delete data.uri_params,"SIP_URI"===startRule&&(data=data.uri)}catch(e){data=-1}}(pos0)),null===result0&&(pos=pos0),result0}function parse_uri_scheme(){var result0,pos0;return pos0=pos,"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"sip"')),null!==result0&&(result0=function(offset,uri_scheme){data.scheme=uri_scheme.toLowerCase()}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_userinfo(){var result0,result1,result2,pos0,pos1,pos2;return pos0=pos,pos1=pos,result0=parse_user(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_password(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(64===input.charCodeAt(pos)?(result2="@",pos++):(result2=null,0===reportFailures&&matchFailed('"@"')),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){data.user=window.decodeURIComponent(input.substring(pos-1,offset))}(pos0)),null===result0&&(pos=pos0),result0}function parse_user(){var result0,result1;if(result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_user_unreserved())),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_user_unreserved()));else result0=null;return result0}function parse_user_unreserved(){var result0;return 38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')),null===result0&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"'))))))))),result0}function parse_password(){var result0,result1,pos0;for(pos0=pos,result0=[],result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","'))))))));null!==result1;)result0.push(result1),result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","'))))))));return null!==result0&&(result0=function(offset){data.password=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_hostport(){var result0,result1,result2,pos0,pos1;return pos0=pos,result0=parse_host(),null!==result0?(pos1=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_port(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos1)):(result1=null,pos=pos1),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_host(){var result0,pos0;return pos0=pos,result0=parse_hostname(),null===result0&&(result0=parse_IPv4address(),null===result0&&(result0=parse_IPv6reference())),null!==result0&&(result0=function(offset){return data.host=input.substring(pos,offset).toLowerCase(),data.host}(pos0)),null===result0&&(pos=pos0),result0}function parse_hostname(){var result0,result1,result2,pos0,pos1,pos2;for(pos0=pos,pos1=pos,result0=[],pos2=pos,result1=parse_domainlabel(),null!==result1?(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2);null!==result1;)result0.push(result1),pos2=pos,result1=parse_domainlabel(),null!==result1?(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2);return null!==result0?(result1=parse_toplabel(),null!==result1?(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),result2=null!==result2?result2:"",null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){return data.host_type="domain",input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_domainlabel(){var result0,result1;if(/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[a-zA-Z0-9_\\-]")),null!==result1)for(result0=[];null!==result1;)result0.push(result1),/^[a-zA-Z0-9_\-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[a-zA-Z0-9_\\-]"));else result0=null;return result0}function parse_toplabel(){var result0,result1;if(/^[a-zA-Z_\-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[a-zA-Z_\\-]")),null!==result1)for(result0=[];null!==result1;)result0.push(result1),/^[a-zA-Z_\-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[a-zA-Z_\\-]"));else result0=null;return result0}function parse_IPv6reference(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null!==result0?(result1=parse_IPv6address(),null!==result1?(93===input.charCodeAt(pos)?(result2="]",pos++):(result2=null,0===reportFailures&&matchFailed('"]"')),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){return data.host_type="IPv6",input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_IPv6address(){var result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12,pos0,pos1,pos2;return pos0=pos,pos1=pos,result0=parse_h16(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?(58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5?(result6=parse_h16(),null!==result6?(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7?(result8=parse_h16(),null!==result8?(58===input.charCodeAt(pos)?(result9=":",pos++):(result9=null,0===reportFailures&&matchFailed('":"')),null!==result9?(result10=parse_h16(),null!==result10?(58===input.charCodeAt(pos)?(result11=":",pos++):(result11=null,0===reportFailures&&matchFailed('":"')),null!==result11?(result12=parse_ls32(),null!==result12?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_h16(),null!==result7?(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8?(result9=parse_h16(),null!==result9?(58===input.charCodeAt(pos)?(result10=":",pos++):(result10=null,0===reportFailures&&matchFailed('":"')),null!==result10?(result11=parse_ls32(),null!==result11?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_h16(),null!==result7?(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8?(result9=parse_ls32(),null!==result9?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_ls32(),null!==result7?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_ls32(),null!==result5?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_ls32(),null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_ls32(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0?(result1=parse_h16(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?("::"===input.substr(pos,2)?(result1="::",pos+=2):(result1=null,0===reportFailures&&matchFailed('"::"')),null!==result1?(result2=parse_h16(),null!==result2?(58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5?(result6=parse_h16(),null!==result6?(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7?(result8=parse_h16(),null!==result8?(58===input.charCodeAt(pos)?(result9=":",pos++):(result9=null,0===reportFailures&&matchFailed('":"')),null!==result9?(result10=parse_ls32(),null!==result10?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?("::"===input.substr(pos,2)?(result2="::",pos+=2):(result2=null,0===reportFailures&&matchFailed('"::"')),null!==result2?(result3=parse_h16(),null!==result3?(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_h16(),null!==result7?(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8?(result9=parse_ls32(),null!==result9?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2),result2=null!==result2?result2:"",null!==result2?("::"===input.substr(pos,2)?(result3="::",pos+=2):(result3=null,0===reportFailures&&matchFailed('"::"')),null!==result3?(result4=parse_h16(),null!==result4?(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5?(result6=parse_h16(),null!==result6?(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7?(result8=parse_ls32(),null!==result8?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2),result2=null!==result2?result2:"",null!==result2?(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos2)):(result3=null,pos=pos2),result3=null!==result3?result3:"",null!==result3?("::"===input.substr(pos,2)?(result4="::",pos+=2):(result4=null,0===reportFailures&&matchFailed('"::"')),null!==result4?(result5=parse_h16(),null!==result5?(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_ls32(),null!==result7?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2),result2=null!==result2?result2:"",null!==result2?(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos2)):(result3=null,pos=pos2),result3=null!==result3?result3:"",null!==result3?(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos2)):(result4=null,pos=pos2),result4=null!==result4?result4:"",null!==result4?("::"===input.substr(pos,2)?(result5="::",pos+=2):(result5=null,0===reportFailures&&matchFailed('"::"')),null!==result5?(result6=parse_ls32(),null!==result6?result0=[result0,result1,result2,result3,result4,result5,result6]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2),result2=null!==result2?result2:"",null!==result2?(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos2)):(result3=null,pos=pos2),result3=null!==result3?result3:"",null!==result3?(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos2)):(result4=null,pos=pos2),result4=null!==result4?result4:"",null!==result4?(pos2=pos,58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5?(result6=parse_h16(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2),result5=null!==result5?result5:"",null!==result5?("::"===input.substr(pos,2)?(result6="::",pos+=2):(result6=null,0===reportFailures&&matchFailed('"::"')),null!==result6?(result7=parse_h16(),null!==result7?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null===result0&&(pos1=pos,result0=parse_h16(),null!==result0?(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2?(result3=parse_h16(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2),result2=null!==result2?result2:"",null!==result2?(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3?(result4=parse_h16(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos2)):(result3=null,pos=pos2),result3=null!==result3?result3:"",null!==result3?(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4?(result5=parse_h16(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos2)):(result4=null,pos=pos2),result4=null!==result4?result4:"",null!==result4?(pos2=pos,58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5?(result6=parse_h16(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2),result5=null!==result5?result5:"",null!==result5?(pos2=pos,58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6?(result7=parse_h16(),null!==result7?result6=[result6,result7]:(result6=null,pos=pos2)):(result6=null,pos=pos2),result6=null!==result6?result6:"",null!==result6?("::"===input.substr(pos,2)?(result7="::",pos+=2):(result7=null,0===reportFailures&&matchFailed('"::"')),null!==result7?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1))))))))))))))),null!==result0&&(result0=function(offset){return data.host_type="IPv6",input.substring(pos,offset)
}(pos0)),null===result0&&(pos=pos0),result0}function parse_h16(){var result0,result1,result2,result3,pos0;return pos0=pos,result0=parse_HEXDIG(),null!==result0?(result1=parse_HEXDIG(),result1=null!==result1?result1:"",null!==result1?(result2=parse_HEXDIG(),result2=null!==result2?result2:"",null!==result2?(result3=parse_HEXDIG(),result3=null!==result3?result3:"",null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_ls32(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_h16(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_h16(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),null===result0&&(result0=parse_IPv4address()),result0}function parse_IPv4address(){var result0,result1,result2,result3,result4,result5,result6,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_dec_octet(),null!==result0?(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null!==result1?(result2=parse_dec_octet(),null!==result2?(46===input.charCodeAt(pos)?(result3=".",pos++):(result3=null,0===reportFailures&&matchFailed('"."')),null!==result3?(result4=parse_dec_octet(),null!==result4?(46===input.charCodeAt(pos)?(result5=".",pos++):(result5=null,0===reportFailures&&matchFailed('"."')),null!==result5?(result6=parse_dec_octet(),null!==result6?result0=[result0,result1,result2,result3,result4,result5,result6]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){return data.host_type="IPv4",input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_dec_octet(){var result0,result1,result2,pos0;return pos0=pos,"25"===input.substr(pos,2)?(result0="25",pos+=2):(result0=null,0===reportFailures&&matchFailed('"25"')),null!==result0?(/^[0-5]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[0-5]")),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),null===result0&&(pos0=pos,50===input.charCodeAt(pos)?(result0="2",pos++):(result0=null,0===reportFailures&&matchFailed('"2"')),null!==result0?(/^[0-4]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[0-4]")),null!==result1?(result2=parse_DIGIT(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),null===result0&&(pos0=pos,49===input.charCodeAt(pos)?(result0="1",pos++):(result0=null,0===reportFailures&&matchFailed('"1"')),null!==result0?(result1=parse_DIGIT(),null!==result1?(result2=parse_DIGIT(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),null===result0&&(pos0=pos,/^[1-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[1-9]")),null!==result0?(result1=parse_DIGIT(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),null===result0&&(result0=parse_DIGIT())))),result0}function parse_port(){var result0,result1,result2,result3,result4,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_DIGIT(),result0=null!==result0?result0:"",null!==result0?(result1=parse_DIGIT(),result1=null!==result1?result1:"",null!==result1?(result2=parse_DIGIT(),result2=null!==result2?result2:"",null!==result2?(result3=parse_DIGIT(),result3=null!==result3?result3:"",null!==result3?(result4=parse_DIGIT(),result4=null!==result4?result4:"",null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,port){return port=parseInt(port.join("")),data.port=port,port}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_uri_parameters(){var result0,result1,result2,pos0;for(result0=[],pos0=pos,59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1?(result2=parse_uri_parameter(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos0)):(result1=null,pos=pos0);null!==result1;)result0.push(result1),pos0=pos,59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1?(result2=parse_uri_parameter(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos0)):(result1=null,pos=pos0);return result0}function parse_uri_parameter(){var result0;return result0=parse_transport_param(),null===result0&&(result0=parse_user_param(),null===result0&&(result0=parse_method_param(),null===result0&&(result0=parse_ttl_param(),null===result0&&(result0=parse_maddr_param(),null===result0&&(result0=parse_lr_param(),null===result0&&(result0=parse_other_param())))))),result0}function parse_transport_param(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,"transport="===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"transport="')),null!==result0?("udp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"udp"')),null===result1&&("tcp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"tcp"')),null===result1&&("sctp"===input.substr(pos,4).toLowerCase()?(result1=input.substr(pos,4),pos+=4):(result1=null,0===reportFailures&&matchFailed('"sctp"')),null===result1&&("tls"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"tls"')),null===result1&&(result1=parse_token())))),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,transport){data.uri_params||(data.uri_params={}),data.uri_params.transport=transport.toLowerCase()}(pos0,result0[1])),null===result0&&(pos=pos0),result0}function parse_user_param(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,"user="===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"user="')),null!==result0?("phone"===input.substr(pos,5).toLowerCase()?(result1=input.substr(pos,5),pos+=5):(result1=null,0===reportFailures&&matchFailed('"phone"')),null===result1&&("ip"===input.substr(pos,2).toLowerCase()?(result1=input.substr(pos,2),pos+=2):(result1=null,0===reportFailures&&matchFailed('"ip"')),null===result1&&(result1=parse_token())),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,user){data.uri_params||(data.uri_params={}),data.uri_params.user=user.toLowerCase()}(pos0,result0[1])),null===result0&&(pos=pos0),result0}function parse_method_param(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,"method="===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"method="')),null!==result0?(result1=parse_Method(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,method){data.uri_params||(data.uri_params={}),data.uri_params.method=method}(pos0,result0[1])),null===result0&&(pos=pos0),result0}function parse_ttl_param(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,"ttl="===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"ttl="')),null!==result0?(result1=parse_ttl(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,ttl){data.params||(data.params={}),data.params.ttl=ttl}(pos0,result0[1])),null===result0&&(pos=pos0),result0}function parse_maddr_param(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,"maddr="===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"maddr="')),null!==result0?(result1=parse_host(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,maddr){data.uri_params||(data.uri_params={}),data.uri_params.maddr=maddr}(pos0,result0[1])),null===result0&&(pos=pos0),result0}function parse_lr_param(){var result0,result1,result2,pos0,pos1,pos2;return pos0=pos,pos1=pos,"lr"===input.substr(pos,2).toLowerCase()?(result0=input.substr(pos,2),pos+=2):(result0=null,0===reportFailures&&matchFailed('"lr"')),null!==result0?(pos2=pos,61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1?(result2=parse_token(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(){data.uri_params||(data.uri_params={}),data.uri_params.lr=void 0}(pos0)),null===result0&&(pos=pos0),result0}function parse_other_param(){var result0,result1,result2,pos0,pos1,pos2;return pos0=pos,pos1=pos,result0=parse_pname(),null!==result0?(pos2=pos,61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1?(result2=parse_pvalue(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,param,value){data.uri_params||(data.uri_params={}),value="undefined"==typeof value?void 0:value[1],data.uri_params[param.toLowerCase()]=value&&value.toLowerCase()}(pos0,result0[0],result0[1])),null===result0&&(pos=pos0),result0}function parse_pname(){var result0,result1,pos0;if(pos0=pos,result1=parse_paramchar(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_paramchar();else result0=null;return null!==result0&&(result0=function(offset,pname){return pname.join("")}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_pvalue(){var result0,result1,pos0;if(pos0=pos,result1=parse_paramchar(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_paramchar();else result0=null;return null!==result0&&(result0=function(offset,pvalue){return pvalue.join("")}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_paramchar(){var result0;return result0=parse_param_unreserved(),null===result0&&(result0=parse_unreserved(),null===result0&&(result0=parse_escaped())),result0}function parse_param_unreserved(){var result0;return 91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')))))))),result0}function parse_headers(){var result0,result1,result2,result3,result4,pos0,pos1;if(pos0=pos,63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null!==result0)if(result1=parse_header(),null!==result1){for(result2=[],pos1=pos,38===input.charCodeAt(pos)?(result3="&",pos++):(result3=null,0===reportFailures&&matchFailed('"&"')),null!==result3?(result4=parse_header(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos1)):(result3=null,pos=pos1);null!==result3;)result2.push(result3),pos1=pos,38===input.charCodeAt(pos)?(result3="&",pos++):(result3=null,0===reportFailures&&matchFailed('"&"')),null!==result3?(result4=parse_header(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos1)):(result3=null,pos=pos1);null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_header(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_hname(),null!==result0?(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1?(result2=parse_hvalue(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,hname,hvalue){hname=hname.join("").toLowerCase(),hvalue=hvalue.join(""),data.uri_headers||(data.uri_headers={}),data.uri_headers[hname]?data.uri_headers[hname].push(hvalue):data.uri_headers[hname]=[hvalue]}(pos0,result0[0],result0[2])),null===result0&&(pos=pos0),result0}function parse_hname(){var result0,result1;if(result1=parse_hnv_unreserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped())),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_hnv_unreserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped()));else result0=null;return result0}function parse_hvalue(){var result0,result1;for(result0=[],result1=parse_hnv_unreserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped()));null!==result1;)result0.push(result1),result1=parse_hnv_unreserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped()));return result0}function parse_hnv_unreserved(){var result0;return 91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')))))))),result0}function parse_Request_Response(){var result0;return result0=parse_Status_Line(),null===result0&&(result0=parse_Request_Line()),result0}function parse_Request_Line(){var result0,result1,result2,result3,result4,pos0;return pos0=pos,result0=parse_Method(),null!==result0?(result1=parse_SP(),null!==result1?(result2=parse_Request_URI(),null!==result2?(result3=parse_SP(),null!==result3?(result4=parse_SIP_Version(),null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_Request_URI(){var result0;return result0=parse_SIP_URI(),null===result0&&(result0=parse_absoluteURI()),result0}function parse_absoluteURI(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_scheme(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_hier_part(),null===result2&&(result2=parse_opaque_part()),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_hier_part(){var result0,result1,result2,pos0,pos1;return pos0=pos,result0=parse_net_path(),null===result0&&(result0=parse_abs_path()),null!==result0?(pos1=pos,63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null!==result1?(result2=parse_query(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos1)):(result1=null,pos=pos1),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_net_path(){var result0,result1,result2,pos0;return pos0=pos,"//"===input.substr(pos,2)?(result0="//",pos+=2):(result0=null,0===reportFailures&&matchFailed('"//"')),null!==result0?(result1=parse_authority(),null!==result1?(result2=parse_abs_path(),result2=null!==result2?result2:"",null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_abs_path(){var result0,result1,pos0;return pos0=pos,47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null!==result0?(result1=parse_path_segments(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_opaque_part(){var result0,result1,result2,pos0;if(pos0=pos,result0=parse_uric_no_slash(),null!==result0){for(result1=[],result2=parse_uric();null!==result2;)result1.push(result2),result2=parse_uric();null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_uric(){var result0;return result0=parse_reserved(),null===result0&&(result0=parse_unreserved(),null===result0&&(result0=parse_escaped())),result0}function parse_uric_no_slash(){var result0;return result0=parse_unreserved(),null===result0&&(result0=parse_escaped(),null===result0&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')))))))))))),result0}function parse_path_segments(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_segment(),null!==result0){for(result1=[],pos1=pos,47===input.charCodeAt(pos)?(result2="/",pos++):(result2=null,0===reportFailures&&matchFailed('"/"')),null!==result2?(result3=parse_segment(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,47===input.charCodeAt(pos)?(result2="/",pos++):(result2=null,0===reportFailures&&matchFailed('"/"')),null!==result2?(result3=parse_segment(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_segment(){var result0,result1,result2,result3,pos0,pos1;for(pos0=pos,result0=[],result1=parse_pchar();null!==result1;)result0.push(result1),result1=parse_pchar();if(null!==result0){for(result1=[],pos1=pos,59===input.charCodeAt(pos)?(result2=";",pos++):(result2=null,0===reportFailures&&matchFailed('";"')),null!==result2?(result3=parse_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,59===input.charCodeAt(pos)?(result2=";",pos++):(result2=null,0===reportFailures&&matchFailed('";"')),null!==result2?(result3=parse_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_param(){var result0,result1;for(result0=[],result1=parse_pchar();null!==result1;)result0.push(result1),result1=parse_pchar();return result0}function parse_pchar(){var result0;return result0=parse_unreserved(),null===result0&&(result0=parse_escaped(),null===result0&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')))))))))),result0}function parse_scheme(){var result0,result1,result2,pos0,pos1;if(pos0=pos,pos1=pos,result0=parse_ALPHA(),null!==result0){for(result1=[],result2=parse_ALPHA(),null===result2&&(result2=parse_DIGIT(),null===result2&&(43===input.charCodeAt(pos)?(result2="+",pos++):(result2=null,0===reportFailures&&matchFailed('"+"')),null===result2&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."'))))));null!==result2;)result1.push(result2),result2=parse_ALPHA(),null===result2&&(result2=parse_DIGIT(),null===result2&&(43===input.charCodeAt(pos)?(result2="+",pos++):(result2=null,0===reportFailures&&matchFailed('"+"')),null===result2&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."'))))));null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){data.scheme=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_authority(){var result0;return result0=parse_srvr(),null===result0&&(result0=parse_reg_name()),result0}function parse_srvr(){var result0,result1,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_userinfo(),null!==result0?(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),result0=null!==result0?result0:"",null!==result0?(result1=parse_hostport(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0=null!==result0?result0:""}function parse_reg_name(){var result0,result1;if(result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null===result1&&(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null===result1&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1&&(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null===result1&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"'))))))))))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null===result1&&(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null===result1&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1&&(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null===result1&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')))))))))));else result0=null;return result0}function parse_query(){var result0,result1;for(result0=[],result1=parse_uric();null!==result1;)result0.push(result1),result1=parse_uric();return result0}function parse_SIP_Version(){var result0,result1,result2,result3,result4,result5,pos0,pos1;if(pos0=pos,pos1=pos,"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"SIP"')),null!==result0)if(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null!==result1){if(result3=parse_DIGIT(),null!==result3)for(result2=[];null!==result3;)result2.push(result3),result3=parse_DIGIT();else result2=null;if(null!==result2)if(46===input.charCodeAt(pos)?(result3=".",pos++):(result3=null,0===reportFailures&&matchFailed('"."')),null!==result3){if(result5=parse_DIGIT(),null!==result5)for(result4=[];null!==result5;)result4.push(result5),result5=parse_DIGIT();else result4=null;null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1}else result0=null,pos=pos1;else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){data.sip_version=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_INVITEm(){var result0;return"INVITE"===input.substr(pos,6)?(result0="INVITE",pos+=6):(result0=null,0===reportFailures&&matchFailed('"INVITE"')),result0}function parse_ACKm(){var result0;return"ACK"===input.substr(pos,3)?(result0="ACK",pos+=3):(result0=null,0===reportFailures&&matchFailed('"ACK"')),result0}function parse_OPTIONSm(){var result0;return"OPTIONS"===input.substr(pos,7)?(result0="OPTIONS",pos+=7):(result0=null,0===reportFailures&&matchFailed('"OPTIONS"')),result0}function parse_BYEm(){var result0;return"BYE"===input.substr(pos,3)?(result0="BYE",pos+=3):(result0=null,0===reportFailures&&matchFailed('"BYE"')),result0}function parse_CANCELm(){var result0;return"CANCEL"===input.substr(pos,6)?(result0="CANCEL",pos+=6):(result0=null,0===reportFailures&&matchFailed('"CANCEL"')),result0}function parse_REGISTERm(){var result0;return"REGISTER"===input.substr(pos,8)?(result0="REGISTER",pos+=8):(result0=null,0===reportFailures&&matchFailed('"REGISTER"')),result0}function parse_SUBSCRIBEm(){var result0;return"SUBSCRIBE"===input.substr(pos,9)?(result0="SUBSCRIBE",pos+=9):(result0=null,0===reportFailures&&matchFailed('"SUBSCRIBE"')),result0}function parse_NOTIFYm(){var result0;return"NOTIFY"===input.substr(pos,6)?(result0="NOTIFY",pos+=6):(result0=null,0===reportFailures&&matchFailed('"NOTIFY"')),result0}function parse_Method(){var result0,pos0;return pos0=pos,result0=parse_INVITEm(),null===result0&&(result0=parse_ACKm(),null===result0&&(result0=parse_OPTIONSm(),null===result0&&(result0=parse_BYEm(),null===result0&&(result0=parse_CANCELm(),null===result0&&(result0=parse_REGISTERm(),null===result0&&(result0=parse_SUBSCRIBEm(),null===result0&&(result0=parse_NOTIFYm(),null===result0&&(result0=parse_token())))))))),null!==result0&&(result0=function(offset){return data.method=input.substring(pos,offset),data.method}(pos0)),null===result0&&(pos=pos0),result0}function parse_Status_Line(){var result0,result1,result2,result3,result4,pos0;return pos0=pos,result0=parse_SIP_Version(),null!==result0?(result1=parse_SP(),null!==result1?(result2=parse_Status_Code(),null!==result2?(result3=parse_SP(),null!==result3?(result4=parse_Reason_Phrase(),null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_Status_Code(){var result0,pos0;return pos0=pos,result0=parse_extension_code(),null!==result0&&(result0=function(offset,status_code){data.status_code=parseInt(status_code.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_extension_code(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_DIGIT(),null!==result0?(result1=parse_DIGIT(),null!==result1?(result2=parse_DIGIT(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_Reason_Phrase(){var result0,result1,pos0;for(pos0=pos,result0=[],result1=parse_reserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_UTF8_NONASCII(),null===result1&&(result1=parse_UTF8_CONT(),null===result1&&(result1=parse_SP(),null===result1&&(result1=parse_HTAB()))))));null!==result1;)result0.push(result1),result1=parse_reserved(),null===result1&&(result1=parse_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_UTF8_NONASCII(),null===result1&&(result1=parse_UTF8_CONT(),null===result1&&(result1=parse_SP(),null===result1&&(result1=parse_HTAB()))))));return null!==result0&&(result0=function(offset){data.reason_phrase=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_Allow_Events(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_event_type(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_event_type(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_event_type(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_Call_ID(){var result0,result1,result2,pos0,pos1,pos2;return pos0=pos,pos1=pos,result0=parse_word(),null!==result0?(pos2=pos,64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null!==result1?(result2=parse_word(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){data=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_Contact(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,result0=parse_STAR(),null===result0)if(pos1=pos,result0=parse_contact_param(),null!==result0){for(result1=[],pos2=pos,result2=parse_COMMA(),null!==result2?(result3=parse_contact_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_COMMA(),null!==result2?(result3=parse_contact_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);
null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){var idx,length;for(length=data.multi_header.length,idx=0;length>idx;idx++)if(null===data.multi_header[idx].parsed){data=null;break}data=null!==data?data.multi_header:-1}(pos0)),null===result0&&(pos=pos0),result0}function parse_contact_param(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_SIP_URI_noparams(),null===result0&&(result0=parse_name_addr()),null!==result0){for(result1=[],pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_contact_params(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_contact_params(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){var header;data.multi_header||(data.multi_header=[]);try{header=new JsSIP.NameAddrHeader(data.uri,data.display_name,data.params),delete data.uri,delete data.display_name,delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)),null===result0&&(pos=pos0),result0}function parse_name_addr(){var result0,result1,result2,result3,pos0;return pos0=pos,result0=parse_display_name(),result0=null!==result0?result0:"",null!==result0?(result1=parse_LAQUOT(),null!==result1?(result2=parse_SIP_URI(),null!==result2?(result3=parse_RAQUOT(),null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_display_name(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_token(),null!==result0){for(result1=[],pos2=pos,result2=parse_LWS(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_LWS(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===result0&&(result0=parse_quoted_string()),null!==result0&&(result0=function(offset,display_name){display_name=input.substring(pos,offset).trim(),'"'===display_name[0]&&(display_name=display_name.substring(1,display_name.length-1)),data.display_name=display_name}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_contact_params(){var result0;return result0=parse_c_p_q(),null===result0&&(result0=parse_c_p_expires(),null===result0&&(result0=parse_generic_param())),result0}function parse_c_p_q(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"q"===input.substr(pos,1).toLowerCase()?(result0=input.substr(pos,1),pos++):(result0=null,0===reportFailures&&matchFailed('"q"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_qvalue(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,q){data.params||(data.params={}),data.params.q=q}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_c_p_expires(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"expires"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"expires"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_delta_seconds(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,expires){data.params||(data.params={}),data.params.expires=expires}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_delta_seconds(){var result0,result1,pos0;if(pos0=pos,result1=parse_DIGIT(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null!==result0&&(result0=function(offset,delta_seconds){return parseInt(delta_seconds.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_qvalue(){var result0,result1,result2,result3,result4,pos0,pos1,pos2;return pos0=pos,pos1=pos,48===input.charCodeAt(pos)?(result0="0",pos++):(result0=null,0===reportFailures&&matchFailed('"0"')),null!==result0?(pos2=pos,46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null!==result1?(result2=parse_DIGIT(),result2=null!==result2?result2:"",null!==result2?(result3=parse_DIGIT(),result3=null!==result3?result3:"",null!==result3?(result4=parse_DIGIT(),result4=null!==result4?result4:"",null!==result4?result1=[result1,result2,result3,result4]:(result1=null,pos=pos2)):(result1=null,pos=pos2)):(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset){return parseFloat(input.substring(pos,offset))}(pos0)),null===result0&&(pos=pos0),result0}function parse_generic_param(){var result0,result1,result2,pos0,pos1,pos2;return pos0=pos,pos1=pos,result0=parse_token(),null!==result0?(pos2=pos,result1=parse_EQUAL(),null!==result1?(result2=parse_gen_value(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)):(result1=null,pos=pos2),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,param,value){data.params||(data.params={}),value="undefined"==typeof value?void 0:value[1],data.params[param.toLowerCase()]=value}(pos0,result0[0],result0[1])),null===result0&&(pos=pos0),result0}function parse_gen_value(){var result0;return result0=parse_token(),null===result0&&(result0=parse_host(),null===result0&&(result0=parse_quoted_string())),result0}function parse_Content_Disposition(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_disp_type(),null!==result0){for(result1=[],pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_disp_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_disp_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_disp_type(){var result0;return"render"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"render"')),null===result0&&("session"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"session"')),null===result0&&("icon"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"icon"')),null===result0&&("alert"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"alert"')),null===result0&&(result0=parse_token())))),result0}function parse_disp_param(){var result0;return result0=parse_handling_param(),null===result0&&(result0=parse_generic_param()),result0}function parse_handling_param(){var result0,result1,result2,pos0;return pos0=pos,"handling"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"handling"')),null!==result0?(result1=parse_EQUAL(),null!==result1?("optional"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"optional"')),null===result2&&("required"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"required"')),null===result2&&(result2=parse_token())),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_Content_Encoding(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_token(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_Content_Length(){var result0,result1,pos0;if(pos0=pos,result1=parse_DIGIT(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null!==result0&&(result0=function(offset,length){data=parseInt(length.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Content_Type(){var result0,pos0;return pos0=pos,result0=parse_media_type(),null!==result0&&(result0=function(offset){data=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_media_type(){var result0,result1,result2,result3,result4,result5,pos0,pos1;if(pos0=pos,result0=parse_m_type(),null!==result0)if(result1=parse_SLASH(),null!==result1)if(result2=parse_m_subtype(),null!==result2){for(result3=[],pos1=pos,result4=parse_SEMI(),null!==result4?(result5=parse_m_parameter(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,result4=parse_SEMI(),null!==result4?(result5=parse_m_parameter(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_m_type(){var result0;return result0=parse_discrete_type(),null===result0&&(result0=parse_composite_type()),result0}function parse_discrete_type(){var result0;return"text"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"text"')),null===result0&&("image"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"image"')),null===result0&&("audio"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"audio"')),null===result0&&("video"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"video"')),null===result0&&("application"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"application"')),null===result0&&(result0=parse_extension_token()))))),result0}function parse_composite_type(){var result0;return"message"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"message"')),null===result0&&("multipart"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"multipart"')),null===result0&&(result0=parse_extension_token())),result0}function parse_extension_token(){var result0;return result0=parse_token(),null===result0&&(result0=parse_x_token()),result0}function parse_x_token(){var result0,result1,pos0;return pos0=pos,"x-"===input.substr(pos,2).toLowerCase()?(result0=input.substr(pos,2),pos+=2):(result0=null,0===reportFailures&&matchFailed('"x-"')),null!==result0?(result1=parse_token(),null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_m_subtype(){var result0;return result0=parse_extension_token(),null===result0&&(result0=parse_token()),result0}function parse_m_parameter(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_token(),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_m_value(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_m_value(){var result0;return result0=parse_token(),null===result0&&(result0=parse_quoted_string()),result0}function parse_CSeq(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_CSeq_value(),null!==result0?(result1=parse_LWS(),null!==result1?(result2=parse_Method(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_CSeq_value(){var result0,result1,pos0;if(pos0=pos,result1=parse_DIGIT(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null!==result0&&(result0=function(offset,cseq_value){data.value=parseInt(cseq_value.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Expires(){var result0,pos0;return pos0=pos,result0=parse_delta_seconds(),null!==result0&&(result0=function(offset,expires){data=expires}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Event(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_event_type(),null!==result0){for(result1=[],pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(offset,event_type){data.event=event_type.join("").toLowerCase()}(pos0,result0[0])),null===result0&&(pos=pos0),result0}function parse_event_type(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_token_nodot(),null!==result0){for(result1=[],pos1=pos,46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2?(result3=parse_token_nodot(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2?(result3=parse_token_nodot(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_From(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_SIP_URI_noparams(),null===result0&&(result0=parse_name_addr()),null!==result0){for(result1=[],pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_from_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_from_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){var tag=data.tag;try{data=new JsSIP.NameAddrHeader(data.uri,data.display_name,data.params),tag&&data.setParam("tag",tag)}catch(e){data=-1}}(pos0)),null===result0&&(pos=pos0),result0}function parse_from_param(){var result0;return result0=parse_tag_param(),null===result0&&(result0=parse_generic_param()),result0}function parse_tag_param(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"tag"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"tag"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_token(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,tag){data.tag=tag}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_Max_Forwards(){var result0,result1,pos0;if(pos0=pos,result1=parse_DIGIT(),null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null!==result0&&(result0=function(offset,forwards){data=parseInt(forwards.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Min_Expires(){var result0,pos0;return pos0=pos,result0=parse_delta_seconds(),null!==result0&&(result0=function(offset,min_expires){data=min_expires}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Name_Addr_Header(){var result0,result1,result2,result3,result4,result5,result6,pos0,pos1,pos2;for(pos0=pos,pos1=pos,result0=[],result1=parse_display_name();null!==result1;)result0.push(result1),result1=parse_display_name();if(null!==result0)if(result1=parse_LAQUOT(),null!==result1)if(result2=parse_SIP_URI(),null!==result2)if(result3=parse_RAQUOT(),null!==result3){for(result4=[],pos2=pos,result5=parse_SEMI(),null!==result5?(result6=parse_generic_param(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2);null!==result5;)result4.push(result5),pos2=pos,result5=parse_SEMI(),null!==result5?(result6=parse_generic_param(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2);null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;else result0=null,pos=pos1;else result0=null,pos=pos1;return null!==result0&&(result0=function(){try{data=new JsSIP.NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}(pos0)),null===result0&&(pos=pos0),result0}function parse_Proxy_Authenticate(){var result0;return result0=parse_challenge()}function parse_challenge(){var result0,result1,result2,result3,result4,result5,pos0,pos1;if(pos0=pos,"digest"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"Digest"')),null!==result0)if(result1=parse_LWS(),null!==result1)if(result2=parse_digest_cln(),null!==result2){for(result3=[],pos1=pos,result4=parse_COMMA(),null!==result4?(result5=parse_digest_cln(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,result4=parse_COMMA(),null!==result4?(result5=parse_digest_cln(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return null===result0&&(result0=parse_other_challenge()),result0}function parse_other_challenge(){var result0,result1,result2,result3,result4,result5,pos0,pos1;if(pos0=pos,result0=parse_token(),null!==result0)if(result1=parse_LWS(),null!==result1)if(result2=parse_auth_param(),null!==result2){for(result3=[],pos1=pos,result4=parse_COMMA(),null!==result4?(result5=parse_auth_param(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,result4=parse_COMMA(),null!==result4?(result5=parse_auth_param(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_auth_param(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_token(),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_token(),null===result2&&(result2=parse_quoted_string()),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_digest_cln(){var result0;return result0=parse_realm(),null===result0&&(result0=parse_domain(),null===result0&&(result0=parse_nonce(),null===result0&&(result0=parse_opaque(),null===result0&&(result0=parse_stale(),null===result0&&(result0=parse_algorithm(),null===result0&&(result0=parse_qop_options(),null===result0&&(result0=parse_auth_param()))))))),result0}function parse_realm(){var result0,result1,result2,pos0;return pos0=pos,"realm"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"realm"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_realm_value(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_realm_value(){var result0,pos0;return pos0=pos,result0=parse_quoted_string_clean(),null!==result0&&(result0=function(offset,realm){data.realm=realm}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_domain(){var result0,result1,result2,result3,result4,result5,result6,pos0,pos1;if(pos0=pos,"domain"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"domain"')),null!==result0)if(result1=parse_EQUAL(),null!==result1)if(result2=parse_LDQUOT(),null!==result2)if(result3=parse_URI(),null!==result3){if(result4=[],pos1=pos,result6=parse_SP(),null!==result6)for(result5=[];null!==result6;)result5.push(result6),result6=parse_SP();else result5=null;for(null!==result5?(result6=parse_URI(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos1)):(result5=null,pos=pos1);null!==result5;){if(result4.push(result5),pos1=pos,result6=parse_SP(),null!==result6)for(result5=[];null!==result6;)result5.push(result6),result6=parse_SP();else result5=null;null!==result5?(result6=parse_URI(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos1)):(result5=null,pos=pos1)}null!==result4?(result5=parse_RDQUOT(),null!==result5?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos0)):(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_URI(){var result0;return result0=parse_absoluteURI(),null===result0&&(result0=parse_abs_path()),result0}function parse_nonce(){var result0,result1,result2,pos0;return pos0=pos,"nonce"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"nonce"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_nonce_value(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_nonce_value(){var result0,pos0;return pos0=pos,result0=parse_quoted_string_clean(),null!==result0&&(result0=function(offset,nonce){data.nonce=nonce}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_opaque(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"opaque"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"opaque"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_quoted_string_clean(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,opaque){data.opaque=opaque}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_stale(){var result0,result1,result2,pos0,pos1;return pos0=pos,"stale"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"stale"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(pos1=pos,"true"===input.substr(pos,4).toLowerCase()?(result2=input.substr(pos,4),pos+=4):(result2=null,0===reportFailures&&matchFailed('"true"')),null!==result2&&(result2=function(){data.stale=!0}(pos1)),null===result2&&(pos=pos1),null===result2&&(pos1=pos,"false"===input.substr(pos,5).toLowerCase()?(result2=input.substr(pos,5),pos+=5):(result2=null,0===reportFailures&&matchFailed('"false"')),null!==result2&&(result2=function(){data.stale=!1}(pos1)),null===result2&&(pos=pos1)),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_algorithm(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"algorithm"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"algorithm"')),null!==result0?(result1=parse_EQUAL(),null!==result1?("md5"===input.substr(pos,3).toLowerCase()?(result2=input.substr(pos,3),pos+=3):(result2=null,0===reportFailures&&matchFailed('"MD5"')),null===result2&&("md5-sess"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"MD5-sess"')),null===result2&&(result2=parse_token())),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,algorithm){data.algorithm=algorithm.toUpperCase()}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_qop_options(){var result0,result1,result2,result3,result4,result5,result6,pos0,pos1,pos2;if(pos0=pos,"qop"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"qop"')),null!==result0)if(result1=parse_EQUAL(),null!==result1)if(result2=parse_LDQUOT(),null!==result2){if(pos1=pos,result3=parse_qop_value(),null!==result3){for(result4=[],pos2=pos,44===input.charCodeAt(pos)?(result5=",",pos++):(result5=null,0===reportFailures&&matchFailed('","')),null!==result5?(result6=parse_qop_value(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2);null!==result5;)result4.push(result5),pos2=pos,44===input.charCodeAt(pos)?(result5=",",pos++):(result5=null,0===reportFailures&&matchFailed('","')),null!==result5?(result6=parse_qop_value(),null!==result6?result5=[result5,result6]:(result5=null,pos=pos2)):(result5=null,pos=pos2);null!==result4?result3=[result3,result4]:(result3=null,pos=pos1)}else result3=null,pos=pos1;null!==result3?(result4=parse_RDQUOT(),null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0)):(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_qop_value(){var result0,pos0;return pos0=pos,"auth-int"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"auth-int"')),null===result0&&("auth"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"auth"')),null===result0&&(result0=parse_token())),null!==result0&&(result0=function(offset,qop_value){data.qop||(data.qop=[]),data.qop.push(qop_value.toLowerCase())}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_Proxy_Require(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_token(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_Record_Route(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_rec_route(),null!==result0){for(result1=[],pos2=pos,result2=parse_COMMA(),null!==result2?(result3=parse_rec_route(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_COMMA(),null!==result2?(result3=parse_rec_route(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){var idx,length;for(length=data.multi_header.length,idx=0;length>idx;idx++)if(null===data.multi_header[idx].parsed){data=null;break}data=null!==data?data.multi_header:-1}(pos0)),null===result0&&(pos=pos0),result0}function parse_rec_route(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_name_addr(),null!==result0){for(result1=[],pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(offset){var header;data.multi_header||(data.multi_header=[]);try{header=new JsSIP.NameAddrHeader(data.uri,data.display_name,data.params),delete data.uri,delete data.display_name,delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0)),null===result0&&(pos=pos0),result0}function parse_Require(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_token(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_Route(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_route_param(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_route_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_route_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_route_param(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_name_addr(),null!==result0){for(result1=[],pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_generic_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_Subscription_State(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_substate_value(),null!==result0){for(result1=[],pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_subexp_params(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_SEMI(),null!==result2?(result3=parse_subexp_params(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0
}function parse_substate_value(){var result0,pos0;return pos0=pos,"active"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"active"')),null===result0&&("pending"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"pending"')),null===result0&&("terminated"===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"terminated"')),null===result0&&(result0=parse_token()))),null!==result0&&(result0=function(offset){data.state=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_subexp_params(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"reason"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"reason"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_event_reason_value(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,reason){"undefined"!=typeof reason&&(data.reason=reason)}(pos0,result0[2])),null===result0&&(pos=pos0),null===result0&&(pos0=pos,pos1=pos,"expires"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"expires"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_delta_seconds(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,expires){"undefined"!=typeof expires&&(data.expires=expires)}(pos0,result0[2])),null===result0&&(pos=pos0),null===result0&&(pos0=pos,pos1=pos,"retry_after"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"retry_after"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_delta_seconds(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,retry_after){"undefined"!=typeof retry_after&&(data.retry_after=retry_after)}(pos0,result0[2])),null===result0&&(pos=pos0),null===result0&&(result0=parse_generic_param()))),result0}function parse_event_reason_value(){var result0;return"deactivated"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"deactivated"')),null===result0&&("probation"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"probation"')),null===result0&&("rejected"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"rejected"')),null===result0&&("timeout"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"timeout"')),null===result0&&("giveup"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"giveup"')),null===result0&&("noresource"===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"noresource"')),null===result0&&("invariant"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"invariant"')),null===result0&&(result0=parse_token()))))))),result0}function parse_Subject(){var result0;return result0=parse_TEXT_UTF8_TRIM(),result0=null!==result0?result0:""}function parse_Supported(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_token(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_token(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0=null!==result0?result0:""}function parse_To(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,result0=parse_SIP_URI_noparams(),null===result0&&(result0=parse_name_addr()),null!==result0){for(result1=[],pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_to_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,result2=parse_SEMI(),null!==result2?(result3=parse_to_param(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos2)):(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){var tag=data.tag;try{data=new JsSIP.NameAddrHeader(data.uri,data.display_name,data.params),tag&&data.setParam("tag",tag)}catch(e){data=-1}}(pos0)),null===result0&&(pos=pos0),result0}function parse_to_param(){var result0;return result0=parse_tag_param(),null===result0&&(result0=parse_generic_param()),result0}function parse_Via(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,result0=parse_via_parm(),null!==result0){for(result1=[],pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_via_parm(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,result2=parse_COMMA(),null!==result2?(result3=parse_via_parm(),null!==result3?result2=[result2,result3]:(result2=null,pos=pos1)):(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_via_parm(){var result0,result1,result2,result3,result4,result5,pos0,pos1;if(pos0=pos,result0=parse_sent_protocol(),null!==result0)if(result1=parse_LWS(),null!==result1)if(result2=parse_sent_by(),null!==result2){for(result3=[],pos1=pos,result4=parse_SEMI(),null!==result4?(result5=parse_via_params(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,result4=parse_SEMI(),null!==result4?(result5=parse_via_params(),null!==result5?result4=[result4,result5]:(result4=null,pos=pos1)):(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_via_params(){var result0;return result0=parse_via_ttl(),null===result0&&(result0=parse_via_maddr(),null===result0&&(result0=parse_via_received(),null===result0&&(result0=parse_via_branch(),null===result0&&(result0=parse_response_port(),null===result0&&(result0=parse_generic_param()))))),result0}function parse_via_ttl(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"ttl"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"ttl"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_ttl(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,via_ttl_value){data.ttl=via_ttl_value}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_via_maddr(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"maddr"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"maddr"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_host(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,via_maddr){data.maddr=via_maddr}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_via_received(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"received"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"received"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_IPv4address(),null===result2&&(result2=parse_IPv6address()),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,via_received){data.received=via_received}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_via_branch(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,"branch"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"branch"')),null!==result0?(result1=parse_EQUAL(),null!==result1?(result2=parse_token(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,via_branch){data.branch=via_branch}(pos0,result0[2])),null===result0&&(pos=pos0),result0}function parse_response_port(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,pos1=pos,"rport"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"rport"')),null!==result0){if(pos2=pos,result1=parse_EQUAL(),null!==result1){for(result2=[],result3=parse_DIGIT();null!==result3;)result2.push(result3),result3=parse_DIGIT();null!==result2?result1=[result1,result2]:(result1=null,pos=pos2)}else result1=null,pos=pos2;result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){"undefined"!=typeof response_port&&(data.rport=response_port.join(""))}(pos0)),null===result0&&(pos=pos0),result0}function parse_sent_protocol(){var result0,result1,result2,result3,result4,pos0;return pos0=pos,result0=parse_protocol_name(),null!==result0?(result1=parse_SLASH(),null!==result1?(result2=parse_token(),null!==result2?(result3=parse_SLASH(),null!==result3?(result4=parse_transport(),null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_protocol_name(){var result0,pos0;return pos0=pos,"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"SIP"')),null===result0&&(result0=parse_token()),null!==result0&&(result0=function(offset,via_protocol){data.protocol=via_protocol}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_transport(){var result0,pos0;return pos0=pos,"udp"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"UDP"')),null===result0&&("tcp"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"TCP"')),null===result0&&("tls"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"TLS"')),null===result0&&("sctp"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"SCTP"')),null===result0&&(result0=parse_token())))),null!==result0&&(result0=function(offset,via_transport){data.transport=via_transport}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_sent_by(){var result0,result1,result2,pos0,pos1;return pos0=pos,result0=parse_via_host(),null!==result0?(pos1=pos,result1=parse_COLON(),null!==result1?(result2=parse_via_port(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos1)):(result1=null,pos=pos1),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_via_host(){var result0,pos0;return pos0=pos,result0=parse_hostname(),null===result0&&(result0=parse_IPv4address(),null===result0&&(result0=parse_IPv6reference())),null!==result0&&(result0=function(offset){data.host=input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_via_port(){var result0,result1,result2,result3,result4,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_DIGIT(),result0=null!==result0?result0:"",null!==result0?(result1=parse_DIGIT(),result1=null!==result1?result1:"",null!==result1?(result2=parse_DIGIT(),result2=null!==result2?result2:"",null!==result2?(result3=parse_DIGIT(),result3=null!==result3?result3:"",null!==result3?(result4=parse_DIGIT(),result4=null!==result4?result4:"",null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,via_sent_by_port){data.port=parseInt(via_sent_by_port.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_ttl(){var result0,result1,result2,pos0,pos1;return pos0=pos,pos1=pos,result0=parse_DIGIT(),null!==result0?(result1=parse_DIGIT(),result1=null!==result1?result1:"",null!==result1?(result2=parse_DIGIT(),result2=null!==result2?result2:"",null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)):(result0=null,pos=pos1)):(result0=null,pos=pos1),null!==result0&&(result0=function(offset,ttl){return parseInt(ttl.join(""))}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_WWW_Authenticate(){var result0;return result0=parse_challenge()}function parse_extension_header(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_token(),null!==result0?(result1=parse_HCOLON(),null!==result1?(result2=parse_header_value(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_header_value(){var result0,result1;for(result0=[],result1=parse_TEXT_UTF8char(),null===result1&&(result1=parse_UTF8_CONT(),null===result1&&(result1=parse_LWS()));null!==result1;)result0.push(result1),result1=parse_TEXT_UTF8char(),null===result1&&(result1=parse_UTF8_CONT(),null===result1&&(result1=parse_LWS()));return result0}function parse_message_body(){var result0,result1;for(result0=[],result1=parse_OCTET();null!==result1;)result0.push(result1),result1=parse_OCTET();return result0}function parse_stun_URI(){var result0,result1,result2,pos0;return pos0=pos,result0=parse_stun_scheme(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_stun_host_port(),null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_stun_scheme(){var result0,pos0;return pos0=pos,"stuns"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"stuns"')),null===result0&&("stun"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"stun"'))),null!==result0&&(result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_stun_host_port(){var result0,result1,result2,pos0,pos1;return pos0=pos,result0=parse_stun_host(),null!==result0?(pos1=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_port(),null!==result2?result1=[result1,result2]:(result1=null,pos=pos1)):(result1=null,pos=pos1),result1=null!==result1?result1:"",null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_stun_host(){var result0,pos0;return pos0=pos,result0=parse_IPv4address(),null===result0&&(result0=parse_IPv6reference(),null===result0&&(result0=parse_reg_name())),null!==result0&&(result0=function(offset,host){data.host=host}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_reg_name(){var result0,result1,pos0;for(pos0=pos,result0=[],result1=parse_stun_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_sub_delims()));null!==result1;)result0.push(result1),result1=parse_stun_unreserved(),null===result1&&(result1=parse_escaped(),null===result1&&(result1=parse_sub_delims()));return null!==result0&&(result0=function(offset){return input.substring(pos,offset)}(pos0)),null===result0&&(pos=pos0),result0}function parse_stun_unreserved(){var result0;return result0=parse_ALPHA(),null===result0&&(result0=parse_DIGIT(),null===result0&&(45===input.charCodeAt(pos)?(result0="-",pos++):(result0=null,0===reportFailures&&matchFailed('"-"')),null===result0&&(46===input.charCodeAt(pos)?(result0=".",pos++):(result0=null,0===reportFailures&&matchFailed('"."')),null===result0&&(95===input.charCodeAt(pos)?(result0="_",pos++):(result0=null,0===reportFailures&&matchFailed('"_"')),null===result0&&(126===input.charCodeAt(pos)?(result0="~",pos++):(result0=null,0===reportFailures&&matchFailed('"~"'))))))),result0}function parse_sub_delims(){var result0;return 33===input.charCodeAt(pos)?(result0="!",pos++):(result0=null,0===reportFailures&&matchFailed('"!"')),null===result0&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(39===input.charCodeAt(pos)?(result0="'",pos++):(result0=null,0===reportFailures&&matchFailed('"\'"')),null===result0&&(40===input.charCodeAt(pos)?(result0="(",pos++):(result0=null,0===reportFailures&&matchFailed('"("')),null===result0&&(41===input.charCodeAt(pos)?(result0=")",pos++):(result0=null,0===reportFailures&&matchFailed('")"')),null===result0&&(42===input.charCodeAt(pos)?(result0="*",pos++):(result0=null,0===reportFailures&&matchFailed('"*"')),null===result0&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')),null===result0&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')))))))))))),result0}function parse_turn_URI(){var result0,result1,result2,result3,result4,pos0,pos1;return pos0=pos,result0=parse_turn_scheme(),null!==result0?(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1?(result2=parse_stun_host_port(),null!==result2?(pos1=pos,"?transport="===input.substr(pos,11)?(result3="?transport=",pos+=11):(result3=null,0===reportFailures&&matchFailed('"?transport="')),null!==result3?(result4=parse_transport(),null!==result4?result3=[result3,result4]:(result3=null,pos=pos1)):(result3=null,pos=pos1),result3=null!==result3?result3:"",null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0)):(result0=null,pos=pos0),result0}function parse_turn_scheme(){var result0,pos0;return pos0=pos,"turns"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"turns"')),null===result0&&("turn"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"turn"'))),null!==result0&&(result0=function(offset,scheme){data.scheme=scheme}(pos0,result0)),null===result0&&(pos=pos0),result0}function parse_turn_transport(){var result0,result1,result2,pos0,pos1;if(pos0=pos,pos1=pos,result0=parse_transport(),null!==result0){if("udp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"udp"')),null===result1&&("tcp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"tcp"')),null===result1))for(result1=[],result2=parse_unreserved();null!==result2;)result1.push(result2),result2=parse_unreserved();null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==result0&&(result0=function(){data.transport=transport}(pos0)),null===result0&&(pos=pos0),result0}function cleanupExpected(expected){expected.sort();for(var lastExpected=null,cleanExpected=[],i=0;i<expected.length;i++)expected[i]!==lastExpected&&(cleanExpected.push(expected[i]),lastExpected=expected[i]);return cleanExpected}function computeErrorPosition(){for(var line=1,column=1,seenCR=!1,i=0;i<Math.max(pos,rightmostFailuresPos);i++){var ch=input.charAt(i);"\n"===ch?(seenCR||line++,column=1,seenCR=!1):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(line++,column=1,seenCR=!0):(column++,seenCR=!1)}return{line:line,column:column}}var parseFunctions={CRLF:parse_CRLF,DIGIT:parse_DIGIT,ALPHA:parse_ALPHA,HEXDIG:parse_HEXDIG,WSP:parse_WSP,OCTET:parse_OCTET,DQUOTE:parse_DQUOTE,SP:parse_SP,HTAB:parse_HTAB,alphanum:parse_alphanum,reserved:parse_reserved,unreserved:parse_unreserved,mark:parse_mark,escaped:parse_escaped,LWS:parse_LWS,SWS:parse_SWS,HCOLON:parse_HCOLON,TEXT_UTF8_TRIM:parse_TEXT_UTF8_TRIM,TEXT_UTF8char:parse_TEXT_UTF8char,UTF8_NONASCII:parse_UTF8_NONASCII,UTF8_CONT:parse_UTF8_CONT,LHEX:parse_LHEX,token:parse_token,token_nodot:parse_token_nodot,separators:parse_separators,word:parse_word,STAR:parse_STAR,SLASH:parse_SLASH,EQUAL:parse_EQUAL,LPAREN:parse_LPAREN,RPAREN:parse_RPAREN,RAQUOT:parse_RAQUOT,LAQUOT:parse_LAQUOT,COMMA:parse_COMMA,SEMI:parse_SEMI,COLON:parse_COLON,LDQUOT:parse_LDQUOT,RDQUOT:parse_RDQUOT,comment:parse_comment,ctext:parse_ctext,quoted_string:parse_quoted_string,quoted_string_clean:parse_quoted_string_clean,qdtext:parse_qdtext,quoted_pair:parse_quoted_pair,SIP_URI_noparams:parse_SIP_URI_noparams,SIP_URI:parse_SIP_URI,uri_scheme:parse_uri_scheme,userinfo:parse_userinfo,user:parse_user,user_unreserved:parse_user_unreserved,password:parse_password,hostport:parse_hostport,host:parse_host,hostname:parse_hostname,domainlabel:parse_domainlabel,toplabel:parse_toplabel,IPv6reference:parse_IPv6reference,IPv6address:parse_IPv6address,h16:parse_h16,ls32:parse_ls32,IPv4address:parse_IPv4address,dec_octet:parse_dec_octet,port:parse_port,uri_parameters:parse_uri_parameters,uri_parameter:parse_uri_parameter,transport_param:parse_transport_param,user_param:parse_user_param,method_param:parse_method_param,ttl_param:parse_ttl_param,maddr_param:parse_maddr_param,lr_param:parse_lr_param,other_param:parse_other_param,pname:parse_pname,pvalue:parse_pvalue,paramchar:parse_paramchar,param_unreserved:parse_param_unreserved,headers:parse_headers,header:parse_header,hname:parse_hname,hvalue:parse_hvalue,hnv_unreserved:parse_hnv_unreserved,Request_Response:parse_Request_Response,Request_Line:parse_Request_Line,Request_URI:parse_Request_URI,absoluteURI:parse_absoluteURI,hier_part:parse_hier_part,net_path:parse_net_path,abs_path:parse_abs_path,opaque_part:parse_opaque_part,uric:parse_uric,uric_no_slash:parse_uric_no_slash,path_segments:parse_path_segments,segment:parse_segment,param:parse_param,pchar:parse_pchar,scheme:parse_scheme,authority:parse_authority,srvr:parse_srvr,reg_name:parse_reg_name,query:parse_query,SIP_Version:parse_SIP_Version,INVITEm:parse_INVITEm,ACKm:parse_ACKm,OPTIONSm:parse_OPTIONSm,BYEm:parse_BYEm,CANCELm:parse_CANCELm,REGISTERm:parse_REGISTERm,SUBSCRIBEm:parse_SUBSCRIBEm,NOTIFYm:parse_NOTIFYm,Method:parse_Method,Status_Line:parse_Status_Line,Status_Code:parse_Status_Code,extension_code:parse_extension_code,Reason_Phrase:parse_Reason_Phrase,Allow_Events:parse_Allow_Events,Call_ID:parse_Call_ID,Contact:parse_Contact,contact_param:parse_contact_param,name_addr:parse_name_addr,display_name:parse_display_name,contact_params:parse_contact_params,c_p_q:parse_c_p_q,c_p_expires:parse_c_p_expires,delta_seconds:parse_delta_seconds,qvalue:parse_qvalue,generic_param:parse_generic_param,gen_value:parse_gen_value,Content_Disposition:parse_Content_Disposition,disp_type:parse_disp_type,disp_param:parse_disp_param,handling_param:parse_handling_param,Content_Encoding:parse_Content_Encoding,Content_Length:parse_Content_Length,Content_Type:parse_Content_Type,media_type:parse_media_type,m_type:parse_m_type,discrete_type:parse_discrete_type,composite_type:parse_composite_type,extension_token:parse_extension_token,x_token:parse_x_token,m_subtype:parse_m_subtype,m_parameter:parse_m_parameter,m_value:parse_m_value,CSeq:parse_CSeq,CSeq_value:parse_CSeq_value,Expires:parse_Expires,Event:parse_Event,event_type:parse_event_type,From:parse_From,from_param:parse_from_param,tag_param:parse_tag_param,Max_Forwards:parse_Max_Forwards,Min_Expires:parse_Min_Expires,Name_Addr_Header:parse_Name_Addr_Header,Proxy_Authenticate:parse_Proxy_Authenticate,challenge:parse_challenge,other_challenge:parse_other_challenge,auth_param:parse_auth_param,digest_cln:parse_digest_cln,realm:parse_realm,realm_value:parse_realm_value,domain:parse_domain,URI:parse_URI,nonce:parse_nonce,nonce_value:parse_nonce_value,opaque:parse_opaque,stale:parse_stale,algorithm:parse_algorithm,qop_options:parse_qop_options,qop_value:parse_qop_value,Proxy_Require:parse_Proxy_Require,Record_Route:parse_Record_Route,rec_route:parse_rec_route,Require:parse_Require,Route:parse_Route,route_param:parse_route_param,Subscription_State:parse_Subscription_State,substate_value:parse_substate_value,subexp_params:parse_subexp_params,event_reason_value:parse_event_reason_value,Subject:parse_Subject,Supported:parse_Supported,To:parse_To,to_param:parse_to_param,Via:parse_Via,via_parm:parse_via_parm,via_params:parse_via_params,via_ttl:parse_via_ttl,via_maddr:parse_via_maddr,via_received:parse_via_received,via_branch:parse_via_branch,response_port:parse_response_port,sent_protocol:parse_sent_protocol,protocol_name:parse_protocol_name,transport:parse_transport,sent_by:parse_sent_by,via_host:parse_via_host,via_port:parse_via_port,ttl:parse_ttl,WWW_Authenticate:parse_WWW_Authenticate,extension_header:parse_extension_header,header_value:parse_header_value,message_body:parse_message_body,stun_URI:parse_stun_URI,stun_scheme:parse_stun_scheme,stun_host_port:parse_stun_host_port,stun_host:parse_stun_host,reg_name:parse_reg_name,stun_unreserved:parse_stun_unreserved,sub_delims:parse_sub_delims,turn_URI:parse_turn_URI,turn_scheme:parse_turn_scheme,turn_transport:parse_turn_transport};if(void 0!==startRule){if(void 0===parseFunctions[startRule])throw new Error("Invalid rule name: "+quote(startRule)+".")}else startRule="CRLF";var pos=0,reportFailures=0,rightmostFailuresPos=0,rightmostFailuresExpected=[],data={},result=parseFunctions[startRule]();if(null===result||pos!==input.length){var offset=Math.max(pos,rightmostFailuresPos),found=offset<input.length?input.charAt(offset):null,errorPosition=computeErrorPosition();return new this.SyntaxError(cleanupExpected(rightmostFailuresExpected),found,offset,errorPosition.line,errorPosition.column),-1}return data},toSource:function(){return this._source}};return result.SyntaxError=function(expected,found,offset,line,column){function buildMessage(expected,found){var expectedHumanized,foundHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}return foundHumanized=found?quote(found):"end of input","Expected "+expectedHumanized+" but "+foundHumanized+" found."}this.name="SyntaxError",this.expected=expected,this.found=found,this.message=buildMessage(expected,found),this.offset=offset,this.line=line,this.column=column},result.SyntaxError.prototype=Error.prototype,result}(),function(){$(document).on("click","#call",function(event){var configuration,coolPhone,eventHandlers,options,remoteView,selfView;event.preventDefault(),configuration={ws_servers:"wss://avtorif.ru:8089/ws",uri:"sip:1062@avtorif.ru",password:"1062"},coolPhone=new JsSIP.UA(configuration),coolPhone.start(),selfView=document.getElementById("my-video"),remoteView=document.getElementById("peer-video"),eventHandlers={progress:function(){console.log("call is in progress")},failed:function(e){console.log("call failed with cause: "+e.data.cause)},ended:function(e){console.log("call ended with cause: "+e.data.cause)},started:function(e){var rtcSession;rtcSession=e.sender,console.log("call started"),rtcSession.getLocalStreams().length>0&&(selfView.src=window.URL.createObjectURL(rtcSession.getLocalStreams()[0])),rtcSession.getRemoteStreams().length>0&&(remoteView.src=window.URL.createObjectURL(rtcSession.getRemoteStreams()[0]))}},options={eventHandlers:eventHandlers,mediaConstraints:{audio:!0,video:!1}},coolPhone.call("sip:1000@avtorif.ru",options)})}.call(this);