!function(){function e(e){return{allowedContent:{div:{match:a(e),styles:"text-align"},figcaption:!0,figure:{classes:"!caption",styles:"float,display"},img:{attributes:"!src,alt,width,height",styles:"float"},p:{match:a(e),styles:"text-align"}},contentTransformations:[["img[width]: sizeToAttribute"]],editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u s; a[!href]"}},parts:{image:"img",caption:"figcaption"},dialog:"image2",template:l,data:function(){var e=this,t=e.editor,i=t.document,a=t.editable();e.shiftState({element:e.element,oldState:e.oldData,newState:e.data,destroy:function(){this.destroyed||(t.widgets.focused==e&&(this.focused=!0),t.widgets.destroy(e),this.destroyed=!0)},init:function(n){if(this.destroyed)e=t.widgets.initOn(n,"image",e.data),e.inline&&!new CKEDITOR.dom.elementPath(e.wrapper,a).block&&(n=i.createElement(t.activeEnterMode==CKEDITOR.ENTER_P?"p":"div"),n.replace(e.wrapper),e.wrapper.move(n)),this.focused&&(e.focus(),delete this.focused),delete this.destroyed;else{var n=e,r=n.wrapper,s=n.data.align;"center"==s?(n.inline||r.setStyle("text-align","center"),r.removeStyle("float")):(n.inline||r.removeStyle("text-align"),"none"==s?r.removeStyle("float"):r.setStyle("float",s))}}}),e.parts.image.setAttributes({src:e.data.src,"data-cke-saved-src":e.data.src,alt:e.data.alt}),n(e),e.oldData=CKEDITOR.tools.extend({},e.data)},init:function(){var e=CKEDITOR.plugins.image2,t=this.parts.image,i={hasCaption:!!this.parts.caption,src:t.getAttribute("src"),alt:t.getAttribute("alt")||"",width:t.getAttribute("width")||"",height:t.getAttribute("height")||"",lock:this.ready?e.checkHasNaturalRatio(t):!0};i.align||(i.align=this.element.getStyle("float")||t.getStyle("float")||"none",this.element.removeStyle("float"),t.removeStyle("float")),i.hasCaption||this.wrapper.setStyle("line-height","0"),this.setData(i),r(this),this.shiftState=e.stateShifter(this.editor),this.on("contextMenu",function(e){e.data.image=CKEDITOR.TRISTATE_OFF}),this.on("dialog",function(e){e.data.widget=this},this)},upcast:t(e),downcast:i}}function t(e){var t=a(e);return function(e,i){var a,n={width:1,height:1},r=e.name;if(!e.attributes["data-cke-realelement"]&&(t(e)?("div"==r&&(a=e.getFirst("figure"))&&(e.replaceWith(a),e=a),i.align="center",a=e.getFirst("img")):"figure"==r&&e.hasClass("caption")?a=e.getFirst("img"):"img"==r&&(a=e),a)){for(var s in n)(r=a.attributes[s])&&r.match(g)&&delete a.attributes[s];return e}}}function i(e){var t=e.attributes,i=this.data.align;if(!this.inline){var a=e.getFirst("span"),n=a.getFirst("img");a.replaceWith(n)}return i&&"none"!=i&&(a=CKEDITOR.tools.parseCssText(t.style||""),"center"==i&&"figure"==e.name?e=e.wrapWith(new CKEDITOR.htmlParser.element("div",{style:"text-align:center"})):i in{left:1,right:1}&&(a["float"]=i),CKEDITOR.tools.isEmpty(a)||(t.style=CKEDITOR.tools.writeCssText(a))),e}function a(e){return function(t){if(!(t.name in{div:1,p:1}))return!1;var i=t.children;if(1!==i.length)return!1;var i=i[0],a=i.name;if("figure"!=a&&"img"!=a)return!1;if("p"==t.name){if("img"!=a)return!1}else if("figure"==a&&!i.hasClass("caption")||"img"==a&&e.enterMode==CKEDITOR.ENTER_P)return!1;return"center"==CKEDITOR.tools.parseCssText(t.attributes.style||"",!0)["text-align"]?!0:!1}}function n(e){var t,i=e.data,i={width:i.width,height:i.height},e=e.parts.image;for(t in i)i[t]?e.setAttribute(t,i[t]):e.removeAttribute(t)}function r(e){var t=e.editor,i=t.editable(),a=t.document,n=a.createElement("span");if(n.addClass("cke_image_resizer"),n.setAttribute("title",t.lang.image2.resizer),n.append(new CKEDITOR.dom.text("â€‹",a)),e.inline)e.wrapper.append(n);else{var r=e.element.getFirst(),s=a.createElement("span");s.addClass("cke_image_resizer_wrapper"),s.append(e.parts.image),s.append(n),e.element.append(s,!0),r.is("span")&&r.remove()}n.on("mousedown",function(r){function s(e,t,i){var n=CKEDITOR.document,r=[];if(a.equals(n)||r.push(n.on(e,t)),r.push(a.on(e,t)),i)for(e=r.length;e--;)i.push(r.pop())}function o(){g=b+v*h,d=Math.round(g/T)}function l(){d=C-m,g=Math.round(d*T)}var c,g,d,u,h,m,f,p=e.parts.image,v="right"==e.data.align?-1:1,w=r.data.$.screenX,_=r.data.$.screenY,b=p.$.clientWidth,C=p.$.clientHeight,T=b/C,E=[],y="cke_image_s"+(~v?"e":"w");t.fire("saveSnapshot"),s("mousemove",function(e){c=e.data.$,h=c.screenX-w,m=_-c.screenY,f=Math.abs(h/m),1==v?0>=h?0>=m?o():f>=T?o():l():0>=m?f>=T?l():o():l():0>=h?0>=m?f>=T?l():o():l():0>=m?o():f>=T?o():l(),g>=15&&d>=15?(p.setAttributes({width:g,height:d}),u=!0):u=!1},E),s("mouseup",function(){for(var a;a=E.pop();)a.removeListener();i.removeClass(y),n.removeClass("cke_image_resizing"),u&&(e.setData({width:g,height:d}),t.fire("saveSnapshot")),u=!1},E),i.addClass(y),n.addClass("cke_image_resizing")}),e.on("data",function(){n["right"==e.data.align?"addClass":"removeClass"]("cke_image_resizer_left")})}function s(e){var t=[];return function(i){var a=e.getCommand("justify"+i);a&&(t.push(function(){a.refresh(e,e.elementPath())}),i in{right:1,left:1,center:1}&&a.on("exec",function(a){var n=o(e);if(n){for(n.setData("align",i),n=t.length;n--;)t[n]();a.cancel()}}),a.on("refresh",function(t){var a=o(e),n={right:1,left:1,center:1};a&&(this.setState(a.data.align==i?CKEDITOR.TRISTATE_ON:i in n?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),t.cancel())}))}}function o(e){return(e=e.widgets.focused)&&"image"==e.name?e:null}var l='<img alt="" src="" />',c='<figure class="caption">'+l+"<figcaption>Caption</figcaption></figure>",g=/^\s*(\d+\%)\s*$/i;CKEDITOR.plugins.add("image2",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",requires:"widget,dialog",icons:"image",hidpi:!0,onLoad:function(){CKEDITOR.addCss(".cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid #fff;line-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}")},init:function(t){var i=t.config,a=t.lang.image2,n=e(t);i.filebrowserImage2BrowseUrl=i.filebrowserImageBrowseUrl,i.filebrowserImage2UploadUrl=i.filebrowserImageUploadUrl,n.pathName=a.pathName,n.editables.caption.pathName=a.pathNameCaption,t.widgets.add("image",n),t.ui.addButton&&t.ui.addButton("Image",{label:t.lang.common.image,command:"image",toolbar:"insert,10"}),t.contextMenu&&(t.addMenuGroup("image",10),t.addMenuItem("image",{label:a.menu,command:"image",group:"image"})),CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js")},afterInit:function(e){var t,i={left:1,right:1,center:1,block:1},e=s(e);for(t in i)e(t)}}),CKEDITOR.plugins.image2={stateShifter:function(e){function t(e,t){return e.oldState?e.oldState[t]!==e.newState[t]:!1}function i(e,t){var i=n.createElement(e.activeEnterMode==CKEDITOR.ENTER_P?"p":"div",{styles:{"text-align":"center"}});return a(i,t),t.move(i),i}function a(t,i){if(i.getParent()){var a=e.createRange();a.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),i.remove(),r.insertElementIntoRange(t,a)}else t.replace(i)}var n=e.document,r=e.editable(),s=["hasCaption","align"],o={align:function(a,n,r){var s=a.newState.hasCaption,o=a.element;t(a,"align")?s||("center"==r&&(a.destroy(),a.element=i(e,o)),t(a,"hasCaption")||"center"!=n||"center"==r)||(a.destroy(),n=o.findOne("img"),n.replace(o),a.element=n):"center"==r&&t(a,"hasCaption")&&!s&&(a.destroy(),a.element=i(e,o)),o.is("figure")&&("center"==r?o.setStyle("display","inline-block"):o.removeStyle("display"))},hasCaption:function(e,i,r){if(t(e,"hasCaption"))if(i=e.element,e.destroy(),r){var r=i.findOne("img")||i,s=CKEDITOR.dom.element.createFromHtml(c,n);a(s,i),r.replace(s.findOne("img")),e.element=s}else r=i.findOne("img"),r.replace(i),e.element=r}};return function(e){for(var t,i=e.oldState,a=e.newState,n=0;n<s.length;n++)t=s[n],o[t](e,i?i[t]:null,a[t]);e.init(e.element)}},checkHasNaturalRatio:function(e){var t=e.$,e=this.getNatural(e);return Math.round(t.clientWidth/e.width*e.height)==t.clientHeight||Math.round(t.clientHeight/e.height*e.width)==t.clientWidth},getNatural:function(e){if(e.$.naturalWidth)e={width:e.$.naturalWidth,height:e.$.naturalHeight};else{var t=new Image;t.src=e.getAttribute("src"),e={width:t.width,height:t.height}}return e}}}();