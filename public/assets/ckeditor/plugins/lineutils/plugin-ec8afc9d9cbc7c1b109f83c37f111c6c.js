!function(){function t(t,e){CKEDITOR.tools.extend(this,{editor:t,editable:t.editable(),doc:t.document,win:t.window},e,!0),this.frame=this.win.getFrame(),this.inline=this.editable.isInline(),this.target=this[this.inline?"editable":"doc"]}function e(t,e){CKEDITOR.tools.extend(this,e,{editor:t},!0)}function i(t,e){var i=t.editable();CKEDITOR.tools.extend(this,{editor:t,editable:i,doc:t.document,win:t.window,container:CKEDITOR.document.getBody(),winTop:CKEDITOR.document.getWindow()},e,!0),this.hidden={},this.visible={},this.inline=i.isInline(),this.inline||(this.frame=this.win.getFrame()),this.queryViewport();var s=CKEDITOR.tools.bind(this.queryViewport,this),h=CKEDITOR.tools.bind(this.hideVisible,this),l=CKEDITOR.tools.bind(this.removeAll,this);i.attachListener(this.winTop,"resize",s),i.attachListener(this.winTop,"scroll",s),i.attachListener(this.winTop,"resize",h),i.attachListener(this.win,"scroll",h),i.attachListener(this.inline?i:this.frame,"mouseout",function(t){var e=t.data.$.clientX,t=t.data.$.clientY;this.queryViewport(),(e<=this.rect.left||e>=this.rect.right||t<=this.rect.top||t>=this.rect.bottom)&&this.hideVisible(),(0>=e||e>=this.winTopPane.width||0>=t||t>=this.winTopPane.height)&&this.hideVisible()},this),i.attachListener(t,"resize",s),i.attachListener(t,"mode",l),t.on("destroy",l),this.lineTpl=new CKEDITOR.template(r).output({lineStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},o,this.lineStyle,!0)),tipLeftStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},n,{left:"0px","border-left-color":"red","border-width":"6px 0 6px 6px"},this.tipCss,this.tipLeftStyle,!0)),tipRightStyle:CKEDITOR.tools.writeCssText(CKEDITOR.tools.extend({},n,{right:"0px","border-right-color":"red","border-width":"6px 6px 6px 0"},this.tipCss,this.tipRightStyle,!0))})}function s(t){return t&&t.type==CKEDITOR.NODE_ELEMENT&&!(h[t.getComputedStyle("float")]||h[t.getAttribute("align")])&&!l[t.getComputedStyle("position")]}CKEDITOR.plugins.add("lineutils"),CKEDITOR.LINEUTILS_BEFORE=1,CKEDITOR.LINEUTILS_AFTER=2,CKEDITOR.LINEUTILS_INSIDE=4,t.prototype={start:function(t){var e,i,s,n=this,o=this.editor,r=this.doc,h=CKEDITOR.tools.eventsBuffer(50,function(){o.readOnly||"wysiwyg"!=o.mode||(n.relations={},e=new CKEDITOR.dom.element(r.$.elementFromPoint(i,s)),n.traverseSearch(e),isNaN(i+s)||n.pixelSearch(e,i,s),t&&t(n.relations,i,s))});this.listener=this.editable.attachListener(this.target,"mousemove",function(t){i=t.data.$.clientX,s=t.data.$.clientY,h.input()}),this.editable.attachListener(this.inline?this.editable:this.frame,"mouseout",function(){h.reset()})},stop:function(){this.listener&&this.listener.removeListener()},getRange:function(){var t={};return t[CKEDITOR.LINEUTILS_BEFORE]=CKEDITOR.POSITION_BEFORE_START,t[CKEDITOR.LINEUTILS_AFTER]=CKEDITOR.POSITION_AFTER_END,t[CKEDITOR.LINEUTILS_INSIDE]=CKEDITOR.POSITION_AFTER_START,function(e){var i=this.editor.createRange();return i.moveToPosition(this.relations[e.uid].element,t[e.type]),i}}(),store:function(){function t(t,e,i){var s=t.getUniqueId();s in i?i[s].type|=e:i[s]={element:t,type:e}}return function(e,i){var n;i&CKEDITOR.LINEUTILS_AFTER&&s(n=e.getNext())&&n.isVisible()&&(t(n,CKEDITOR.LINEUTILS_BEFORE,this.relations),i^=CKEDITOR.LINEUTILS_AFTER),i&CKEDITOR.LINEUTILS_INSIDE&&s(n=e.getFirst())&&n.isVisible()&&(t(n,CKEDITOR.LINEUTILS_BEFORE,this.relations),i^=CKEDITOR.LINEUTILS_INSIDE),t(e,i,this.relations)}}(),traverseSearch:function(t){var e,i,n;do if(n=t.$["data-cke-expando"],!(n&&n in this.relations)){if(t.equals(this.editable))break;if(s(t))for(e in this.lookups)(i=this.lookups[e](t))&&this.store(t,i)}while((!t||t.type!=CKEDITOR.NODE_ELEMENT||"true"!=t.getAttribute("contenteditable"))&&(t=t.getParent()))},pixelSearch:function(){function t(t,i,n,o,r){for(var h,l=0;r(n)&&(n+=o,25!=++l);)if(h=this.doc.$.elementFromPoint(i,n))if(h==t)l=0;else if(e(t,h)&&(l=0,s(h=new CKEDITOR.dom.element(h))))return h}var e=CKEDITOR.env.ie||CKEDITOR.env.webkit?function(t,e){return t.contains(e)}:function(t,e){return!!(16&t.compareDocumentPosition(e))};return function(e,i,n){var o=this.win.getViewPaneSize().height,r=t.call(this,e.$,i,n,-1,function(t){return t>0}),i=t.call(this,e.$,i,n,1,function(t){return o>t});if(r)for(this.traverseSearch(r);!r.getParent().equals(e);)r=r.getParent();if(i)for(this.traverseSearch(i);!i.getParent().equals(e);)i=i.getParent();for(;(r||i)&&(r&&(r=r.getNext(s)),r&&!r.equals(i))&&(this.traverseSearch(r),i&&(i=i.getPrevious(s)),i&&!i.equals(r));)this.traverseSearch(i)}}(),greedySearch:function(){this.relations={};for(var t,e,i,n=this.editable.getElementsByTag("*"),o=0;t=n.getItem(o++);)if(!t.equals(this.editable)&&(t.hasAttribute("contenteditable")||!t.isReadOnly())&&s(t)&&t.isVisible())for(i in this.lookups)(e=this.lookups[i](t))&&this.store(t,e);return this.relations}},e.prototype={locate:function(){function t(t,e){var i=t.element[e===CKEDITOR.LINEUTILS_BEFORE?"getPrevious":"getNext"]();return i&&s(i)?(t.siblingRect=i.getClientRect(),e==CKEDITOR.LINEUTILS_BEFORE?(t.siblingRect.bottom+t.elementRect.top)/2:(t.elementRect.bottom+t.siblingRect.top)/2):e==CKEDITOR.LINEUTILS_BEFORE?t.elementRect.top:t.elementRect.bottom}var e,i;return function(s){this.locations={};for(i in s)e=s[i],e.elementRect=e.element.getClientRect(),e.type&CKEDITOR.LINEUTILS_BEFORE&&this.store(i,CKEDITOR.LINEUTILS_BEFORE,t(e,CKEDITOR.LINEUTILS_BEFORE)),e.type&CKEDITOR.LINEUTILS_AFTER&&this.store(i,CKEDITOR.LINEUTILS_AFTER,t(e,CKEDITOR.LINEUTILS_AFTER)),e.type&CKEDITOR.LINEUTILS_INSIDE&&this.store(i,CKEDITOR.LINEUTILS_INSIDE,(e.elementRect.top+e.elementRect.bottom)/2);return this.locations}}(),sort:function(){var t,e,i,s,n,o;return function(r,h){t=this.locations,e=[];for(s in t)for(n in t[s])if(i=Math.abs(r-t[s][n]),e.length){for(o=0;o<e.length;o++)if(i<e[o].dist){e.splice(o,0,{uid:+s,type:n,dist:i});break}o==e.length&&e.push({uid:+s,type:n,dist:i})}else e.push({uid:+s,type:n,dist:i});return"undefined"!=typeof h?e.slice(0,h):e}}(),store:function(t,e,i){this.locations[t]||(this.locations[t]={}),this.locations[t][e]=i}};var n={display:"block",width:"0px",height:"0px","border-color":"transparent","border-style":"solid",position:"absolute",top:"-6px"},o={height:"0px","border-top":"1px dashed red",position:"absolute","z-index":9999},r='<div data-cke-lineutils-line="1" class="cke_reset_all" style="{lineStyle}"><span style="{tipLeftStyle}">&nbsp;</span><span style="{tipRightStyle}">&nbsp;</span></div>';i.prototype={removeAll:function(){for(var t in this.hidden)this.hidden[t].remove(),delete this.hidden[t];for(t in this.visible)this.visible[t].remove(),delete this.visible[t]},hideLine:function(t){var e=t.getUniqueId();t.hide(),this.hidden[e]=t,delete this.visible[e]},showLine:function(t){var e=t.getUniqueId();t.show(),this.visible[e]=t,delete this.hidden[e]},hideVisible:function(){for(var t in this.visible)this.hideLine(this.visible[t])},placeLine:function(t,e){var i,s,n;if(i=this.getStyle(t.uid,t.type)){for(n in this.visible)if(this.visible[n].getCustomData("hash")!==this.hash){s=this.visible[n];break}if(!s)for(n in this.hidden)if(this.hidden[n].getCustomData("hash")!==this.hash){this.showLine(s=this.hidden[n]);break}s||this.showLine(s=this.addLine()),s.setCustomData("hash",this.hash),this.visible[s.getUniqueId()]=s,s.setStyles(i),e&&e(s)}},getStyle:function(t,e){var i=this.relations[t],s=this.locations[t][e],n={};if(n.width=i.siblingRect?Math.max(i.siblingRect.width,i.elementRect.width):i.elementRect.width,n.top=this.inline?s+this.winTopScroll.y:this.rect.top+this.winTopScroll.y+s,n.top-this.winTopScroll.y<this.rect.top||n.top-this.winTopScroll.y>this.rect.bottom)return!1;this.inline?n.left=i.elementRect.left:(0<i.elementRect.left?n.left=this.rect.left+i.elementRect.left:(n.width+=i.elementRect.left,n.left=this.rect.left),0<(i=n.left+n.width-(this.rect.left+this.winPane.width))&&(n.width-=i)),n.left+=this.winTopScroll.x;for(var o in n)n[o]=CKEDITOR.tools.cssLength(n[o]);return n},addLine:function(){var t=CKEDITOR.dom.element.createFromHtml(this.lineTpl);return t.appendTo(this.container),t},prepare:function(t,e){this.relations=t,this.locations=e,this.hash=Math.random()},cleanup:function(){var t,e;for(e in this.visible)t=this.visible[e],t.getCustomData("hash")!==this.hash&&this.hideLine(t)},queryViewport:function(){this.winPane=this.win.getViewPaneSize(),this.winTopScroll=this.winTop.getScrollPosition(),this.winTopPane=this.winTop.getViewPaneSize(),this.rect=this.inline?this.editable.getClientRect():this.frame.getClientRect()}};var h={left:1,right:1,center:1},l={absolute:1,fixed:1};CKEDITOR.plugins.lineutils={finder:t,locator:e,liner:i}}();