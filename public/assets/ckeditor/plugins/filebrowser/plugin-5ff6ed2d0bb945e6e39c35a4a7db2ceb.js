!function(){function e(e,r){var o=[];if(!r)return e;for(var i in r)o.push(i+"="+encodeURIComponent(r[i]));return e+(-1!=e.indexOf("?")?"&":"?")+o.join("&")}function r(e){return e+="",e.charAt(0).toUpperCase()+e.substr(1)}function o(){var o=this.getDialog(),i=o.getParentEditor();i._.filebrowserSe=this;var t=i.config["filebrowser"+r(o.getName())+"WindowWidth"]||i.config.filebrowserWindowWidth||"80%",o=i.config["filebrowser"+r(o.getName())+"WindowHeight"]||i.config.filebrowserWindowHeight||"70%",n=this.filebrowser.params||{};n.CKEditor=i.name,n.CKEditorFuncNum=i._.filebrowserFn,n.langCode||(n.langCode=i.langCode),n=e(this.filebrowser.url,n),i.popup(n,t,o,i.config.filebrowserWindowFeatures||i.config.fileBrowserWindowFeatures)}function i(){var e=this.getDialog();return e.getParentEditor()._.filebrowserSe=this,e.getContentElement(this["for"][0],this["for"][1]).getInputElement().$.value&&e.getContentElement(this["for"][0],this["for"][1]).getAction()?!0:!1}function t(r,o,i){var t=i.params||{};t.CKEditor=r.name,t.CKEditorFuncNum=r._.filebrowserFn,t.langCode||(t.langCode=r.langCode),o.action=e(i.url,t),o.filebrowser=i}function n(e,l,f,s){if(s&&s.length)for(var a,d=s.length;d--;)if(a=s[d],("hbox"==a.type||"vbox"==a.type||"fieldset"==a.type)&&n(e,l,f,a.children),a.filebrowser)if("string"==typeof a.filebrowser&&(a.filebrowser={action:"fileButton"==a.type?"QuickUpload":"Browse",target:a.filebrowser}),"Browse"==a.filebrowser.action){var w=a.filebrowser.url;void 0===w&&(w=e.config["filebrowser"+r(l)+"BrowseUrl"],void 0===w&&(w=e.config.filebrowserBrowseUrl)),w&&(a.onClick=o,a.filebrowser.url=w,a.hidden=!1)}else if("QuickUpload"==a.filebrowser.action&&a["for"]&&(w=a.filebrowser.url,void 0===w&&(w=e.config["filebrowser"+r(l)+"UploadUrl"],void 0===w&&(w=e.config.filebrowserUploadUrl)),w)){var g=a.onClick;a.onClick=function(e){var r=e.sender;return g&&g.call(r,e)===!1?!1:i.call(r,e)},a.filebrowser.url=w,a.hidden=!1,t(e,f.getContents(a["for"][0]).get(a["for"][1]),a.filebrowser)}}function l(e,r,o){if(-1!==o.indexOf(";")){for(var o=o.split(";"),i=0;i<o.length;i++)if(l(e,r,o[i]))return!0;return!1}return(e=e.getContents(r).get(o).filebrowser)&&e.url}function f(e,r){var o=this._.filebrowserSe.getDialog(),i=this._.filebrowserSe["for"],t=this._.filebrowserSe.filebrowser.onSelect;i&&o.getContentElement(i[0],i[1]).reset(),"function"==typeof r&&!1===r.call(this._.filebrowserSe)||t&&!1===t.call(this._.filebrowserSe,e,r)||("string"==typeof r&&r&&alert(r),!(e&&(i=this._.filebrowserSe,o=i.getDialog(),i=i.filebrowser.target||null)))||(i=i.split(":"),(t=o.getContentElement(i[0],i[1]))&&(t.setValue(e),o.selectPage(i[0])))}CKEDITOR.plugins.add("filebrowser",{requires:"popup",init:function(e){e._.filebrowserFn=CKEDITOR.tools.addFunction(f,e),e.on("destroy",function(){CKEDITOR.tools.removeFunction(this._.filebrowserFn)})}}),CKEDITOR.on("dialogDefinition",function(e){for(var r,o=e.data.definition,i=0;i<o.contents.length;++i)(r=o.contents[i])&&(n(e.editor,e.data.name,o,r.elements),r.hidden&&r.filebrowser&&(r.hidden=!l(o,r.id,r.filebrowser)))})}();