<% model_class = User %>

<%
    array = [
      {title: 'Контактн. лицо', icon: 'user', assoc: 'profile'},
      {title: 'Адрес', icon: 'home', assoc: 'postal_address'},
      {title: 'Автомобиль', icon: 'truck', assoc: 'car'},
      {title: 'Компания', icon: 'briefcase', assoc: 'company'} ]
%>

<% array.each do |item| %>

  <h4 class="profileable-category">
    <%= link_to smart_route({:postfix => [item[:assoc].pluralize]}, :user_id => @user.id) do %>
      <div>
        <%= icon item[:icon] %>
        <%= item[:title] %>
      </div>
    <% end %>
    <%= link_to smart_route({:prefix => [:new], :postfix => [item[:assoc]]}, :user_id => @user.id), :class => "btn btn-sm btn-primary profileable-category-add" do %>
      <%= icon 'plus' %>
    <% end %>
  </h4>

  <% @user.send(item[:assoc].pluralize).each do |partial| %>
    <div class="profileable-item left-space">
      <%= render :partial => "profileables/shows/#{partial.class.name.underscore}", :locals => {partial.class.name.underscore.to_sym => partial} %>
      <%= render :partial => 'profileables/shows/notes', :locals => {resource: partial} %>
      <%= render :partial => 'profileables/item_controls', :locals => {:resource => partial} %>
    </div>
  <% end %>

<% end %>


<h4 class="profileable-category">
  <div>
    <%= icon 'money' %>
    Деньги
  </div>
</h4>

<%# В РАБОТЕ %>
<div class="profileable-item left-space">
  В работе: <%= number_to_currency @user.account.credit %>
</div>

<%# НА СЧЕТУ %>
<div class="profileable-item left-space">
  На счету: <%= number_to_currency @user.account.debit %>
  <div class="profileable-item-controls">
    <%= link_to [:new, :admin, @user, :cashes], class: "btn btn-warning btn-sm" do %>
      <%= icon 'edit' %>
    <% end %>
  </div>
</div>

<%# СКИДКА %>
<div class="profileable-item left-space">
  Скидка: <%= @user.discount_was %> %
  <div class="profileable-item-controls">
    <%= link_to edit_admin_user_discount_path(@user), class: "btn btn-warning btn-sm" do %>
      <%= icon 'edit' %>
    <% end %>
  </div>
</div>

<%# ПРЕДОПЛАТА %>
<div class="profileable-item left-space">
  Предоплата: <%= @user.prepayment_was %> %
  <div class="profileable-item-controls">
    <%= link_to edit_admin_user_prepayment_path(@user), class: "btn btn-warning btn-sm" do %>
      <%= icon 'edit' %>
    <% end %>
  </div>
</div>

<%# СОЦ СЕТИ %>
<h4 class="profileable-category">
  <%= link_to '#' do %>
    <div>
      <%= icon 'group' %>
      Соц. сети
    </div>
  <% end %>
</h4>

<ul id="auth-buttons" class="list-unstyled list-inline left-space">
  <%# Муть какая-то, если слить в одну строку, то пробела не будет, иначе как - не знаю %>
  <% @user.auths.each do |auth| %>
    <li>
      <%= render "shared/auth_logged_in", auth: auth %> 
    </li>
  <% end %>
</ul>

<hr />

<%= link_to 'Сменить пароль', smart_route({prefix: [:edit], postfix: [:password]}, user_id: @user) %>

<hr />
