!function(){CKEDITOR.plugins.add("mathjax",{lang:"en",requires:"widget,dialog",icons:"mathjax",hidpi:!0,init:function(t){var a=t.config.mathJaxClass||"math-tex";t.widgets.add("mathjax",{inline:!0,dialog:"mathjax",button:t.lang.mathjax.button,mask:!0,allowedContent:"span(!"+a+")",template:'<span class="'+a+'" style="display:inline-block"><iframe style="border:0;width:0;height:0" scrolling="no" frameborder="0" allowTransparency="true"></iframe></span>',parts:{iframe:"iframe"},defaults:{math:"\\(x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}\\)"},init:function(){this.once("ready",function(){this.frameWrapper=new CKEDITOR.plugins.mathjax.frameWrapper(this.parts.iframe,t),this.frameWrapper.setValue(this.data.math)})},data:function(){this.frameWrapper&&this.frameWrapper.setValue(this.data.math)},upcast:function(t,e){if("span"==t.name&&t.hasClass(a)&&!(1<t.children.length||t.children[0].type!=CKEDITOR.NODE_TEXT)){e.math=t.children[0].value;var n=t.attributes;return n.style=n.style?n.style+";display:inline-block":"display:inline-block",t.children[0].replaceWith(new CKEDITOR.htmlParser.element("iframe",{style:"border:0;width:0;height:0",scrolling:"no",frameborder:0,allowTransparency:!0})),t}},downcast:function(t){t.children[0].replaceWith(new CKEDITOR.htmlParser.text(this.data.math));var a=t.attributes;return a.style=a.style.replace(/display:\s?inline-block;?\s?/,""),""===a.style&&delete a.style,t}}),CKEDITOR.dialog.add("mathjax",this.path+"dialogs/mathjax.js"),t.on("contentPreview",function(a){a.data.dataValue=a.data.dataValue.replace(/<\/head>/,'<script src="'+(t.config.mathJaxLib?CKEDITOR.getUrl(t.config.mathJaxLib):"http://cdn.mathjax.org/mathjax/2.2-latest/MathJax.js?config=TeX-AMS_HTML")+'"></script></head>')})}}),CKEDITOR.plugins.mathjax={},CKEDITOR.plugins.mathjax.frameWrapper=function(t,a){function e(){h=!0,r=s,n.setHtml(r),a.fire("lockSnapshot"),t.setStyles({height:0,width:0,"vertical-align":"middle"}),a.fire("unlockSnapshot"),l.getWindow().$.update(r)}for(var n,i,r,s,l=t.getFrameDocument(),o=!1,h=!1,d=CKEDITOR.tools.addFunction(function(){i=l.getById("preview"),n=l.getById("buffer"),o=!0,s&&e(),t.fire("mathJaxLoaded")}),c=CKEDITOR.tools.addFunction(function(){i.setHtml(n.getHtml());var o=Math.max(l.$.body.offsetHeight,l.$.documentElement.offsetHeight),d=Math.max(i.$.offsetWidth,l.$.body.scrollWidth);a.fire("lockSnapshot"),t.setStyles({height:o+"px",width:d+"px",display:"inline"}),a.fire("unlockSnapshot"),t.fire("mathJaxUpdateDone"),r!=s?e():h=!1}),p="color font-family font-style font-weight font-variant font-size".split(" "),f="",m=0;m<p.length;m++){var u=p[m],g=t.getComputedStyle(u);g&&(f+=u+": "+g+";")}return l.write('<!DOCTYPE html><html><head><meta charset="utf-8"><style type="text/css">span#preview {'+f+"}</style><script type=\"text/x-mathjax-config\">MathJax.Hub.Config( {showMathMenu: false,messageStyle: \"none\"} );function getCKE() {if ( typeof window.parent.CKEDITOR == 'object' ) {return window.parent.CKEDITOR;} else {return window.parent.parent.CKEDITOR;}}function update() {MathJax.Hub.Queue(['Typeset',MathJax.Hub,this.buffer],function() {getCKE().tools.callFunction( "+c+" );});}MathJax.Hub.Queue( function() {getCKE().tools.callFunction("+d+');} );</script><script src="'+(a.config.mathJaxLib||"http://cdn.mathjax.org/mathjax/2.2-latest/MathJax.js?config=TeX-AMS_HTML")+'"></script></head><body style="padding:0;margin:0;background:transparent;overflow:hidden"><span id="preview"></span><span id="buffer" style="display:none"></span></body></html>'),{setValue:function(t){s=t,o&&!h&&e()}}}}();