!function(){function e(e){function i(e,t,i){var r,s=e.name;if(t?i?("div"==s&&(r=e.getFirst("figure"),e.replaceWith(r),e=r),e.attributes["data-cke-centered"]=!0,r=e.getFirst("img")):"figure"==s&&e.hasClass("caption")&&(r=e.getFirst("img")):"img"==s&&(r=e),r){for(var o in n)(t=r.attributes[o])&&t.match(a)&&delete r.attributes[o];return e}}var a=/^\s*(\d+\%)\s*$/i,n={width:1,height:1};return e?function(e){return i(e,!0,t(e))}:function(e){return i(e)}}function t(e){if(!(e.name in{div:1,p:1}))return!1;var t=e.children;return 1!==t.length?!1:(e=CKEDITOR.tools.parseCssText(e.attributes.style||""),e["text-align"]&&"center"==e["text-align"]?(t=t[0],e=t.name,"img"==e||"figure"==e&&t.hasClass("caption")?!0:!1):!1)}function i(e){var t,i=CKEDITOR.tools.extend({},e.data,!1,{width:1,height:1}),e=e.parts.image;for(t in i)i[t]?e.setAttribute(t,i[t]):e.removeAttribute(t)}function a(e){var t=e.editor,i=t.document,a=i.createElement("span");if(a.addClass("cke_image2_resizer"),a.setAttribute("title",t.lang.image2.resizer),a.append(new CKEDITOR.dom.text("â€‹",i)),e.inline)e.wrapper.append(a);else{var n=e.element.getFirst(),r=i.createElement("span");r.addClass("cke_image2_resizer_wrapper"),r.append(e.parts.image),r.append(a),e.element.append(r,!0),n.is("span")&&n.remove()}a.on("mousedown",function(a){function n(e,t,a){var n=CKEDITOR.document,r=[];if(i.equals(n)||r.push(n.on(e,t)),r.push(i.on(e,t)),a)for(e=r.length;e--;)a.push(r.pop())}function r(){l=C+f*g,c=0|l/b}function s(){c=T-m,l=0|c*b}var o,l,c,d,g,m,p,u=e.parts.image,f="right"==e.data.align?-1:1,h=a.data.$.screenX,v=a.data.$.screenY,C=u.$.clientWidth,T=u.$.clientHeight,b=C/T,w=[];t.fire("saveSnapshot"),n("mousemove",function(e){o=e.data.$,g=o.screenX-h,m=v-o.screenY,p=Math.abs(g/m),1==f?0>=g?0>=m?r():p>=b?r():s():0>=m?p>=b?s():r():s():0>=g?0>=m?p>=b?s():r():s():0>=m?r():p>=b?r():s(),l>=15&&c>=15?(u.setAttributes({width:l,height:c}),d=!0):d=!1},w),n("mouseup",function(){for(var i;i=w.pop();)i.removeListener();d&&(e.setData({width:l,height:c}),t.fire("saveSnapshot")),d=!1})}),e.on("data",function(){a["right"==e.data.align?"addClass":"removeClass"]("cke_image2_resizer_left")})}function n(e){var t=[];return function(i){var a=e.getCommand("justify"+i);a&&(t.push(function(){a.refresh(e,e.elementPath())}),i in{right:1,left:1,center:1}&&a.on("exec",function(a){var n=r(e);if(n){for(n.setData("align",i),n=t.length;n--;)t[n]();a.cancel()}}),a.on("refresh",function(t){var a=r(e),n={right:1,left:1,center:1};a&&(this.setState(a.data.align==i?CKEDITOR.TRISTATE_ON:i in n?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),t.cancel())}))}}function r(e){return(e=e.widgets.focused)&&e.name in{image2inline:1,image2block:1}?e:null}CKEDITOR.plugins.add("image2",{lang:"en",requires:"widget,dialog",icons:"image2",hidpi:!0,onLoad:function(){CKEDITOR.addCss(".cke_image2_resizer{display:none;position:absolute;bottom:2px;width: 0px;height: 0px;border-style:solid;right:2px;border-width:0 0 10px 10px;border-color:transparent transparent #ccc transparent;"+CKEDITOR.tools.cssVendorPrefix("box-shadow","1px 1px 0px #777",!0)+";cursor:se-resize;}.cke_image2_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image2_resizer.cke_image2_resizer_left{right:auto;left:2px;border-width:10px 0 0 10px;border-color:transparent transparent transparent #ccc;"+CKEDITOR.tools.cssVendorPrefix("box-shadow","-1px 1px 0px #777",!0)+";cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image2_resizer{display:block;}")},init:function(e){e.widgets.add("image2inline",o),e.widgets.add("image2block",l),e.addCommand("image2",{exec:function(){var t=r(e);t?t.edit():e.execCommand("image2inline")}}),e.ui.addButton&&e.ui.addButton("image2",{label:e.lang.common.image,command:"image2",toolbar:"insert,10"}),e.contextMenu&&(e.addMenuGroup("image2",10),e.addMenuItem("image2",{label:e.lang.image2.menu,command:"image2",group:"image2"}),e.contextMenu.addListener(function(){return r(e)?{image2:CKEDITOR.TRISTATE_OFF}:null})),CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js")},afterInit:function(e){var t,i={left:1,right:1,center:1,block:1},e=n(e);for(t in i)e(t)}});var s={contentTransformations:[["img[width]: sizeToAttribute"]],data:function(){var e=this,t=e.editor,a=e.data;e.shiftState({element:e.element,oldState:e.oldData,newState:a,destroy:function(){this.destroyed||(t.widgets.destroy(e),this.destroyed=!0)},init:function(i){if(this.destroyed)e=t.widgets.initOn(i,"image2"+(a.hasCaption||"center"==a.align?"block":"inline"),e.data);else{var i=e,n=i.wrapper,r=i.data.align;"center"==r?(i.inline||n.setStyle("text-align","center"),n.removeStyle("float")):(i.inline||n.removeStyle("text-align"),"none"==r?n.removeStyle("float"):n.setStyle("float",r))}}}),e.parts.image.setAttributes({src:e.data.src,"data-cke-saved-src":e.data.src,alt:e.data.alt}),i(e),e.oldData=CKEDITOR.tools.extend({},e.data)},dialog:"image2",init:function(){var e=this.parts.image,t={hasCaption:!!this.parts.caption,src:e.getAttribute("src"),alt:e.getAttribute("alt")||"",width:e.getAttribute("width")||"",height:e.getAttribute("height")||""};this.element.data("cke-centered")?(this.element.data("cke-centered",!1),t.align="center"):(t.align=this.element.getStyle("float")||e.getStyle("float")||"none",this.element.removeStyle("float"),e.removeStyle("float")),t.hasCaption||this.wrapper.setStyle("line-height","0"),this.setData(t),a(this),this.shiftState=CKEDITOR.plugins.image2.stateShifter(this.editor)},downcast:function(e){var t=e.attributes,i=this.data.align;if(!this.inline){var a=e.getFirst("span"),n=a.getFirst("img");a.replaceWith(n)}return i&&"none"!=i&&(a=CKEDITOR.tools.parseCssText(t.style||""),"center"==i&&"p"!=e.name?e=e.wrapWith(new CKEDITOR.htmlParser.element("img"==e.name?"p":"div",{style:"text-align:center"})):i in{left:1,right:1}&&(a["float"]=i),CKEDITOR.tools.isEmpty(a)||(t.style=CKEDITOR.tools.writeCssText(a))),e}},o=CKEDITOR.tools.extend({allowedContent:{img:{attributes:"!src,alt,width,height",styles:"float"}},inline:!0,parts:{image:"img"},template:'<img alt="" src="" />',upcast:e()},s),l=CKEDITOR.tools.extend({allowedContent:{figcaption:!0,figure:{classes:"!caption",styles:"float,display"},img:{attributes:"!src,alt,width,height"},div:{match:t,styles:"text-align"},p:{match:t,styles:"text-align"}},editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u; a[!href]"}},parts:{image:"img",caption:"figcaption"},template:'<figure class="caption"><img alt="" src="" /><figcaption>Caption</figcaption></figure>',upcast:e(!0)},s);CKEDITOR.plugins.image2={stateShifter:function(e){function t(e,t){return e.oldState?e.oldState[t]!==e.newState[t]:!1}function i(t){var i=e.document.createElement(n,{styles:{"text-align":"center"}});return a(i,t),t.move(i),i}function a(t,i){if(i.getParent()){var a=e.createRange();a.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),s.insertElementIntoRange(t,a),i.remove()}else t.replace(i)}var n=e.config.enterMode==CKEDITOR.ENTER_P?"p":"div",r=["hasCaption","align"],s=e.editable(),o={align:function(e,a,n){var r=e.newState.hasCaption,s=e.element;t(e,"align")?r||("center"==n&&(e.destroy(),e.element=i(s)),t(e,"hasCaption")||"center"!=a||"center"==n)||(e.destroy(),a=s.findOne("img"),a.replace(s),e.element=a):"center"==n&&t(e,"hasCaption")&&!r&&(e.destroy(),e.element=i(s)),s.is("figure")&&("center"==n?s.setStyle("display","inline-block"):s.removeStyle("display"))},hasCaption:function(i,n,r){if(t(i,"hasCaption"))if(n=i.element,i.destroy(),r){var r=n.findOne("img")||n,s=CKEDITOR.dom.element.createFromHtml('<figure class="caption"><img alt="" src="" /><figcaption>Caption</figcaption></figure>',e.document);a(s,n),r.replace(s.findOne("img")),i.element=s}else r=n.findOne("img"),r.replace(n),i.element=r}};return function(e){for(var t,i=e.oldState,a=e.newState,n=0;n<r.length;n++)t=r[n],o[t](e,i?i[t]:null,a[t]);e.init(e.element)}}}}();